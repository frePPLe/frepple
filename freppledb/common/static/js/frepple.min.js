/* frePPLe 4.0.0
Copyright (C) 2010-2019 by frePPLe bv

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files(the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/ or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT.IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

function isDragnDropUploadCapable(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&"FormData"in window&&"FileReader"in window}var _scrollBarWidth;function getScrollBarWidth(){if(!_scrollBarWidth){var e=$("<div style='overflow:scroll;position:absolute;top:-99999px'></div>").appendTo("body");_scrollBarWidth=e.prop("offsetWidth")-e.prop("clientWidth"),e.remove()}return _scrollBarWidth}function breadcrumbs_reflow(){var e=$("#breadcrumbs"),t=$(".breadcrumbrow"),a=t.parent().width(),o=$("#database").closest(".navbar-nav").width();o&&(a-=o),e.children("li.d-none").removeClass("d-none");var i=!0;e.children("li").each(function(){t.width()>a&&!i&&$(this).addClass("d-none"),i=!1})}function admin_escape(e){return e?e.replace(/_/g,"_5F").replace(/:/g,"_3A").replace(/\//g,"_2F").replace(/#/g,"_23").replace(/\?/g,"_3F").replace(/;/g,"_3B").replace(/@/g,"_40").replace(/&/g,"_26").replace(/=/g,"_3D").replace(/\+/g,"_2B").replace(/\$/g,"_24").replace(/,/g,"_2C").replace(/"/g,"_22").replace(/</g,"_3C").replace(/>/g,"_3E").replace(/%/g,"_25").replace(/\\/g,"_5C").replace(/\t/g,"%09"):""}function admin_unescape(e){return e.replace(/%09/g,"\t").replace(/_5C/g,"\\").replace(/_25/g,"%").replace(/_3E/g,">").replace(/_3C/g,"<").replace(/_22/g,'"').replace(/_2C/g,",").replace(/_24/g,"$").replace(/_2B/g,"+").replace(/_3D/g,"=").replace(/_26/g,"&").replace(/_40/g,"@").replace(/_3B/g,";").replace(/_3F/g,"?").replace(/_23/g,"#").replace(/_2F/g,"/").replace(/_3A/g,":").replace(/_5F/g,"_")}function escapeAttribute(e){return"string"==typeof e||e instanceof String?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function ajaxerror(e,t,a){var o;401!=e.status?(o=0==e.readyState?gettext("Connection failed"):a?"<strong>"+a+"</strong><br>"+e.responseText:e.responseText,hideModal("timebuckets"),$("#save i").addClass("hidden"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger"><h5 class="modal-title">'+gettext("Error")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>'+o+'</p></div><div class="modal-footer"><input type="submit" role="button" class="btn btn-primary" data-bs-dismiss="modal" value="'+gettext("Close")+'"></div></div></div>'),showModal("popup")):location.reload()}$.fn.resizable=function(e){var t={handleSelector:null,resizeWidth:!0,resizeHeight:!0,onDragStart:null,onDragEnd:null,onDrag:null,touchActionNone:!0,reverse:!1};return"object"==typeof e&&(t=$.extend(t,e)),this.each(function(){var e,a,o=$(this);if(!$(this).hasClass("ui-jqgrid")){var i=t.handleSelector?$(t.handleSelector):o;t.touchActionNone&&i.css("touch-action","none"),o.addClass("resizable"),i.bind("mousedown.rsz touchstart.rsz",function(i){if((e=l(i)).width=parseInt(o.width(),10),e.height=parseInt(o.height(),10),a=o.css("transition"),o.css("transition","none"),t.onDragStart&&!1===t.onDragStart(i,o,t))return;t.dragFunc=s,$(document).bind("mousemove.rsz",t.dragFunc),$(document).bind("mouseup.rsz",n),(window.Touch||navigator.maxTouchPoints)&&($(document).bind("touchmove.rsz",t.dragFunc),$(document).bind("touchend.rsz",n));$(document).bind("selectstart.rsz",r)})}function r(e){e.stopPropagation(),e.preventDefault()}function s(a){var i=l(a);if(t.resizeWidth){var r=t.reverse?e.width-i.x+e.x:e.width+i.x-e.x;o.width(r)}if(t.resizeHeight){var s=e.height+i.y-e.y;o.height(s)}t.onDrag&&t.onDrag(a,o,t)}function n(e){return e.stopPropagation(),e.preventDefault(),$(document).unbind("mousemove.rsz",t.dragFunc),$(document).unbind("mouseup.rsz",n),(window.Touch||navigator.maxTouchPoints)&&($(document).unbind("touchmove.rsz",t.dragFunc),$(document).unbind("touchend.rsz",n)),$(document).unbind("selectstart.rsz",r),o.css("transition",a),t.onDragEnd&&t.onDragEnd(e,o,t),!1}function l(e){var t={x:0,y:0,width:0,height:0};if("number"==typeof e.clientX)t.x=e.clientX,t.y=e.clientY;else{if(!e.originalEvent.touches)return null;t.x=e.originalEvent.touches[0].clientX,t.y=e.originalEvent.touches[0].clientY}return t}})};var upload={warnUnsavedChanges:function(){return $(window).off("beforeunload",upload.warnUnsavedChanges),gettext("There are unsaved changes on this page.")},undo:function(){if(!$("#undo").hasClass("btn-primary")){if("function"==typeof extraSearchUpdate){var e=$("#grid").getGridParam("postData").filters;extraSearchUpdate(e?JSON.parse(e):null)||$("#grid").trigger("reloadGrid")}else $("#grid").trigger("reloadGrid");$("#grid").closest(".ui-jqgrid-bdiv").scrollTop(0),$("#save, #undo").addClass("btn-primary").removeClass("btn-danger").prop("disabled",!0),$("#gridactions").prop("disabled",!0),$(".ng-dirty").removeClass("ng-dirty"),$(window).off("beforeunload",upload.warnUnsavedChanges)}},select:function(){$.jgrid.hideModal("#searchmodfbox_grid"),$("#save, #undo").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges)},selectedRows:[],restoreSelection:function(){for(var e in grid.markSelectedRow(upload.selectedRows.length),upload.selectedRows)$("#grid").jqGrid("setSelection",upload.selectedRows[e],!1);upload.selectedRows=[]},save:function(e){if(!$("#save").hasClass("btn-primary")){if($("#grid").saveCell(editrow,editcol),"function"==typeof getDirtyData)var t=getDirtyData();else t=$("#grid").getChangedCells("dirty");var a=$("#grid").jqGrid("getGridParam","selarrrow");upload.selectedRows=a?a.slice():null,null!=t&&t.length>0&&($("#save i").removeClass("hidden"),"undefined"!=typeof saveData?saveData(t,e):$.ajax({url:location.pathname,data:JSON.stringify(t),type:"POST",contentType:"application/json",success:function(){upload.undo(),$("#save i").addClass("hidden"),$(".ng-dirty").removeClass("ng-dirty"),void 0!==e&&e()},error:ajaxerror}))}},validateSort:function(e){"grid_cb"!=$(this).attr("id")&&($("body").hasClass("popup")||($("#save").hasClass("btn-primary")?jQuery("#grid").jqGrid("resetSelection"):(hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header alert-warning" style="border-top-left-radius: inherit; border-top-right-radius: inherit"><h5 class="modal-title">'+gettext("Save or cancel your changes first")+'</h5></div><div class="modal-body">'+gettext("There are unsaved changes on this page.")+'</div><div class="modal-footer justify-content-between"><input type="submit" id="savebutton" role="button" class="btn btn-danger" value="'+gettext("Save")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary" value="'+gettext("Return to page")+'"></div></div></div>'),showModal("popup"),$("#savebutton").on("click",function(){upload.save(),hideModal("popup")}),$("#cancelbutton").on("click",function(){upload.undo(),hideModal("popup")}),e.stopPropagation())))}};function opendetail(e){var t=$(e.target).parent(),a=t.attr("href"),o=t.attr("objectid");void 0!==o&&0!=o||(o=t.parent().text().trim()),e.preventDefault(),e.stopImmediatePropagation(),window.location.href=url_prefix+a.replace("key",admin_escape(o))}function formatDuration(e,t,a){var o,i,r,s=0,n=0,l=[],d=[];if(void 0===e||""===e||null===e)return"";if("number"==typeof e)n=e,r=Math.sign(n);else switch(r="-"==$.trim(e).charAt(0)?-1:1,1==(l=e.replace(/ +/g," ").split(" ")).length?(d=e.split(":"),s=0):(d=l[1].split(":"),s=""!=l[0]?parseFloat(l[0]):0),d.length){case 0:n=86400*Math.abs(s);break;case 1:n=86400*Math.abs(s)+(""!=d[0]?Math.abs(parseFloat(d[0])):0);break;case 2:n=86400*Math.abs(s)+60*(""!=d[0]?Math.abs(parseFloat(d[0])):0)+(""!=d[1]?parseFloat(d[1]):0);break;default:n=86400*Math.abs(s)+3600*(""!=d[0]?Math.abs(parseFloat(d[0])):0)+60*(""!=d[1]?parseFloat(d[1]):0)+(""!=d[2]?parseFloat(d[2]):0)}return n=(n=Math.abs(n))-86400*(s=Math.floor(n/86400))-3600*(o=Math.floor((n-86400*s)/3600))-60*(i=Math.floor((n-86400*s-3600*o)/60)),s>1825?"N/A":s>0?(r*s).toString()+" "+(o<10?"0":"")+o+(i<10?":0":":")+i+(n<10?":0":":")+Number(n.toFixed(n===Math.floor(n)?0:6)):(r<0?"-":"")+(o<10?"0":"")+o+(i<10?":0":":")+i+(n<10?":0":":")+Number(n.toFixed(n===Math.floor(n)?0:6))}jQuery.extend($.fn.fmatter,{percentage:function(e,t,a){return void 0===e||""===e||null===e?"":grid.formatNumber(e)+"%"},duration:formatDuration,currencyWithBlanks:function(e,t,a){return void 0===e||null===e?"":$.fn.fmatter.call(this,"currency",e,t)},image:function(e,t,a){return e?'<img class="avatar-sm" src="/uploads/'+e+'">':""},admin:function(e,t,a){return void 0===e||""===e||null===e?"":t.colModel.popup||"0"===a.showdrilldown?$.jgrid.htmlEncode(e):$.jgrid.htmlEncode(e)+'<a href="'+url_prefix+"/data/"+t.colModel.role+"/"+admin_escape(e)+"/change/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right'></span></a>"},detail:function(e,t,a){if(void 0===e||""===e||null===e)return"";if(t.colModel.popup)return $.jgrid.htmlEncode(e);if("operation"==t.colModel.name){if(a.hasOwnProperty("type")&&("PO"===a.type||"DO"===a.type||"DLVR"===a.type||"STCK"===a.type))return $.jgrid.htmlEncode(e);if(a.hasOwnProperty("operationplan__type")&&("PO"===a.operationplan__type||"DO"===a.operationplan__type||"DLVR"===a.operationplan__type||"STCK"===a.operationplan__type))return $.jgrid.htmlEncode(e)}return $.jgrid.htmlEncode(e)+'<a href="'+url_prefix+"/detail/"+t.colModel.role+"/"+admin_escape(e)+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right'></span></a>"},demanddetail:function(e,t,a){if(void 0===e||""===e)return"";if(t.colModel.popup)return $.jgrid.htmlEncode(e);for(var o="",i=e.length,r=0;r<i;r++)""!=o&&(o+=", "),"F"==e[r][2]?o+=e[r][0]+" : "+$.jgrid.htmlEncode(e[r][1])+'<a href="'+url_prefix+"/detail/forecast/forecast/"+admin_escape(e[r][1]).substring(0,admin_escape(e[r][1]).length-13)+"/\" onclick='event.stopPropagation()' objectid='"+$.jgrid.htmlEncode(e[r][1]).substring(0,$.jgrid.htmlEncode(e[r][1]).length-13)+"'><span class='ps-2 fa fa-caret-right' role='forecast/forecast'></span></a>":o+=e[r][0]+" : "+$.jgrid.htmlEncode(e[r][1])+'<a href="'+url_prefix+"/detail/input/demand/"+admin_escape(e[r][1])+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right' role='input/demand'></span></a>";return o},forecastdetail:function(e,t,a){return void 0===e||""===e||null===e?"":t.colModel.popup||"0"===a.showdrilldown?$.jgrid.htmlEncode(e):a.hasOwnProperty("hasForecastRecord")&&"True"===a.hasForecastRecord?$.jgrid.htmlEncode(e)+'<a href="'+url_prefix+"/detail/"+t.colModel.role+"/"+admin_escape(e)+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right'></span></a>":$.jgrid.htmlEncode(e)},listdetail:function(e,t,a){if(void 0===e||""===e)return"";if(t.colModel.popup)return e;for(var o="",i=e.length,r=0;r<i;r++)""!=o&&(o+=", "),o+='<span><span class="listdetailkey"',e[r].length>2&&(o+=' data-extra="'+$.jgrid.htmlEncode(e[r][2])+'"'),o+=">"+$.jgrid.htmlEncode(e[r][0])+'</span><a href="'+url_prefix+"/detail/"+t.colModel.role+"/"+admin_escape(e[r][0])+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right' role='"+t.colModel.role+"'></span></a></span>&nbsp;<span>"+e[r][1]+"</span>";return o},graph:function(e,t,a){return'<div class="graph" style="height:80px"></div>'},longstring:function(e,t,a){if("string"!=typeof e)return"";var o=$.jgrid.htmlEncode(e);return o?'<span data-bs-toggle="tooltip" data-bs-placement="left" data-bs-title="'+o+'">'+o+"</span>":tipcontentreturn},selectbutton:function(e,t,a){return e?'<button onClick="opener.dismissRelatedLookupPopup(window, grid.selected)" class="btn btn-primary btn-sm">'+gettext("select")+"</button>":""},color:function(e,t,a){if(void 0===a.color||""===a.color||null===e)return"";var o=Math.round(parseInt(a.delay)/86400);return 999===parseInt(a.criticality)||999===parseInt(a.operationplan__criticality)?"":o<0?'<div class="invStatus" style="background-color: #008000; color: #151515;">'+-o+" "+gettext("days early")+"</div>":0===o?'<div class="invStatus" style="background-color: #008000; color: #151515;">'+gettext("on time")+"</div>":o>0?'<div class="invStatus" style="background-color: #f00; color: #151515;">'+o+" "+gettext("days late")+"</div>":""},number:function(e,t){return window.SKIP_FORMATER?e:grid.formatNumber(e)}}),jQuery.extend($.fn.fmatter.percentage,{unformat:function(e,t,a){return e.replace("%","")}}),jQuery.extend($.fn.fmatter.listdetail,{unformat:function(e,t,a){var o=[];return $(".listdetailkey",$(a)).each(function(e,t){o.push([$(t).text(),$(t).parent().next("span").text(),$(t).attr("data-extra")])}),o}}),jQuery.extend($.fn.fmatter.currencyWithBlanks,{unformat:function(e,t,a){var o=t.colModel.formatoptions.prefix,i=t.colModel.formatoptions.suffix,r=$(a).closest("table").first(),s=r.jqGrid("getGridRes","formatter.currency.thousandsSeparator").replace(/([\.\*\_\'\(\)\{\}\+\?\\])/g,"\\$1"),n=r.jqGrid("getGridRes","formatter.currency.decimalSeparator");return o&&o.length&&(e=e.substr(o.length)),i&&i.length&&(e=e.substr(0,e.length-i.length)),e=e.replace(new RegExp(s,"g"),""),"."!=n&&(e=e.replace(n,".")),e}});var grid={selected:void 0,formatNumber:function(e,t=6){if(void 0===e||""===e)return"";var a=$.fmatter.isNumber;if(a(e)||(e*=1),a(e)){var o,i=e<0,r=Math.abs(e);o=r>1e5||t<=0?String(parseFloat(e.toFixed())):r>1e4||t<=1?String(parseFloat(e.toFixed(1))):r>1e3||t<=2?String(parseFloat(e.toFixed(2))):r>100||t<=3?String(parseFloat(e.toFixed(3))):r>10||t<=4?String(parseFloat(e.toFixed(4))):r>1||t<=5?String(parseFloat(e.toFixed(5))):String(parseFloat(e.toFixed(t)));var s=jQuery("#grid").jqGrid("getGridRes","formatter.number.decimalSeparator")||".";"."!==s&&(o=o.replace(".",s));var n=jQuery("#grid").jqGrid("getGridRes","formatter.number.thousandsSeparator")||",";if(n){var l=o.lastIndexOf(s);l=l>-1?l:o.length;var d,c=void 0===s?"":o.substring(l),p=-1;for(d=l;d>0;d--)++p%3==0&&d!==l&&(!i||d>1)&&(c=n+c),c=o.charAt(d-1)+c;o=c}return o}return e},summary_last:function(e,t,a){return a[t]},summary_first:function(e,t,a){return e||a[t]},setSelectedRow:function(e){void 0!=grid.selected&&$(this).jqGrid("setCell",grid.selected,"select",null),grid.selected=e,$(this).jqGrid("setCell",e,"select",!0)},runAction:function(e){["no_action","actions1"].includes($("#actions").val())||actions[$("#actions").val()]()},setStatus:function(e,t){var a=jQuery("#grid").jqGrid("getGridParam","selarrrow");for(var o in a)jQuery("#grid").jqGrid("setCell",a[o],t?t+"status":"status",e,"dirty-cell"),jQuery("#grid").jqGrid("setRowData",a[o],!1,"edited");$("#actions1").html(gettext("Select action")),$("#save").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1),$("#undo").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1)},_cached_cross:null,pivotcolumns:function(e,t,a){if(grid._cached_cross)return grid._cached_cross;var o="";for(var i of cross_idx)if(!cross[i].hidden){var r="fa-plus-square-o";for(var s of cross_idx){if(i!=s&&cross[s].expand)if(cross[s].expand.includes(cross[i].key))o+="&nbsp;&nbsp;&nbsp;";else for(var n in cross)cross[s].expand.includes(cross[n].key)&&cross[n].expand&&cross[n].expand.includes(cross[i].key)&&(o+="&nbsp;&nbsp;&nbsp;");cross[i].expand&&cross[i].expand.includes(cross[s].key)&&(r="fa-minus-square-o")}cross[i].editable?o+=cross[i].name+'<input style="width:0px" class="invisible"/><br>':cross[i].expand?o+=cross[i].name+'&nbsp;<i style="cursor: pointer" class="fa '+r+'" onclick="grid.expandCross(this, '+i+')"></i><br>':o+=cross[i].name+"<br>"}return grid._cached_cross=o,o},toggleCollapseSubOptions:function(e,t){!!$("#"+t+" i").hasClass("fa-chevron-down")?($("#popup #"+t+" i").removeClass("fa-chevron-down").addClass("fa-chevron-right"),$('#popup #DroppointRows li[type="'+e+'"]').addClass("d-none")):($("#popup #"+t+" i").removeClass("fa-chevron-right").addClass("fa-chevron-down"),$('#popup #DroppointRows li[type="'+e+'"]').removeClass("d-none"))},showCustomize:function(e,t,a,o,i,r,s){hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid");var n=$(void 0!==t?t:"#grid").jqGrid("getGridParam","colModel"),l=0,d=0,c=!1,p=e&&void 0!==i&&i,u=p?"":'<div class="row mb-3"><div class="col"><div class="card"><div class="card-header">'+gettext("Available options")+'</div><div class="card-body"><ul class="list-group" id="DroppointRows" style="height: 160px; overflow-y: scroll;">placeholder1</ul></div></div></div><div class="col"><div class="card"><div class="card-header">'+gettext("Selected options")+'</div><div class="card-body"><ul class="list-group" id="Rows" style="height: 160px; overflow-y: scroll;">placeholder0</ul></div></div></div></div>',f="",g="",h="",m={},v="",b="";const x=new Set;for(var y in n)"graph"==n[y].name?c=!0:"rn"==n[y].name||"cb"==n[y].name||null==n[y].counter||""==n[y].label||"alwayshidden"in n[y]?d++:(n[y].frozen&&(l=parseInt(y,10)+1-d),n[y].hidden?m[n[y].label]=y:h+='<li id="'+y+'"  class="list-group-item" style="cursor: move;">'+n[y].label+"</li>");if(e){var w=void 0!==a?a:cross,k=void 0!==o?o:cross_idx;f='<div class="row"><div class="col"><div class="card"><div class="card-header">'+gettext("Available Cross")+'</div><div class="card-body"><ul class="list-group" id="DroppointCrosses" style="height: 160px; overflow-y: scroll;">placeholder1</ul></div></div></div><div class="col"><div class="card"><div class="card-header">'+gettext("Selected Cross")+'</div><div class="card-body"><ul class="list-group" id="Crosses" style="height: 160px; overflow-y: scroll;">placeholder0</ul></div></div></div></div>';for(var _ in k)v+='<li class="list-group-item" id="'+(1e3+parseInt(k[_],10))+'" style="cursor: move;">'+w[k[_]].name+"</li>";var C={};for(var _ in w)k.indexOf(parseInt(_,10))>-1||""==w[_].name||(C[w[_].name]=parseInt(_,10));for(var _ of Object.keys(C).sort())b+='<li class="list-group-item" id="'+(1e3+C[_])+'" style="cursor: move;">'+_+"</li>"}else{g='<div class="row mt-3"><div class="col">'+gettext("Frozen columns")+'&nbsp;&nbsp;<select id="frozen" class="form-select w-auto d-inline">';var M=Math.min(n.length,5);for(y=0;y<=M;y++)g+=y==l?'<option selected value="'+y+'">'+y+"</option>":'<option value="'+y+'">'+y+"</option>";g+="</select></div></div>"}u=u.replace("placeholder0",h);var j="";for(var T of Object.keys(m).sort())if(T.indexOf(" - ")>1){if(collapsibleOption=T.split(" - ")[0],!x.has(collapsibleOption)){x.add(collapsibleOption);let e='<i class="fa fa-chevron-right pt-1 float-end" style="cursor: pointer; z-index: 3000; position: relative"></i>';j+='<li id="'+1e3*x.size+'" class="list-group-item do-not-drag" style="cursor: pointer" onclick="grid.toggleCollapseSubOptions(\''+collapsibleOption+"',"+1e3*x.size+')">'+collapsibleOption+" attributes"+e+"</li>"}j+='<li id="'+m[T]+'" type="'+collapsibleOption+'" class="list-group-item ps-4 d-none" style="cursor: move">'+T+"</li>"}else j+='<li id="'+m[T]+'" class="list-group-item" style="cursor: move">'+T+"</li>";if(u=u.replace("placeholder1",j),e&&(f=(f=f.replace("placeholder0",v)).replace("placeholder1",b)),$("#popup").html('<div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">'+gettext("Customize")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label='+gettext("Close")+'></button></div><div class="modal-body">'+u+f+g+("undefined"!=typeof extra_customize_html?extra_customize_html:"")+'</div><div class="modal-footer justify-content-between"><input type="submit" id="cancelCustbutton" role="button" class="btn btn-gray" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="resetCustbutton" role="button" class="btn btn-gray" value="'+gettext("Reset")+'"><input type="submit" id="okCustbutton" role="button" class="btn btn-primary" value="'+gettext("OK")+'"></div></div></div>'),showModal("popup"),!p){var z=document.getElementById("Rows"),D=document.getElementById("DroppointRows");Sortable.create(z,{group:{name:"Rows",put:["DroppointRows"]},animation:100}),Sortable.create(D,{group:{name:"DroppointRows",put:["Rows"]},animation:100,filter:".do-not-drag"})}if(e){var G=document.getElementById("Crosses"),S=document.getElementById("DroppointCrosses");Sortable.create(G,{group:{name:"Crosses",put:["DroppointCrosses"]},animation:100}),Sortable.create(S,{group:{name:"DroppointCrosses",put:["Crosses"]},animation:100})}$("#resetCustbutton").on("click",void 0!==s?s:function(){var e={};if(e[reportkey]={favorites:favorites},"undefined"!=typeof url_prefix)var t=url_prefix+"/settings/";else t="/settings/";$.ajax({url:t,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),success:function(){window.location.href=window.location.href},error:ajaxerror})}),$("#okCustbutton").on("click",void 0!==r?r:function(){var t=$("#grid")[0].p.colModel,a=[],o=[];"cb"==t[0].name&&a.push(0),cross_idx=[];try{c||$("#grid").jqGrid("destroyFrozenColumns")}catch(e){console.log("Error destroying frozen columns:",e)}$("#Rows li").each(function(){var e=parseInt(this.id,10);e<1e3&&($("#grid").jqGrid("showCol",t[e].name),a.push(e))}),$("#DroppointRows li").each(function(){var a=parseInt(this.id,10);a<1e3&&(o.push(a),e&&$("#grid").jqGrid("setColProp",t[a].name,{frozen:!1}),$("#grid").jqGrid("hideCol",t[a].name))}),$("#Crosses li").each(function(){var e=parseInt(this.id,10);e>=1e3&&cross_idx.push(e-1e3)});var i=0;if(e)for(var r in t)"counter"in t[r]?i=parseInt(r)+1:a.push(parseInt(r));else i=parseInt($("#frozen").val());for(var r in o)a.push(o[r]);for(var r in t)"alwayshidden"in t[r]&&a.push(parseInt(r));$("#grid").jqGrid("remapColumns",a,!0);var s=0;for(var r in t)"rn"!=t[r].name&&"cb"!=t[r].name&&null!=t[r].counter?$("#grid").jqGrid("setColProp",t[r].name,{frozen:r-s<i}):s++;c||$("#grid").jqGrid("setFrozenColumns"),$("#grid").trigger("reloadGrid");var n="undefined"!=typeof extraCustomize&&extraCustomize();grid.saveColumnConfiguration(function(){n&&(window.location.href=window.location.href)}),hideModal("popup")})},getGridConfig:function(){var e=new Array,t=$("#grid").jqGrid("getGridParam","colModel"),a=!1,o=0,i=0;for(var r in t)"rn"!=t[r].name&&"cb"!=t[r].name&&"counter"in t[r]&&!("alwayshidden"in t[r])?(e.push([t[r].name,t[r].hidden,t[r].width]),t[r].frozen&&(i=parseInt(r)+1-o)):"columns"==t[r].name||"graph"==t[r].name?a=!0:o++;var s={rows:e},n=$("#grid").getGridParam("postData").filters;void 0!==n&&n.rules!=[]&&(s.filter=n);var l=$("#grid").getGridParam("sortname");if(""!==l&&(s.sidx=l,s.sord=$("#grid").getGridParam("sortorder")),a)for(var r in s.crosses=[],cross_idx)s.crosses.push(cross[cross_idx[r]].key);else s.frozen=i;return s},saveColumnConfiguration:function(e,t){var a,o=new Array,i=$("#grid").jqGrid("getGridParam","colModel"),r=0,s=!1,n=0,l=$("#grid").jqGrid("getGridParam","page");for(var d in"string"==typeof e?(e.indexOf("next")>=0?++l:e.indexOf("prev")>=0?--l:e.indexOf("last")>=0?l=$("#grid").jqGrid("getGridParam","lastpage"):e.indexOf("first")>=0?l=1:e.indexOf("user")>=0&&(l=$("input.ui-pg-input").val()),$("#save, #undo").addClass("btn-primary").removeClass("btn-danger").prop("disabled",!0)):void 0!==t&&"operationplans"==i[t].name&&gantt.redraw(),i)"rn"!=i[d].name&&"cb"!=i[d].name&&"counter"in i[d]&&!("alwayshidden"in i[d])?(o.push([i[d].name,i[d].hidden,i[d].width]),i[d].frozen&&(r=parseInt(d)+1-n)):"columns"==i[d].name?(s=!0,a=i[d].width):"graph"==i[d].name?s=!0:n++;var c={[reportkey]:{rows:o,page:l,favorites:favorites}},p=$("#grid").getGridParam("postData"),u=p?p.filters:initialfilter;void 0!==u&&u.rules!=[]&&(c[reportkey].filter=u);var f=$("#grid").getGridParam("sortname");if(""!==f&&(c[reportkey].sidx=f,c[reportkey].sord=$("#grid").getGridParam("sortorder")),s){for(var d in c[reportkey].crosses=[],cross_idx)c[reportkey].crosses.push(cross[cross_idx[d]].key);a&&(c[reportkey].label_width=a)}else c[reportkey].frozen=r;if("function"==typeof extraPreference){var g=extraPreference();for(var h in g)c[reportkey][h]=g[h]}if("undefined"!=typeof url_prefix)var m=url_prefix+"/settings/";else m="/settings/";grid._cached_cross=null,$.ajax({url:m,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(){preferences=c[reportkey],"function"==typeof e&&e()},error:ajaxerror})},afterEditCell:function(e,t,a,o,i){$(document.getElementById(o+"_"+t)).trigger("select")},showExport:function(e,t){hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid");var a=!0,o='<div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-capitalize-first">'+gettext("Export CSV or Excel file")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="'+gettext("Close")+'"></button></div><div class="modal-body">';if(e?o+='<div class="row" id="csvformat"><div class="col"><p class="fw-bold">'+gettext("Export format")+'</p><div class="form-check"><input class="form-check-input" id="spreadsheetlist" type="radio" name="csvformat" value="spreadsheetlist" checked=""><label class="form-check-label" for="spreadsheetlist">'+gettext("Spreadsheet list")+'</label></div><div class="form-check"><input class="form-check-input" id="csvlist" type="radio" name="csvformat" value="csvlist"><label class="form-check-label" for="csvlist">'+gettext("CSV list")+'</label></div><p class="fw-bold mt-3">'+gettext("Data source URL")+'&nbsp;&nbsp;<a href="'+documentation+'user-interface/getting-around/exporting-data.html" target="_blank" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="'+gettext("Using this link external applications can pull data from frePPLe")+'"><span class="fa fa-question-circle"></span></a><p><div class="input-group"><input type="text" readonly id="urladdress" class="input-group-text" style="background: white"><span class="input-group-text fa fa-clipboard" id="copybutton" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="'+gettext("Copy to clipboard")+'"</span></div></div>':e?a=!1:o+='<div class="row" id="csvformat"><div class="col"><p class="fw-bold">'+gettext("Export format")+'</p><div class="form-check"><input class="form-check-input" id="spreadsheettable" type="radio" name="csvformat" value="spreadsheettable" checked=""><label class="form-check-label" for="spreadsheettable">'+gettext("Spreadsheet table")+'</label></div><div class="form-check"><input class="form-check-input" id="spreadsheetlist" type="radio" name="csvformat" value="spreadsheetlist"><label class="form-check-label" for="spreadsheetlist">'+gettext("Spreadsheet list")+'</label></div><div class="form-check"><input class="form-check-input" id="csvtable" type="radio" name="csvformat" value="csvlist"><label class="form-check-label" for="csvtable">'+gettext("CSV table")+'</label></div><div class="form-check"><input class="form-check-input" id="csvlist" type="radio" name="csvformat" value="csvlist"><label class="form-check-label" for="csvlist">'+gettext("CSV list")+'</label></div><p class="fw-bold mt-3">'+gettext("Data source URL")+'&nbsp;&nbsp;<a href="'+documentation+'user-interface/getting-around/exporting-data.html" target="_blank" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="'+gettext("Using this link external applications can pull data from frePPLe")+'"><span class="fa fa-question-circle"></span></a><p><div class="input-group"><input type="text" readonly id="urladdress" class="input-group-text" style="background: white"><span class="input-group-text fa fa-clipboard" id="copybutton" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="'+gettext("Copy to clipboard")+'"</span></div></div>',a){if(t.length>0){o+='<div class="col"><p class="fw-bold">'+gettext("Scenarios to export")+'</p><div class="check" name="scenarios" id="scenarios" value="default">';for(var i=0;i<t.length;i++)1==t[i][2]&&(o+='<div class="form-check" style="white-space: nowrap"><input class="form-check-input" type="checkbox" value="" id="'+t[i][0]+'" checked disabled>&nbsp;&nbsp;&nbsp;<label class="form-check-label" for="'+t[i][0]+'">'+escapeAttribute(t[i][1])+"</label></div>");for(i=0;i<t.length&&i<6;i++)1!=t[i][2]&&(o+='<div class="form-check" style="white-space: nowrap"><input class="form-check-input" type="checkbox" value="" id="'+t[i][0]+'">&nbsp;&nbsp;&nbsp;<label class="form-check-label" for="'+t[i][0]+'">'+escapeAttribute(t[i][1])+"</label></div>");o+="</div></div>"}o+='</div></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="exportbutton" role="button" class="btn btn-primary" value="'+gettext("Export")+'"></div></div></div>',$("#popup").html(o),showModal("popup")}r();for(i=0;i<t.length&&i<6;i++)1!=t[i][2]&&$("#"+t[i][0]).on("click",function(){r()});function r(){var e=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href;location.search.length>0?e+="&":"?"!=e.charAt(e.length-1)&&(e+="?"),e+="format=spreadsheetlist",e+="&selected_rows=";var a=$("#grid").jqGrid("getGridParam","colModel"),o=!0,i=!1;for(var r in a)"columns"!=a[r].name&&"graph"!=a[r].name||(i=!0),!("rn"!=a[r].name&&"cb"!=a[r].name&&"counter"in a[r])||"alwayshidden"in a[r]||a[r].hidden||(o?o=!1:e+=",",e+=a[r].name);var s=$("#grid").getGridParam("postData"),n=s?s.filters:initialfilter;void 0!==n&&n.rules!=[]&&(e+="&filters="+n),e+="&language="+document.documentElement.lang;var l=$("#grid").getGridParam("sortname");if(""!==l&&(e+="&sidx="+l,e+="&sord="+$("#grid").getGridParam("sortorder")),i){o=!0;for(var r in cross_idx)o?(e+="&selected_crosses=",o=!1):e+=",",e+=cross[cross_idx[r]].key}if(t.length>1){var d=!0,c="";for(r=0;r<t.length;r++)$("#"+t[r][0]).is(":checked")&&(d?d=!1:c+=",",c+=t[r][0]);e+="&scenarios="+c}$("#urladdress").val(e)}$("#copybutton").on("click",function(){r(),navigator.clipboard.writeText($("#urladdress").val())}),$("#exportbutton").on("click",function(){var e=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href,a="";if(t.length>1)for(var o=!0,i=0;i<t.length;i++)$("#"+t[i][0]).is(":checked")&&(o?o=!1:a+=",",a+=t[i][0]);location.search.length>0?e+="&format="+$("#csvformat input:radio:checked").val():"?"==e.charAt(e.length-1)?e+="format="+$("#csvformat input:radio:checked").val():e+="?format="+$("#csvformat input:radio:checked").val(),t.length>1&&(e+="&scenarios="+a);var r=$("#grid").jqGrid("getGridParam","postData");e+="&"+jQuery.param(r),window.open(e,"_blank"),hideModal("popup")})},showBucket:function(){hideModal("popup"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#okbutton").on("click",function(){$("#horizonbuckets").val()+"|"+$("#horizonstart").val()+"|"+$("#horizonend").val()+"|"+($("#horizontype").is(":checked")?"True":"False")+"|"+$("#horizonbefore").val()+"|"+$("#horizonlength").val()+"|"+$("#horizonunit").val()==$("#horizonoriginal").val()?hideModal("timebuckets"):($.ajax({type:"POST",url:url_prefix+"/horizon/",data:{horizonbuckets:$("#horizonbuckets").val()?$("#horizonbuckets").val():$("#horizonbucketsul li a").first().text(),horizonstart:$("#horizonstart").val(),horizonend:$("#horizonend").val(),horizontype:$("#horizontype").is(":checked")?"1":"0",horizonlength:$("#horizonlength").val(),horizonbefore:$("#horizonbefore").val(),horizonunit:$("#horizonunit").val()},dataType:"text/html",async:!1}),window.location.href=window.location.href)}),showModal("timebuckets",!1)},showDelete:function(e){if(!$("#delete_selected").is(":disabled")){var t=jQuery("#grid").jqGrid("getGridParam","selarrrow");1==t.length&&"undefined"==typeof dont_show_related_objects_for_deletion?location.href=e+admin_escape(t[0])+"/delete/":t.length>0&&(hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-capitalize-first">'+gettext("Delete data")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></span></button></div><div class="modal-body"><p>'+interpolate(gettext("You are about to delete %s objects AND ALL RELATED RECORDS!"),[t.length],!1)+'</p></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray pull-left" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="delbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Confirm")+'"></div></div></div>'),showModal("popup"),$("#delbutton").on("click",function(){$.ajax({url:e,data:JSON.stringify([{delete:t}]),type:"POST",contentType:"application/json",success:function(){$("#delete_selected, #copy_selected, #edit_selected").prop("disabled",!0),$(".cbox, #cb_grid.cbox").prop("checked",!1),$("#grid").trigger("reloadGrid"),hideModal("popup")},error:function(e,t,a){401!=e.status?($("#popup .modal-body p").html(e.responseText),$("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#delbutton").prop("disabled",!0).hide()):location.reload()}})}))}},showCopy:function(){if(!$("#copy_selected").is(":disabled")){var e=jQuery("#grid").jqGrid("getGridParam","selarrrow");e.length>0&&(hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-capitalize-first">'+gettext("Copy data")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>'+interpolate(gettext("You are about to duplicate %s objects"),[e.length],!1)+'</p></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="copybutton" role="button" class="btn btn-primary" value="'+gettext("Confirm")+'"></div></div></div>'),showModal("popup"),$("#copybutton").on("click",function(){$.ajax({url:location.pathname,data:JSON.stringify([{copy:e}]),type:"POST",contentType:"application/json",success:function(){$("#delete_selected, #copy_selected, #edit_selected").prop("disabled",!0),$(".cbox, #cb_grid.cbox").prop("checked",!1),$("#grid").trigger("reloadGrid"),hideModal("popup")},error:function(e,t,a){401!=e.status?($("#popup .modal-body p").html(e.responseText),$("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#copybutton").prop("disabled",!0).hide()):location.reload()}})}))}},showFilter:function(e,t,a){$("#addsearch").val(""),$("#filteroperand, #filterfield, #andordropdown").remove(),grid.handlerinstalled=!1,hideModal("popup"),hideModal("timebuckets");var o=void 0!==e?e:"grid",i=$("#"+o),r=$(void 0!==t?t:"#curfilter");hideModal("timebuckets"),hideModal("popup"),i.jqGrid("searchGrid",{closeOnEscape:!0,multipleSearch:!0,multipleGroup:!0,overlay:0,resize:!1,sopt:["eq","ne","lt","le","gt","ge","bw","bn","in","ni","ew","en","cn","nc","ico"],onSearch:function(){var e=$("#fbox_"+o).jqFilter("filterData");grid.saveColumnConfiguration(),grid.getFilterGroup(i,e,!0,r),"function"==typeof extraSearchUpdate&&extraSearchUpdate(e)},onReset:function(){return"undefined"!=typeof initialfilter?(i.jqGrid("getGridParam","postData").filters=JSON.stringify(initialfilter),grid.getFilterGroup(i,initialfilter,!0,r)):r.html(""),grid.saveColumnConfiguration(),!0}}),$("#searchmodfbox_grid").detach().appendTo("#content-main")},resetFilter:function(){$("undefined"!=typeof curfilterid?curfilterid:"#curfilter").html(""),$("#grid").setGridParam({postData:{filters:""},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration()},countFilters:0,handlerinstalled:!1,addFilter:function(e){if(e){e.stopPropagation(),e.preventDefault();var t=$(e.target).attr("data-filterfield")}else t=$("#filterfield [data-filterfield]").first().attr("data-filterfield");var a={field:t,op:"cn",data:$("#addsearch").val(),filtercount:++grid.filtercount},o=$("#grid").getGridParam("postData");(o=void 0!==o?o.filters:initialfilter)&&""!==o?void 0!==(o=JSON.parse(o)).rules&&o.rules.length>0||void 0!==o.groups&&o.groups.length>0?o.rules.push(a):o={groupOp:"AND",rules:[a],groups:[o]}:o={groupOp:"AND",rules:[a],groups:[]},$("#grid").setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration(),"function"==typeof extraSearchUpdate&&extraSearchUpdate(o),grid.getFilterGroup($("#grid"),o,!0,$("#curfilter")),$(document).off("click",grid.clickFilter),grid.handlerinstalled=!1,$("#addsearch").val(""),$("#filteroperand, #filterfield, #andordropdown").remove(),$("#tooltip").css("display","none")},clickFilter:function(e){"addsearch"!=$(e.target).attr("id")&&($(document).off("click",grid.clickFilter),grid.handlerinstalled=!1,$("#addsearch").val(""),$("#filteroperand, #filterfield, #andordropdown").remove())},setFilterField:function(e,t,a,o){const i=$(e.target).closest(".badge"),r=$(e.target).attr("data-filterfield"),s=$(e.target).attr("data-filterlabel");let n=i.find("span[data-operandname]").attr("data-operandname"),l=grid.findOperandLabel(n);const d=$("#grid").jqGrid("getGridParam","colModel").filter(e=>e.name==r)[0].searchoptions;t.field!=r&&(i.find("span[data-colname]").attr("data-colname",r).attr("data-collabel",s).text(s),t.field=r,-1==d.sopt.indexOf(n)&&(n=d.sopt[0],l=grid.findOperandLabel(n),i.find("span[data-operandname]").attr("data-operandname",n).text(l),t.op=n),$("#filteroperand, #filterfield, #andordropdown").remove(),$("#grid").setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration())},setFilterOperand:function(e,t,a,o){const i=$(e.target).closest(".badge");let r=$(e.target).attr("data-operandname"),s=grid.findOperandLabel(r);r!=t.oper&&(i.find("span[data-operandname]").attr("data-operandname",r).text(s),t.op=r,$("#filteroperand, #filterfield, #andordropdown").remove(),$("#grid").setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration())},setFilterAndOr:function(e,t,a,o){const i=$(e.target);e.stopPropagation(),$("#filteroperand, #filterfield, #andordropdown").remove(),andordropdown=$('<span id="andordropdown" class="mt-1 list-group dropdown-menu" style="min-width: 1em"><a class="dropdown-item" data-oper="and">'+gettext("and")+'</a><a class="dropdown-item" data-oper="or">'+gettext("or")+"</a></span>"),andordropdown.on("click",e=>{const i=$(e.target).attr("data-oper");if("and"==i)t.groupOp="AND";else{if("or"!=i)return;t.groupOp="OR"}$("#filteroperand, #filterfield, #andordropdown").remove(),$("#grid").setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration(),grid.getFilterGroup($("#grid"),o,!0,a,o)}),i.append(andordropdown)},showFieldList:function(e,t,a,o){$.jgrid.hideModal("#searchmodfbox_grid"),$("#filteroperand, #filterfield, #andordropdown").remove(),event.stopPropagation(),$(document).on("click",grid.clickFilter);let i=$('<span id="filterfield" class="list-group dropdown-menu">'),r=15;for(var s of $("#grid").jqGrid("getGridParam","colModel")){var n=s.searchoptions;if(n&&n.sopt){if("addsearch"==e.id)var l=$('<a class="dropdown-item" onclick="grid.addFilter(event)" />');else(l=$('<a class="dropdown-item" />')).on("click",e=>grid.setFilterField(e,t,a,o));if(l.attr("data-filterfield",s.name),l.attr("data-filterlabel",s.label),l.html(s.label),i.append(l),--r<=0)break}}$(e).before(i)},showOperandsList:function(e,t,a,o){$.jgrid.hideModal("#searchmodfbox_grid"),$("#filteroperand, #filterfield, #andordropdown").remove(),event.stopPropagation(),$(document).on("click",grid.clickFilter);let i=$(e).closest(".badge").find("span[data-colname]").attr("data-colname"),r=$("#grid").jqGrid("getGridParam","colModel").filter(e=>e.name==i)[0],s=$('<span id="filteroperand" class="list-group dropdown-menu">'),n=r.searchoptions;if(n&&n.sopt){for(let e of n.sopt){let i=$('<a class="dropdown-item"/>');i.on("click",e=>grid.setFilterOperand(e,t,a,o)),i.attr("data-operandname",e),i.html(grid.findOperandLabel(e)),s.append(i)}$(e).before(s)}},findOperandLabel(e){for(const t of $.jgrid.locales[$.jgrid.defaults.locale].search.odata)if(t.oper==e)return t.text;return"ico"==e?gettext("is child of"):e},keyDownSearch:function(){13==(event.keyCode?event.keyCode:event.which)&&grid.addFilter()},updateFilter:function(e,t,a){if(e instanceof Array)for(var o in e)grid.updateFilter(e[o],t,a);else if("object"==typeof e)for(var o in e)"filtercount"==o&&e[o]==t?e.data=a:e.hasOwnProperty(o)&&grid.updateFilter(e[o],t,a)},removeFilter:function(e,t){if(e instanceof Array)for(var a in e)e[a].filtercount==t?e.splice(a,1):e[a].filtercount>t?--e[a].filtercount:grid.removeFilter(e[a],t);else if("object"==typeof e)for(var a in e)e.hasOwnProperty(a)&&grid.removeFilter(e[a],t)},getFilterRule:function(e,t,a,o){var i,r,s=e.jqGrid("getGridParam","colModel");for(i=0;i<s.length;i++)if(s[i].name===t.field||s[i].field_name===t.field){r=s[i];break}if(void 0!=r){var n=$("<span data-colname="+r.name+" data-collabel="+r.label+' style="cursor: pointer">'+r.label+"</span>");n.on("click",e=>grid.showFieldList(e.target,t,a,o));var l=$("<span data-operandname="+t.op+' style="cursor: pointer;">'+grid.findOperandLabel(t.op)+"</span>");l.on("click",e=>grid.showOperandsList(e.target,t,a,o));var d=$('<span class="badge dropdown"></span>');d.append(n),d.append("&nbsp;"),d.append(l),d.append("&nbsp;");var c=$('<input class="form-control" style="width: 2.4em">');t.filtercount=grid.countFilters++,c.val(t.data),c.attr("style","width: "+Math.min(.5*(t.data.length+4),20)+"em"),c.on({input:function(e){this.style.width=Math.min(.5*($(e.target).val().length+4),20)+"em"},change:function(a){grid.updateFilter(o,t.filtercount,$(a.target).val()),e.setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),"function"==typeof extraSearchUpdate&&extraSearchUpdate(o),grid.saveColumnConfiguration()}}),d.append(c),d.append("&nbsp;");var p=$('<span class="fa fa-times"/>');p.on("click",function(i){grid.removeFilter(o,t.filtercount),grid.getFilterGroup(e,o,!0,a,o),e.setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),"function"==typeof extraSearchUpdate&&extraSearchUpdate(o),grid.saveColumnConfiguration()}),d.append(p),a.append(d)}},getFilterGroup:function(e,t,a,o,i){if(a?(o.html(""),i=t,grid.countFilters=0):o.append("( "),null!==t&&void 0!==t&&void 0!==t.groups)for(var r=0;r<t.groups.length;r++){if(o.html().length>2)(s=$('<span class= "d-inline-block dropdown p-1" style="cursor: pointer"><span class="dropdown-toggle">'+gettext("OR"===t.groupOp?"or":"and ")+"</span></span>")).on("click",e=>grid.setFilterAndOr(e,t,o,i)),o.append(s);grid.getFilterGroup(e,t.groups[r],!1,o,i)}if(null!==t&&void 0!==t&&void 0!==t.rules)for(r=0;r<t.rules.length;r++){var s;if(o.html().length>2)(s=$('<span class="d-inline-block dropdown p-1" style="cursor: pointer"><span>'+gettext("OR"===t.groupOp?"or":"and")+"</span></span>")).on("click",e=>grid.setFilterAndOr(e,t,o,i)),o.append(s);grid.getFilterRule(e,t.rules[r],o,i)}a||o.append("&nbsp;)")},markSelectedRow:function(e){void 0!==e&&e>0?($("#delete_selected, #copy_selected, #edit_selected").prop("disabled",!1),$("#actions").length&&$("#actions1").prop("disabled",!1)):($("#delete_selected, #copy_selected, #edit_selected").prop("disabled",!0),$("#actions").length&&$("#actions1").prop("disabled",!0))},markAllRows:function(){$(this).is(":checked")?($("#copy_selected, #delete_selected, #edit_selected").prop("disabled",!1),$("#gridactions").prop("disabled",!1),$(".cbox").prop("checked",!0)):($("#copy_selected, #delete_selected, #edit_selected").prop("disabled",!0),$("#gridactions").prop("disabled",!0),$(".cbox").prop("checked",!1))},displayMode:function(e){var t=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href;location.search.length>0?t=t.replace("&mode=table","").replace("&mode=graph","").replace("mode=table","").replace("mode=graph","")+"&mode="+e:"?"==t.charAt(t.length-1)?t+="mode="+e:t+="?mode="+e,window.location.href=t},findCrossByName:function(e){for(var t in cross)if(cross[t].key==e)return parseInt(t);return-1},expandCross:function(e,t){var a=[];if($(e).hasClass("fa-plus-square-o")){var o=[t];for(var i of cross[t].expand){(r=grid.findCrossByName(i))>0&&o.push(r)}for(var r of cross_idx)r==t?a=a.concat(o):o.includes(r)||a.push(r)}else for(var r of cross_idx)if(cross[t].expand&&!cross[t].expand.includes(cross[r].key)){var s=!0;for(var i of cross[t].expand){var n=grid.findCrossByName(i);cross[n].expand&&cross[n].expand.includes(cross[r].key)&&(s=!1)}s&&a.push(r)}$(e).toggleClass("fa-plus-square-o").toggleClass("fa-minus-square-o"),cross_idx=a;var l=$("#grid");l.jqGrid("setFrozenColumns"),l.trigger("reloadGrid"),l.setGridWidth($("#content-main").width()),grid.saveColumnConfiguration()},showUpdate:function(e){hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid");var t=$("#grid"),a=t.jqGrid("getGridParam","colModel").sort((e,t)=>(e.label||"").localeCompare(t.label||"")),o=t.jqGrid("getGridParam","selarrrow"),i=o.length,r={update:{fields:{}}};if(i&&i!=t.jqGrid("getGridParam","reccount"))r.update.pk=o;else{i=t.jqGrid("getGridParam","records");var s=$("#grid").getGridParam("postData");r.update.filter=s?void 0!==s.filters&&s.filters.rules!=[]?JSON.parse(s.filters):{}:initialfilter}var n='<div class="modal-dialog modal-lg"><div class="modal-content">';for(var l of(n+='<div class="modal-header"><h5 class="modal-title">'+interpolate(gettext("Update %s records"),[i])+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label='+gettext("Close")+'></button></div><div class="modal-body">',n+='<div class="row mb-3"><div class="col">'+gettext("This form allows you update fields for many records.")+"</div></div>",n+='<div class="row d-none mb-3" id="updatefieldtemplate"><div class="col"><select class="form-select">',a))l.editable&&(n+='<option value="'+l.name+'">'+l.label+"</option>");for(var l of(n+='</select></div><div class="col"><input class="form-control" type="text" placeholder="'+gettext("update to")+'"></div><div class="col-auto"><button class="btn btn-sm btn-primary" onclick="grid.deleteUpdateField(event)"><span class="fa fa-trash-o" data-bs-toggle="tooltip" data-bs-placement="top"data-bs-title="'+gettext("Delete")+'"></span></button></div></div>',n+='<div class="row mb-3 updatefield"><div class="col"><select class="form-select">',a))l.editable&&(n+='<option value="'+l.name+'">'+l.label+"</option>");n+='</select></div><div class="col"><input class="form-control" type="text" placeholder="'+gettext("update to")+'"></div><div class="col-auto"><button class="btn btn-sm btn-primary" onclick="grid.deleteUpdateField(event)"><span class="fa fa-trash-o" data-bs-toggle="tooltip" data-bs-placement="top"data-bs-title="'+gettext("Delete")+'"></span></button></div></div>',n+='<div class="row"><div class="col-auto ms-auto"><button class="btn btn-sm btn-primary" id="addCustbutton" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Add"><span class="fa fa-plus"></span></button></div></div>',n+='</div><div class="modal-footer justify-content-between"><input type="submit" id="cancelCustbutton" role="button" class="btn btn-gray" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="updateCustbutton" role="button" class="btn btn-primary" value="'+gettext("Update")+'"></div></div></div>',$("#popup").html(n),showModal("popup"),$("#addCustbutton").on("click",function(e){var t=$("#updatefieldtemplate").clone();t.removeAttr("id"),t.insertBefore($(e.target).closest(".row")),t.toggleClass("d-none updatefield"),bootstrap.Tooltip.getOrCreateInstance(t.find('[data-bs-toggle="tooltip"]')[0]),e.preventDefault()}),$("#updateCustbutton").on("click",function(){for(var t of $("div.modal-body .updatefield")){var a=$(t).find("select :selected").val(),o=$(t).find("input.form-control").val();r.update.fields[a]=""==o?null:o}$.ajax({url:e,data:JSON.stringify(r),type:"POST",contentType:"application/json",success:function(){window.location.href=window.location.href},error:ajaxerror})})},deleteUpdateField:function(e){$(e.target).closest(".row").remove(),e.preventDefault()}},favorite={check:function(){var e=$("#favoritename").val();return e.length>0&&("undefined"!=typeof favorites&&!(e in favorites)||"undefined"!=typeof preferences&&!("favorites"in preferences)||"undefined"!=typeof preferences&&"favorites"in preferences&&!(e in preferences.favorites))?($("#favoritesave").prop("disabled",!1),!0):($("#favoritesave").prop("disabled",!0),!1)},save:function(){var e=$("#favoritename").val();if(favorite.check()){favorites[e]=grid.getGridConfig(),grid.saveColumnConfiguration();var t=$("#favoritelist li.divider");0==t.length&&($("#favoritelist").prepend('<li role="separator" class="divider"></li>'),t=$("#favoritelist li.divider"));var a=$("<li></li>"),o=$('<a class="dropdown-item" href="#" onclick="favorite.open(event)"></a>');o.text(e),o.append('<div style="float:right"><span class="fa fa-trash-o" onclick="favorite.remove(event)"></span></div>'),a.append(o),t.before(a),favorite.check()}},remove:function(e){var t=$(e.target).closest("a").text();t in favorites&&confirm(gettext("Click ok to confirm deleting the favorite"))&&(delete favorites[t],grid.saveColumnConfiguration(),$(e.target).closest("li").remove(),$("#favoritename").val(t),favorite.check()),e.stopImmediatePropagation()},open:function(e){var t=$(e.target).parent().text();if(t in favorites){var a=$("#grid"),o=!1,i=!1,r=0,s=a.jqGrid("getGridParam","colModel"),n=favorites[t].frozen;for(var l in s)"graph"==s[l].name?o=!0:"columns"==s[l].name?(i=!0,n=parseInt(l)):"cb"==s[l].name&&(r+=1);for(var d of(o||a.jqGrid("destroyFrozenColumns"),favorites[t].rows))d[1]?a.jqGrid("hideCol",d[0]):a.jqGrid("showCol",d[0]),a.jqGrid("setColWidth",d[0],d[2]);if("crosses"in favorites[t])for(var l of(cross_idx=[],favorites[t].crosses))for(var c in cross)cross[c].key==l&&cross_idx.push(parseInt(c));var p,u=[];for(var f of favorites[t].rows)f[1]||(u.push(f[0]),a.jqGrid("setColProp",f[0],{frozen:u.length<n+r}));if(i)for(var c of s)"counter"in c?c.frozen=!0:(u.push(c.name),c.frozen="columns"==c.name);for(var g of s)u.includes(g.name)||"cb"==g.name||u.push(g.name);a.jqGrid("remapColumnsByName",u,!0,!1),"filter"in favorites[t]&&""!=favorites[t].filter?(a.setGridParam({postData:{filters:favorites[t].filter},search:!0}),grid.getFilterGroup($("#grid"),JSON.parse(favorites[t].filter),!0,$("#curfilter"))):(a.setGridParam({postData:{filters:""},search:!0}),$("#curfilter").html("")),"sord"in favorites[t]&&"sidx"in favorites[t]?(a.setGridParam({sortname:favorites[t].sidx,sortorder:favorites[t].sord}),p=(favorites[t].sidx+" "+favorites[t].sord).split(",")):(a.setGridParam({sortname:"",sortorder:"asc"}),p=default_sort.split(","));var h=a.jqGrid("getGridParam");for(var g of h.colModel){(m=$("#"+h.id+"_"+g.name)).find("span.s-ico").css("display","none"),m.find("span.ui-grid-ico-sort").addClass("disabled"),m.find("span.ui-jqgrid-sort-order").html("&nbsp;"),g.lso=""}for(var g in p){var m,v=p[g].trim().split(" "),b=v[0].trim();(m=$("#"+h.id+"_"+b)).find("span.s-ico").css("display",""),"asc"==v[1].trim()?(m.find("span.ui-icon-asc").removeClass("disabled"),h.colModel[h.iColByName[b]].lso="asc-desc"):(m.find("span.ui-icon-desc").removeClass("disabled"),h.colModel[h.iColByName[b]].lso="desc-asc"),m.find("span.ui-jqgrid-sort-order").html(parseInt(g)+1)}o||a.jqGrid("setFrozenColumns"),a.trigger("reloadGrid"),a.setGridWidth($("#content-main").width()),grid.saveColumnConfiguration()}}},ERPconnection={IncrementalExport:function(e,t){var a=e.jqGrid("getGridParam","selarrrow");if(null!==a&&0!=a.length){var o=[];for(var i in a){var r=e.jqGrid("getRowData",a[i]);void 0===r.type&&(r.type=t),["proposed","approved","confirmed"].includes(r.status||r.operationplan__status)&&o.push(r)}o!=[]&&(hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-capitalize">'+gettext("Export")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body pb-0"><p>'+gettext("Export selected records?")+'</p></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray text-capitalize" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="button_export" role="button" class="btn btn-primary text-capitalize" value="'+gettext("Confirm")+'"></div></div></div>'),showModal("popup"),document.getElementById("popup").addEventListener("hidden.bs.modal",e=>{$("#noactionselected").prop("selected",!0)},{once:!0}),$("#button_export").on("click",function(){if($("#button_export").val()!==gettext("Close")){var t=gettext("connecting");$("#popup .modal-body p").html(String(t).charAt(0).toUpperCase()+String(t).slice(1)+"..."),$.ajax({url:url_prefix+"/erp/upload/",data:JSON.stringify(o),type:"POST",contentType:"application/json",success:function(t,o,i){if($("#cancelbutton").addClass("invisible"),$("#button_export").val(gettext("Close")),204==i.status)return $("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),void $("#popup .modal-body p").html(gettext("No valid records selected"));var r=[];for(var s in $("#popup .modal-body p").html(gettext("Export successful")),a){var n=e.jqGrid("getCell",a[s],"operationplan__status");if("proposed"===n){var l=e.jqGrid("getCell",a[s],"operationplan__type");["STCK","DLVR"].includes(l)||(e.jqGrid("setCell",a[s],"operationplan__status","approved"),(r=e.jqGrid("getRowData",a[s])).operationplan__status="approved")}else n||"proposed"===(n=e.jqGrid("getCell",a[s],"status"))&&(e.jqGrid("setCell",a[s],"status","approved"),(r=e.jqGrid("getRowData",a[s])).status="approved")}e.jqGrid("setRowData",r),"function"==typeof checkrows&&checkrows(e,a)},error:function(e){401!=e.status?($("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body p").html(e.responseText),$("#button_export").val(gettext("retry"))):location.reload()}})}else hideModal("popup")}),$("#actions").length&&$("#actions1 span").text($("#actionsul").children().first().text()))}},SODepExport:function(e,t){const a=e.jqGrid("getGridParam","selarrrow");if(null===a||0==a.length)return;const o=[];for(let i in a){let r=e.jqGrid("getRowData",a[i]);void 0===r.type&&(r.type=t),o.push(r)}const i=window.grid.formatNumber;hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog modal-xl"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-capitalize">'+gettext("Export")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>'+gettext("Export selected records?")+'</p></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="button_export" role="button" class="btn btn-primary" value="'+gettext("Confirm")+'"></div></div></div>'),showModal("popup"),document.getElementById("popup").addEventListener("hidden.bs.modal",e=>{$("#noactionselected").prop("selected",!0)},{once:!0});let r="?demand=";for(let o=0;o<a.length;o++){const i=e.jqGrid("getRowData",a[o]);void 0===i.type&&(i.type=t),"open"!=i.status&&"proposed"!=i.status||(r+=0==o?encodeURIComponent(a[o]):"&demand="+encodeURIComponent(a[o]))}$.ajax({url:url_prefix+"/demand/operationplans/"+r,type:"GET",contentType:"application/json",success:function(t){if(0===t.PO.length&&0===t.MO.length&&0===t.DO.length)return $("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+gettext("There are no purchase, distribution or manufacturing orders for export that are linked to this sales order")+"</div>"),void $("#button_export").addClass("d-none");$("#popup .modal-body").html('<div id="PO-title"><h5 class="text-capitalize">'+gettext("purchase orders")+'</h5></div><div id="PO-data" class="table-responsive"><table class="table table-hover text-center" id="exporttable_PO"><thead class="thead-default"></thead></table></div><div id="MO-title"><h5 class="text-capitalize">'+gettext("manufacturing orders")+'</h5></div><div id="MO-data" class="table-responsive"><table class="table table-hover text-center" id="exporttable_MO"><thead class="thead-default"></thead></table></div><div id="DO-title"><h5 class="text-capitalize">'+gettext("distribution orders")+'</h5></div><div id="DO-data" class="table-responsive"><table class="table table-hover text-center" id="exporttable_DO"><thead class="thead-default"></thead></table></div>');let o=[],r=0;for(const e of["PO","DO","MO"]){if(0===t[e].length){$("#"+e+"-title, #"+e+"-data").addClass("d-none");continue}o.length=0;let a=$("<tr/>");a.append($("<th/>").html('<input id="cb_modaltableall_'+e+'" class="cbox" type="checkbox" aria-checked="true" checked>')),o.push(...t[e][0].map(e=>e[0]));for(const i in o)t[e][0][i][2]||a.append($("<th/>").addClass("text-capitalize").text(o[i]));const n=$("<tbody/>");for(let a=0;a<t[e].length;a++){const l=$("<tr/>").attr("orderreference",t[e][a][0][1]).attr("ordertype",e),d=$("<td/>");d.append($("<input/>").attr({id:"cb_modaltable_"+e+"-"+a,class:"cbox align-middle",type:"checkbox","aria-checked":"true",checked:"true"})),l.append(d);for(let n=0;n<o.length;n++)t[e][a][n][2]||("quantity"==t[e][a][n][0]?l.append($('<td class="align-middle"/><input type="number" value="'+parseFloat(t[e][a][n][1])+'" id="quantity'+r+'"/>')):"receipt date"===t[e][a][n][0]||"end date"===t[e][a][n][0]?l.append($('<td class="align-middle"/><input type="datetime-local" value="'+t[e][a][n][1]+'" title="due date" required="" id="due'+r+'"></modal_table_row_indexnput>')):"supplier"==t[e][a][n][0]?l.append($('<td class="align-middle"/><input type="text" value="'+t[e][a][n][1]+'" title="supplier" required="" id="supplier'+r+'"></input>')):l.append($('<td class="align-middle"/>').text("number"===(s=t[e][a][n])[3]?i(s[1]):"text"===s[3]?s[1]:"date"===s[3]?moment(s[1]).format(dateformat):s[1])));n.append(l),r++}$("#popup #exporttable_"+e).append(n),$("#popup #exporttable_"+e+" thead").append(a),$("#cb_modaltableall_"+e).click(function(){$("#cb_modaltableall_"+e).prop("checked")?$("#exporttable_"+e+" input[type=checkbox]").prop("checked",$(this).prop("checked")):($("#exporttable_"+e+" tbody tr input:not(:checked)").prop("checked",!0),$("#exporttable_"+e+" tbody tr input:not(:checked)").parent().parent().removeClass("active").addClass("active")),$("#exporttable_"+e+" input[type=checkbox]").prop("checked",$(this).prop("checked")),$("#popup .modal-body tbody input[type=checkbox]:checked").length>0?$("#button_export").prop("disabled",!1):$("#button_export").prop("disabled",!0)}),$("#exporttable_"+e+" tbody input[type=checkbox]").click(function(){$(this).parent().parent().toggleClass("selected"),$("#cb_modaltableall_"+e).prop("checked",0==$("#exporttable_"+e+" tbody input[type=checkbox]:not(:checked)").length),$("#popup .modal-body tbody input[type=checkbox]:checked").length>0?$("#button_export").prop("disabled",!1):$("#button_export").prop("disabled",!0)})}var s;$("#button_export").on("click",function(){const t=[];const o=$("#popup .modal-body tbody input[type=checkbox]:checked").parent().parent();index=0;for(const e of o){let a=".modal-body #due"+index,o=".modal-body #quantity"+index,i=".modal-body #supplier"+index;newDate=16===$(a).val().length?$(a).val()+":00":$(a).val(),t.push({reference:e.attributes.orderreference.value,type:e.getAttribute("ordertype"),quantity:Number($(o).val()),enddate:newDate,supplier:$(i).val()}),index++}$("#popup .modal-body").html(gettext("connecting")+"..."),$.ajax({url:url_prefix+"/erp/upload/",data:JSON.stringify(t),type:"POST",contentType:"application/json",success:function(){for(var t in $("#popup .modal-body").html(gettext("Export successful")),$("#cancelbutton").val(gettext("Close")),$("#button_export").prop("disabled",!0),a){"proposed"==e.jqGrid("getCell",a[t],"status")&&e.jqGrid("setCell",a[t],"status","approved")}},error:function(e,t,a){401!=e.status?($("#popup .modal-title").html(gettext("Error during export")),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+e.responseText+"</div>"),$("#button_export").val(gettext("Retry")),$("#popup .modal-dialog").css({visibility:"visible"}),$("#popup").modal("show")):location.reload()}})}),$("#actions").length&&$("#actions1 span").text($("#actionsul").children().first().text()),$("#DRPactions").length&&$("#DRPactions1 span").text($("#DRPactionsul").children().first().text())},error:function(e,t,a){401!=e.status?($("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+e.responseText+"</div>"),$("#button_export").val(gettext("Retry")),$("#popup .modal-dialog").css({visibility:"visible"}),$("#popup").modal("show")):location.reload()}})}},widget={init:function(e){$(".widget-list").each(function(){Sortable.create($(this)[0],{group:"widgets",handle:".widget-handle",animation:100,onEnd:e})})},getConfig:function(){var e=[];return $(".widget-list").each(function(){var t={name:$(this).attr("data-widget")||"",cols:[{width:$(this).attr("data-widget-width")||12,widgets:[]}]};$(this).find(".widget").each(function(){t.cols[0].widgets.push([$(this).attr("data-widget")||"",{collapsed:0==$(this).find(".collapse.show").length}])}),e.push(t)}),e}},dashboard={save:function(e){var t=[];if($("[data-cockpit-row]").each(function(){var e=$(this).attr("data-cockpit-row"),a=[];$(".cockpitcolumn",this).each(function(){var e=[];$("[data-cockpit-widget]",this).each(function(){e.push([$(this).attr("data-cockpit-widget"),{}])}),a.push({width:12,widgets:e})}),a.length>0&&t.push({rowname:e,cols:a})}),"undefined"!=typeof url_prefix)var a=url_prefix+"/settings/";else a="/settings/";$.ajax({url:a,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({"freppledb.common.cockpit":t}),success:function(){"string"===$.type(e)&&(window.location.href=window.location.href)},error:ajaxerror})},customize:function(e){for(var t='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">'+gettext("Customize a dashboard row")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form class="form-horizontal"><div class="row mb-3"><label class="col-3 col-form-label" for="id_name" class="col-form-label">'+gettext("Name")+':</label><div class="col-9"><input id="id_name" class="form-control" type="text" value="'+e+'"></div></div><div class="row mb-3"><label class="col-3 col-form-label" for="id_widget2" class="col-form-label">'+gettext("Add widget")+':</label><div class="col-9 dropdown"><button class="form-control dropdown-toggle w-100" id="id_widget2" type="button" data-bs-toggle="dropdown"><span id="id_widget">-</span>&nbsp;<span class="caret"></span></button><ul class="dropdown-menu col-9" aria-labelledby="id_widget2" id="id_widgetul">',a=hiddenwidgets.length,o=0;o<a;o++)t+='<li><a class="dropdown-item" onclick="dashboard.setwidget('+o+')">'+hiddenwidgets[o][1]+"</a></li>";t+='</ul></div><span id="newwidgetname" style="display:none"></span></div></form></div><div class="modal-footer d-flex"><input type="submit" role="button" onclick=\'dashboard.saveCustomization("'+e+'")\' class="btn btn-primary flex-fill mx-1" value="'+gettext("Save")+'"><input type="submit" role="button" onclick=\'dashboard.addRow("'+e+'", false)\' class="btn btn-primary flex-fill mx-1" value="'+gettext("Add new below")+'"><input type="submit" role="button" onclick=\'dashboard.addRow("'+e+'", true)\' class="btn btn-primary flex-fill mx-1" value="'+gettext("Add new above")+'"><input type="submit" role="button" onclick=\'dashboard.deleteRow("'+e+'")\' class="btn btn-danger flex-fill mx-1" value="'+gettext("Delete")+'"></div></div></div></div>',$("#popup").html(t),showModal("popup")},setwidget:function(e){$("#id_widget").text(hiddenwidgets[e][1]),$("#newwidgetname").text(hiddenwidgets[e][0])},saveCustomization:function(e){var t=$("#id_name").val();if(e!=t){for(var a=2;$("[data-cockpit-row='"+t+"']").length>1;)t=$("#id_name").val()+" - "+a++;$("[data-cockpit-row='"+e+"'] h1 button").attr("onclick","dashboard.customize('"+t+"')"),$("[data-cockpit-row='"+e+"']").attr("data-cockpit-row",t)}var o=$("#newwidgetname").text();""!=o&&$('<div class="card widget h-100"></div>').attr("data-cockpit-widget",o).appendTo($("[data-cockpit-row='"+e+"'] .cockpitcolumn").last()),dashboard.save("true"),hideModal("popup")},deleteRow:function(e){$("[data-cockpit-row='"+e+"']").remove(),dashboard.save(),hideModal("popup")},addRow:function(e,t){for(var a=$("#id_name").val(),o=2;$("[data-cockpit-row='"+$.escapeSelector(a)+"']").length>=1;)a=$("#id_name").val()+" - "+o++;var i='<div data-cockpit-row="'+a+'">';i+='<div class="row mt-3"><div class="col-auto"><h1 style="float: left; cursor: move; text-transform: capitalize">'+a+'</h1></div><div class="col-auto ms-auto"><h1><button class="btn btn-sm btn-primary" onclick="dashboard.customize(\''+a+'\')"><span class="fa fa-wrench"></span></button></h1></div></div>';var r=$("#newwidgetname").text();i+='<div class="row cockpitcolumn widget-list g-3"><div class="cockpitwidget-4 mb-3">',""!=r&&(i+='<div class="card widget h-100" data-cockpit-widget="'+r+'"></div>'),i+="</div></div>",i+="</div>",t?$("[data-cockpit-row='"+$.escapeSelector(e)+"']").first().before($(i)):$("[data-cockpit-row='"+$.escapeSelector(e)+"']").last().after($(i)),""!=r?dashboard.save("true"):dashboard.save(),hideModal("popup")}};function savePreference(e,t,a){if("undefined"!=typeof url_prefix)var o=url_prefix+"/settings/";else o="/settings/";var i={};i[e]=t,$.ajax({url:o,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(i),success:function(){"function"==typeof a&&a()}})}function getUnreadMessages(){var e=$("#messages");e.length&&$.ajax({url:url_prefix+"/inbox/",type:"GET",contentType:"application/json",success:function(t){var a=e.parent().parent();t.unread?(e.removeClass("fa-envelope-open-o").addClass("fa-envelope-o"),e.next().text(t.unread),a.attr("data-bs-title",interpolate(gettext("%s unread messages"),[t.unread]))):(e.removeClass("fa-envelope-o").addClass("fa-envelope-open-o"),e.next().text(""),a.attr("data-bs-title",gettext("No unread messages")));var o=bootstrap.Tooltip.getInstance(a);o&&o.dispose(),bootstrap.Tooltip.getOrCreateInstance(a)}})}function getCookie(e){for(var t=document.cookie.split(";"),a=e+"=",o=t.length;o>=0;o--)if(0==jQuery.trim(t[o]).indexOf(a))return jQuery.trim(t[o]).substr(a.length);return null}function setCookie(e,t,a){var o="";if(a){var i=new Date;i.setTime(i.getTime()+24*a*60*60*1e3),o="; expires="+i.toUTCString()}document.cookie=e+"="+(t||"")+o+"; path=/"}function sameOrigin(e){var t="//"+document.location.host,a=document.location.protocol+t;return e==a||e.slice(0,a.length+1)==a+"/"||e==t||e.slice(0,t.length+1)==t+"/"||!/^(\/\/|http:|https:).*/.test(e)}function about_show(){$.ajax({url:"/about/",type:"GET",contentType:"application/json",success:function(e){hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),content='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">About frePPLe</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="row mb-3"><div class="col-6 fw-bold">Version</div><div class="col-6">'+e.version+" "+e.edition+'</div></div><div class="row mb-3"><div class="col-6 fw-bold">Storage</div><div class="col-6'+(e.storage_exceeded?" text-danger":"")+'">'+e.storage_used+" used",e.storage_allocation&&(content+=" of "+e.storage_allocation+" allocated"),content+='</div ></div > <div class="row"><div class="col-6 fw-bold">Active item locations</div><div class="col-6"><table class="table table-sm table-borderless">';for(const[t,a]of Object.entries(e.itemlocations))content+="<tr><td>"+t+"</td><td>"+a+"</td></tr>";for(var t of(content+='</table></div></div> <div class="row mb-3"><div class="col-6 fw-bold">Installed apps</div><div class="col-6">',e.apps))content+=t+"<br>";content+="</div></div></div></div></div>",$("#popup").html(content),showModal("popup")},error:ajaxerror})}function containsObject(e,t){var a;for(a=0;a<t.length;a++)if(t[a]===e)return!0;return!1}function showModal(e,t=!0,a=null){var o,i=document.getElementById(e);t&&((o=bootstrap.Modal.getInstance(i))&&o.dispose());(o=a?bootstrap.Modal.getOrCreateInstance(i,a):bootstrap.Modal.getOrCreateInstance(i)).show()}function hideModal(e){var t=document.getElementById(e),a=bootstrap.Modal.getInstance(t);a&&a.hide()}function import_show(e,t,a,o,i,r){console.log(3200,e,t,a);var s={abort:function(){}};console.log(3202,e,t,a),hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid");var n='<div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"><span id="modal_title">'+gettext("Import CSV or Excel file")+'</span>&nbsp;<span id="animatedcog" class="fa fa-cog fa-spin fa-2x fa-fw" style="visibility: hidden;"></span></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form id="uploadform"><p id="extra_text">'+gettext("Load an Excel file or a CSV-formatted text file.")+"<br>"+gettext("The first row should contain the field names.")+'<br><br><input class="form-check-input" type="checkbox" autocomplete="off" name="erase" value="yes" id="eraseBeforeImport"/><label for="eraseBeforeImport">&nbsp;&nbsp;'+gettext("First delete all existing records AND ALL RELATED TABLES")+"</label><br></p>";isDragnDropUploadCapable()?n+='<div class="box" style="outline: 2px dashed black; outline-offset: -1em"><div class=text-center box__input" style="text-align: center; padding: 20px;"><input class="box__file d-none" type="file" id="csv_file" name="csv_file" data-multiple-caption="{count} '+gettext("files selected")+'" multiple/><label class="d-block p-3" id="uploadlabel" for="csv_file"><a class="btn btn-primary">'+gettext("Select files to upload")+"</a>&nbsp;"+gettext("or drop them here")+'<i class="fa fa-sign-in fa-2x fa-rotate-90"></i></label></div><div class="d-none box__uploading" style="display: none;">Uploading&hellip;</div><div class="d-none box__success" style="display: none;">Done!</div><div class="box__error" style="display: none;">Error!<span></span>.</div></div>':n+=gettext("Data file")+':<input type="file" id="csv_file" name="csv_file"/>',n+='<br></form><div style="margin: 5px 0"><div id="uploadResponse" style="height: 50vh; resize: vertical; display: none; background-color: inherit; border: none; overflow: auto;"></div></div></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray pull-left" data-bs-dismiss="modal" value="'+gettext("Close")+'"><input type="submit" id="copytoclipboard" role="button" class="btn btn-gray pull-left" value="'+gettext("Copy to clipboard")+'" style="display: none;"><input type="submit" id="importbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Import")+'"><input type="submit" id="cancelimportbutton" role="button" class="btn btn-primary pull-left" value="'+gettext("Cancel Import")+'" style="display: none;"></div></div></div>',$("#popup").html(n),console.log(3254,n),showModal("popup"),""!==e&&$("#modal_title").text(e),void 0!==r&&$("#importbutton").val(r),null===t?$("#extra_text").remove():""!==t&&$("#extra_text").text(t);var l=!1,d=!1;isDragnDropUploadCapable()&&$(".box").on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){$(".box").removeClass("bg-warning").addClass("bg-warning")}).on("dragleave dragend drop",function(){$(".box").removeClass("bg-warning")}).on("drop",function(e){l=a?e.originalEvent.dataTransfer.files:[e.originalEvent.dataTransfer.files[0]],$("#uploadlabel").text(l.length>1?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",l.length):l[0].name)}),$("#csv_file").on("change",function(e){d=a?e.target.files:[e.target.files[0]],$("#uploadlabel").text(d.length>1?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",d.length):d[0].name)}),null!==i&&void 0!==i&&(l=a?i:[i[0]],$("#uploadlabel").text(l.length>1?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",l.length):l[0].name)),$("#importbutton").on("click",function(){if(""!==$("#csv_file").val()||l){var e="";$("#uploadResponse").css("display","block"),$("#uploadResponse").html(gettext("Importing...")),$("#uploadResponse").on("scroll",function(){parseInt($("#uploadResponse").attr("data-scrolled"))!==$("#uploadResponse").scrollTop()&&($("#uploadResponse").attr("data-scrolled",!0),$("#uploadResponse").off("scroll"))}),$("#importbutton").hide(),$("#animatedcog").css("visibility","visible"),$("#uploadform").css("display","none"),$("#copytoclipboard").on("click",function(){$("#uploadResponse").find("tr.hidden").remove(),navigator.clipboard.writeText($("#uploadResponse").prop("innerText"))}),$("#cancelimportbutton").show().on("click",function(){$("#uploadResponse").append("<div><strong>"+gettext("Canceled")+"</strong></div>"),s.abort(),$("#animatedcog").css("visibility","hidden"),$("#uploadResponse").append(theclone.contents()),$("#uploadResponse").scrollTop($("#uploadResponse")[0].scrollHeight),$("#cancelimportbutton").hide(),$("#copytoclipboard").show()}),e=new FormData($("#uploadform")[0]),l&&$.each(l,function(t,a){e.append(a.name,a)}),d&&(e.delete("csv_file"),$.each(d,function(t,a){e.append(a.name,a)})),s=$.ajax(Object.assign({type:"post",url:"undefined"!=typeof url?url:"",cache:!1,data:e,success:function(e){var t=$("#uploadResponse");t.html(e),"true"!==t.attr("data-scrolled")&&t.scrollTop(t[0].scrollHeight-t.height()),$("#cancelbutton").html(gettext("Close")),$("#importbutton").hide(),$("#animatedcog").css("visibility","hidden"),$("#cancelimportbutton").hide(),document.queryCommandSupported("copy")&&$("#copytoclipboard").show(),$("#grid").trigger("reloadGrid")},xhrFields:{onprogress:function(e){var t=$("#uploadResponse");t.html(e.currentTarget.response);var a=t.find(".recordcount").last(),o=t.find("[data-cnt]").last().attr("data-cnt");a.text(interpolate(gettext("%s records processed"),[o])),"true"!==t.attr("data-scrolled")&&(t.attr("data-scrolled",t[0].scrollHeight-t.height()),t.scrollTop(t[0].scrollHeight-t.height()))}},error:function(e,t,a){401!=e.status?($("#cancelimportbutton").hide(),$("#copytoclipboard").show(),$("#animatedcog").css("visibility","hidden"),$("#uploadResponse").scrollTop($("#uploadResponse")[0].scrollHeight)):location.reload()},processData:!1,contentType:!1},o))}})}function getURLparameters(){if(0==window.location.search.length)return{};var e={};return jQuery.each(window.location.search.match(/^\??(.*)$/)[1].split("&"),function(t,a){(a=a.split("="))[1]=unescape(a[1]).replace(/\+/g," "),e[a[0]]=e[a[0]]?e[a[0]]instanceof Array?(e[a[0]].push(a[1]),e[a[0]]):[e[a[0]],a[1]]:a[1]}),e}function selectDatabase(e){var t=e.getAttribute("data-database");database!=t&&("default"==database?"/"==window.location.pathname?window.location.href="/"+t+"/":window.location.href=window.location.href.replace(window.location.pathname,"/"+t+window.location.pathname):window.location.href="default"==t?window.location.href.replace("/"+database+"/","/"):window.location.href.replace("/"+database+"/","/"+t+"/"))}$(function(){$(document).ajaxSend(function(e,t,a){!/^(GET|HEAD|OPTIONS|TRACE)$/.test(a.type)&&sameOrigin(a.url)&&t.setRequestHeader("X-CSRFToken",getCookie("csrftoken"))}),$.ajaxSetup({cache:!1}),getUnreadMessages();var e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:url_prefix+"/search/?term=%QUERY",wildcard:"%QUERY"}});$(".search-input").typeahead({minLength:2},{limit:1e3,highlight:!0,name:"search",display:"value",source:e,templates:{suggestion:function(e){if(null===e.value)return'<span><p style="margin-top: 5px; margin-bottom: 1px;">'+$.jgrid.htmlEncode(e.label)+'</p><li  role="separator" class="divider"></li></span>';var t=url_prefix+e.url;return e.removeTrailingSlash?t+=encodeURIComponent(e.value):t+=admin_escape(e.value)+"/?noautofilter",'<li><a href="'+t+'" >'+$.jgrid.htmlEncode(e.display)+'</a><div class="tt-external"><a target="_blank" href="'+t+'"><i class="fa fa-external-link" aria-hidden="true"></i></a></div></li>'}}})}),$.fn.bindFirst=function(e,t){this.on(e,t),this.each(function(){var t=$._data(this,"events")[e.split(".")[0]],a=t.pop();t.splice(0,0,a)})};var graph={header:function(e,t){var a=$("#grid_graph");a.html("");var o=t.range(),i=t.rangeBand(),r=d3.select(a.get(0)).append("svg");r.attr("height","15px"),r.attr("width",Math.max(a.width(),0));var s=0;for(var n in timebuckets){var l=e+o[n]+i/2;if(s<=l)s=l+r.append("text").attr("class",timebuckets[n].history?"svgheaderhistory":"svgheadertext").attr("x",l).attr("y","12").attr("data-bucket",n).text(timebuckets[n].name).on("mouseenter",function(e){var t=parseInt($(this).attr("data-bucket")),a="&nbsp;"+timebuckets[t].startdate+" - "+timebuckets[t].enddate+"&nbsp;";graph.showTooltip(a.replaceAll(" 00:00:00",""))}).on("mouseleave",graph.hideTooltip).on("mousemove",graph.moveTooltip).node().getComputedTextLength()+12}},showTooltip:function(e){var t=d3.select("#tooltip");t.empty()&&(t=d3.select("body").append("div").attr("id","tooltip").attr("role","tooltip").attr("class","card p-2").style("position","absolute")),t.html(""+e).style("display","block"),graph.moveTooltip()},hideTooltip:function(){d3.select("#tooltip").style("display","none"),d3.event.stopPropagation()},moveTooltip:function(){var e=d3.event.pageX+5,t=d3.event.pageY-28,a=$(window).width()-$("#tooltip").width()-20,o=$(window).height()-$("#tooltip").height()-20;e>a&&(e=a,t=d3.event.pageY+5),t>o&&(t=d3.event.pageY-$("#tooltip").height()-25),d3.select("#tooltip").style({left:e+"px",top:t+"px"}),d3.event.stopPropagation()},miniAxis:function(e){var t=this.scale().range(),a=this.scale().domain();e.append("path").attr("class","domain").attr("d","M-10 0 H0 V"+(t[0]-2)+" H-10"),e.append("text").attr("x",-2).attr("y",13).attr("text-anchor","end").text(grid.formatNumber(Math.round(a[1]))),e.append("text").attr("x",-2).attr("y",t[0]-5).attr("text-anchor","end").text(Math.round(a[0],0))}},gantt={rowsize:25,header:function(e="#jqgh_grid_operationplans"){var t=viewend.getTime()-viewstart.getTime(),a=864e5/t*$(e).width(),o=(horizonend.getTime()-horizonstart.getTime())/t*$(e).width(),i=['<svg width="'+o+'px" height="34px">','<line class="time" x1="0" y1="17" x2="'+o+'" y2="17"/>'],r=0;if(a<5)for(var s=new Date(horizonstart.getFullYear(),horizonstart.getMonth(),1);s<horizonend;){var n=(s.getTime()-viewstart.getTime())/864e5*a,l=new Date(s.getFullYear(),s.getMonth()+1,1),d=(l.getTime()-viewstart.getTime())/864e5*a;if(i.push('<text class="svgheadertext" x="'+Math.floor((n+d)/2)+'" y="31">'+moment(s).format("MMM")+"</text>"),s.getMonth()%3==0){d=(new Date(s.getFullYear(),s.getMonth()+3,1).getTime()-viewstart.getTime())/864e5*a;var c=Math.floor((s.getMonth()+3)/3);i.push('<line class="time" x1="'+Math.floor(n)+'" y1="0" x2="'+Math.floor(n)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor((n+d)/2)+'" y="13">'+s.getFullYear()+" Q"+c+"</text>")}else i.push('<line class="time" x1="'+Math.floor(n)+'" y1="17" x2="'+Math.floor(n)+'" y2="34"/>');s=l}else if(a<10){r-=horizonstart.getDay()*a;for(s=new Date(horizonstart.getTime()-864e5*viewstart.getDay());s<horizonend;)i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+3.5*a)+'" y="31">'+moment(s).format("MM-DD")+"</text>"),r+=7*a,s.setTime(s.getTime()+6048e5);for(s=new Date(horizonstart.getFullYear(),horizonstart.getMonth(),1);s<horizonend;)n=(s.getTime()-viewstart.getTime())/864e5*a,d=((l=new Date(s.getFullYear(),s.getMonth()+1,1)).getTime()-viewstart.getTime())/864e5*a,i.push('<line class="time" x1="'+Math.floor(n)+'" y1="0" x2="'+Math.floor(n)+'" y2="17"/>'),i.push('<text class="svgheadertext" x="'+Math.floor((n+d)/2)+'" y="13">'+moment(s).format("MMM YY")+"</text>"),s=l}else if(a<20){r-=horizonstart.getDay()*a;for(s=new Date(horizonstart.getTime()-864e5*horizonstart.getDay());s<horizonend;)i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+(r+7*a/2)+'" y="31">'+moment(s).format("YY-MM-DD")+"</text>"),r+=7*a,s.setTime(s.getTime()+6048e5);for(s=new Date(horizonstart.getFullYear(),horizonstart.getMonth(),1);s<horizonend;)n=(s.getTime()-viewstart.getTime())/864e5*a,d=((l=new Date(s.getFullYear(),s.getMonth()+1,1)).getTime()-viewstart.getTime())/864e5*a,i.push('<line class="time" x1="'+Math.floor(n)+'" y1="0" x2="'+Math.floor(n)+'" y2="17"/>'),i.push('<text class="svgheadertext" x="'+Math.floor((n+d)/2)+'" y="13">'+moment(s).format("MMM YY")+"</text>"),s=l}else if(a<=40)for(s=new Date(horizonstart.getTime());s<horizonend;)0==s.getDay()?(i.push('<line class="time" x1="'+Math.floor(r)+'" y1="0" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+7*a/2)+'" y="13">'+moment(s).format("YY-MM-DD")+"</text>")):i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+a/2)+'" y="31">'+moment(s).format("DD")+"</text>"),r+=a,s.setDate(s.getDate()+1);else if(a<=75)for(s=new Date(horizonstart.getTime());s<horizonend;)0==s.getDay()?(i.push('<line class="time" x1="'+Math.floor(r)+'" y1="0" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+7*a/2)+'" y="13">'+moment(s).format("YY-MM-DD")+"</text>")):i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+a/2)+'" y="31">'+moment(s).format("DD MM")+"</text>"),r+=a,s.setDate(s.getDate()+1);else if(a<350)for(s=new Date(horizonstart.getTime());s<horizonend;)0==s.getDay()?(i.push('<line class="time" x1="'+Math.floor(r)+'" y1="0" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+3.5*a)+'" y="13">'+moment(s).format("YY-MM-DD")+"</text>")):i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+a/2)+'" y="31">'+moment(s).format("ddd DD MMM")+"</text>"),r+=a,s.setDate(s.getDate()+1);else for(s=new Date(horizonstart.getTime());s<horizonend;)0==s.getHours()?(i.push('<line class="time" x1="'+Math.floor(r)+'" y1="0" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+a/2)+'" y="13">'+moment(s).format("ddd YY-MM-DD")+"</text>")):i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+a/48)+'" y="31">'+s.getHours()+"</text>"),r+=a/24,s.setTime(s.getTime()+36e5);i.push("</svg>"),$(e).html(i.join(""))},redraw:function(){var e=(horizonend.getTime()-horizonstart.getTime())/(viewend.getTime()-viewstart.getTime())*$("#jqgh_grid_operationplans").width()/1e4;$(".transformer").each(function(){var t=$(this).attr("title");$(this).attr("transform","scale("+e+",1) translate(0,"+((t-1)*gantt.rowsize+3)+")")}),gantt.header("#jqgh_grid_operationplans")},scroll:function(e){var t=viewend.getTime()-viewstart.getTime();viewstart.setTime(horizonstart.getTime()+$(e.target).scrollLeft()/e.target.scrollWidth*(horizonend.getTime()-horizonstart.getTime())),viewend.setTime(viewstart.getTime()+t);var a=(horizonend.getTime()-horizonstart.getTime())/t*$(e.target).width()/1e4,o=(horizonstart.getTime()-viewstart.getTime())/(horizonend.getTime()-horizonstart.getTime())*1e4;$(".transformer").each(function(){var e=$(this).attr("title");$(this).attr("transform","scale("+a+",1) translate("+o+","+((e-1)*gantt.rowsize+3)+")")})},zoom:function(e,t="#jqgh_grid_operationplans"){var a=(viewend.getTime()-viewstart.getTime())*e;a>=horizonend.getTime()-horizonstart.getTime()?(viewstart.setTime(horizonstart.getTime()),viewend.setTime(horizonend.getTime()),a=viewend.getTime()-viewstart.getTime()):(viewend.setTime(viewstart.getTime()+a),viewend.getTime()>horizonend.getTime()&&(viewend.setTime(horizonend.getTime()),viewstart.setTime(viewend.getTime()-a)));var o=(horizonend.getTime()-horizonstart.getTime())/a*$(t).width()/1e4,i=(horizonstart.getTime()-viewstart.getTime())/(horizonend.getTime()-horizonstart.getTime())*1e4;$(".transformer").each(function(){var e=$(this).attr("title");$(this).attr("transform","scale("+o+",1) translate("+i+","+((e-1)*gantt.rowsize+3)+")")}),gantt.header(t)}};function Gauge(e,t){this.placeholderName=e;var a=this;this.configure=function(t){this.config=t,this.config.size=Math.min($("#"+e).parent().width()-30,200),this.config.raduis=.97*this.config.size/2,this.config.cx=this.config.size/2,this.config.cy=this.config.size/2,this.config.min=void 0!=t.min?t.min:0,this.config.max=void 0!=t.max?t.max:100,this.config.range=this.config.max-this.config.min,this.config.majorTicks=t.majorTicks||5,this.config.minorTicks=t.minorTicks||2,this.config.greenColor=t.greenColor||"#109618",this.config.yellowColor=t.yellowColor||"#FF9900",this.config.redColor=t.redColor||"#DC3912",this.config.transitionDuration=t.transitionDuration||500},this.render=function(){for(var e in this.body=d3.select("#"+this.placeholderName).append("svg:svg").attr("class","gauge").attr("width",this.config.size).attr("height",this.config.size),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",this.config.raduis).style("fill","#ccc").style("stroke","#000").style("stroke-width","0.5px"),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.9*this.config.raduis).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width","2px"),this.config.greenZones)this.drawBand(this.config.greenZones[e].from,this.config.greenZones[e].to,a.config.greenColor);for(var e in this.config.yellowZones)this.drawBand(this.config.yellowZones[e].from,this.config.yellowZones[e].to,a.config.yellowColor);for(var e in this.config.redZones)this.drawBand(this.config.redZones[e].from,this.config.redZones[e].to,a.config.redColor);if(void 0!=this.config.label){var t=Math.round(this.config.size/9);this.body.append("svg:text").attr("x",this.config.cx).attr("y",this.config.cy/2+t/2).attr("dy",t/2).attr("text-anchor","middle").text(this.config.label).style("font-size",t+"px").style("fill","#333").style("stroke-width","0px")}t=Math.round(this.config.size/16);for(var o=this.config.range/(this.config.majorTicks-1),i=this.config.min;i<=this.config.max;i+=o){for(var r=o/this.config.minorTicks,s=i+r;s<Math.min(i+o,this.config.max);s+=r){var n=this.valueToPoint(s,.75),l=this.valueToPoint(s,.85);this.body.append("svg:line").attr("x1",n.x).attr("y1",n.y).attr("x2",l.x).attr("y2",l.y).style("stroke","#666").style("stroke-width","1px")}n=this.valueToPoint(i,.7),l=this.valueToPoint(i,.85);if(this.body.append("svg:line").attr("x1",n.x).attr("y1",n.y).attr("x2",l.x).attr("y2",l.y).style("stroke","#333").style("stroke-width","2px"),i==this.config.min||i==this.config.max){var d=this.valueToPoint(i,.63);this.body.append("svg:text").attr("x",d.x).attr("y",d.y).attr("dy",t/3).attr("text-anchor",i==this.config.min?"start":"end").text(i).style("font-size",t+"px").style("fill","#333").style("stroke-width","0px")}}var c=this.body.append("svg:g").attr("class","pointerContainer"),p=(this.config.min+this.config.max)/2,u=this.buildPointerPath(p),f=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("basis");c.selectAll("path").data([u]).enter().append("svg:path").attr("d",f).style("fill","#dc3912").style("stroke","#c63310").style("fill-opacity",.7),c.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.12*this.config.raduis).style("fill","#4684EE").style("stroke","#666").style("opacity",1);t=Math.round(this.config.size/10);c.selectAll("text").data([p]).enter().append("svg:text").attr("x",this.config.cx).attr("y",this.config.size-this.config.cy/4-t).attr("dy",t/2).attr("text-anchor","middle").style("font-size",t+"px").style("fill","#000").style("stroke-width","0px"),this.redraw(this.config.value,0)},this.buildPointerPath=function(e){var t=this.config.range/13,o=d(e,.85),i=d(e-t,.12),r=d(e+t,.12),s=e-this.config.range*(1/.75)/2,n=d(s,.28),l=d(s-t,.12);return[o,i,d(s+t,.12),n,l,r,o];function d(e,t){var o=a.valueToPoint(e,t);return o.x-=a.config.cx,o.y-=a.config.cy,o}},this.drawBand=function(e,t,o){0>=t-e||this.body.append("svg:path").style("fill",o).attr("d",d3.svg.arc().startAngle(this.valueToRadians(e)).endAngle(this.valueToRadians(t)).innerRadius(.65*this.config.raduis).outerRadius(.85*this.config.raduis)).attr("transform",function(){return"translate("+a.config.cx+", "+a.config.cy+") rotate(270)"})},this.redraw=function(e,t){var o=this.body.select(".pointerContainer");o.selectAll("text").text(Math.round(e)),o.selectAll("path").transition().duration(void 0!=t?t:this.config.transitionDuration).attrTween("transform",function(){var t=e;e>a.config.max?t=a.config.max+.02*a.config.range:e<a.config.min&&(t=a.config.min-.02*a.config.range);var o=a.valueToDegrees(t)-90,i=a._currentRotation||o;return a._currentRotation=o,function(e){var t=i+(o-i)*e;return"translate("+a.config.cx+", "+a.config.cy+") rotate("+t+")"}})},this.valueToDegrees=function(e){return e/this.config.range*270-(this.config.min/this.config.range*270+45)},this.valueToRadians=function(e){return this.valueToDegrees(e)*Math.PI/180},this.valueToPoint=function(e,t){return{x:this.config.cx-this.config.raduis*t*Math.cos(this.valueToRadians(e)),y:this.config.cy-this.config.raduis*t*Math.sin(this.valueToRadians(e))}},this.configure(t)}function showModalImage(e,t){var a=$("#popup");a.html('<div class="modal-dialog modal-xl" style="margin-top: 20px; width:90%; margin-left: auto; margin-right: auto"><div class="modal-content"><div class="modal-header" style="border-top-left-radius: inherit; border-top-right-radius: inherit"><button type="button" class="btn-close" data-bs-dismiss="modal"></button><h5 class="modal-title"></h5></div><div class="modal-body"><img src="" style="width:100%"></div></div></div>'),a.find("h4").text(t),a.find("img").attr("src",$(e.target).attr("src")),showModal("popup"),e.preventDefault()}$.fn.drags=function(e){if(""===(e=$.extend({handle:"",cursor:"move"},e)).handle)var t=this;else t=this.find(e.handle);return t.css("cursor",e.cursor).on("mousedown",function(t){if(""===e.handle)var a=$(this).addClass("draggable");else a=$(this).addClass("active-handle").parent().addClass("draggable");var o=a.css("z-index"),i=a.outerHeight(),r=a.outerWidth(),s=a.offset().top+i-t.pageY,n=a.offset().left+r-t.pageX;a.css("z-index",1e3).parents().on("mousemove",function(e){$(".draggable").offset({top:e.pageY+s-i,left:e.pageX+n-r}).on("mouseup",function(){$(this).removeClass("draggable").css("z-index",o)})}),t.preventDefault()}).on("mouseup",function(){""===e.handle?$(this).removeClass("draggable"):$(this).removeClass("active-handle").parent().removeClass("draggable")})};var follow={setMethod:function(e){var t=$(e);t.closest(".dropdown").find(".followerspan").text(t.text())},get:function(e,t){var a=$(t);e.preventDefault(),$.ajax({url:url_prefix+"/follow/",data:{object_pk:a.attr("data-pk"),model:a.attr("data-model")},type:"GET",contentType:"application/json; charset=utf-8",success:function(e){hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid");var t=$('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><table id="follower_key" style="width:100%"><tr><th>'+gettext("Follow")+'&nbsp;&nbsp;<span class="dropdown"><button class="form-control w-auto d-inline dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><span class="followerspan"></span>&nbsp;<span class="caret"></button><ul class="dropdown-menu"><li><a class="dropdown-item" href="#" onclick="follow.setMethod(this)">online</a></li><li><a class="dropdown-item" href="#" onclick="follow.setMethod(this)">email</a></li></ul></span></th></tr><tr><td id="follower_models" style="vertical-align:top"></td></tr></table></div><div class="modal-footer justify-content-between"><input type="submit" role="button" class="btn btn-primary" data-bs-dismiss="modal" value="'+gettext("Close")+'"><input type="submit" role="button" class="btn btn-primary" onclick="follow.post(event, this)" value="'+gettext("Update")+'"></div></div></div>');if(t.find(".modal-title").text(interpolate(gettext("Manage notifications of %s"),[e.label+" "+e.object_pk],!1)),t.find(".followerspan").text(e.type),t.find("#follower_key").attr("data-model",e.model).attr("data-object_pk",e.object_pk),e.parents)for(var a of e.parents){(o=$("<div style='margin-top:10px; margin-bottom:10px'>"+gettext("Following")+" "+a.model+" <a class='text-decoration-underline' target='_blank'></a></div>")).find("a").attr("href",a.url).text(a.object_pk),o.find("a").append($("<i style='text-indent:0.5em' class='fa fa-external-link'></i>")),t.find("td").first().append(o)}else if(e.models)for(var a of e.models){(o=$("<div class='form-check'><label><input class='form-check-input' type='checkbox'/><span class='text-capitalize'></span></label></div>")).find("span").text(a.label),o.find("input").attr("data-model",a.model),a.checked&&o.find("input").attr("checked","true"),t.find("td").first().append(o)}if(e.users){var o=$("<th></th>");for(var i of(o.text(gettext("Add followers")),t.find("th").after(o),o=$("<td id='follower_users' style='vertical-align:top'></td>"),e.users)){var r=$("<div class='form-check'><label><input  class='form-check-input' type='checkbox'/><span class='followername'></span></label>&nbsp;&nbsp;<span class=\"dropdown\">"+'<button class="form-control w-auto d-inline dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><span class="followerspan"></span>&nbsp;<span class="caret"></button><ul class="dropdown-menu"><li><a class="dropdown-item" href="#" onclick="follow.setMethod(this)">online</a></li><li><a class="dropdown-item" href="#" onclick="follow.setMethod(this)">email</a></li></ul></span></div>');r.find("input").attr("data-username",i.username),"no"!=i.following&&r.find("input").attr("checked","true"),r.find(".followerspan").text("email"==i.following?"email":"online"),"indirect"==i.following&&(r.find("input").attr("disabled","disabled"),r.find(".dropdown").addClass("disabled")),r.find("span.followername").text(i.username),o.append(r)}t.find("td").after(o)}$("#popup").html(t),showModal("popup")},error:ajaxerror})},post:function(){var e=$("#popup"),t=e.find("#follower_key"),a={object_pk:t.attr("data-object_pk"),model:t.attr("data-model"),type:e.find("#follower_key .followerspan").text(),users:{},models:[]};e.find("#follower_users input:checked").each(function(){"disabled"!=$(this).attr("disabled")&&(a.users[$(this).attr("data-username")]=$(this).closest(".checkbox").find(".followerspan").text())}),e.find("#follower_models input:checked").each(function(){a.models.push($(this).attr("data-model"))}),$.ajax({url:url_prefix+"/follow/",data:JSON.stringify([a]),type:"POST",contentType:"application/json",success:function(){hideModal("popup")},error:ajaxerror})}};
//# sourceMappingURL=frepple.min.js.map
