/* frePPLe 4.0.0
Copyright (C) 2010-2019 by frePPLe bv

This library is free software; you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published
by the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

function isDragnDropUploadCapable(){var t=document.createElement("div");return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&"FormData"in window&&"FileReader"in window}function breadcrumbs_reflow(){var t=$("#breadcrumbs"),e=Math.ceil($("#cockpitcrumb").height())+16;t.children("li:hidden").show();var a=!0;t.children("li").each(function(){t.height()>e&&!a&&$(this).hide(),a=!1})}function admin_escape(t){return t.replace(/_/g,"_5F").replace(/&amp;/g,"_26").replace(/&lt;/g,"_3C").replace(/&gt;/g,"_3E").replace(/&#39;/g,"'").replace(/&quot;/g,"_22").replace(/:/g,"_3A").replace(/\//g,"_2F").replace(/#/g,"_23").replace(/\?/g,"_3F").replace(/;/g,"_3B").replace(/@/g,"_40").replace(/&/g,"_26").replace(/=/g,"_3D").replace(/\+/g,"_2B").replace(/\$/g,"_24").replace(/,/g,"_2C").replace(/"/g,"_22").replace(/</g,"_3C").replace(/>/g,"_3E").replace(/%/g,"_25").replace(/\\/g,"_5C")}function admin_unescape(t){return t.replace(/_5F/g,"_").replace(/_22/g,'"').replace(/_3A/g,":").replace(/_2F/g,"/").replace(/_23/g,"#").replace(/_3F/g,"?").replace(/_3B/g,";").replace(/_40/g,"@").replace(/_26/g,"&").replace(/_3D/g,"=").replace(/_2B/g,"+").replace(/_24/g,"$").replace(/_2C/g,",").replace(/_3C/g,"<").replace(/_3E/g,">").replace(/_25/g,"%").replace(/_5C/g,"\\")}window.__admin_media_prefix__="/static/admin/",$.fn.resizable=function(t){var e={handleSelector:null,resizeWidth:!0,resizeHeight:!0,onDragStart:null,onDragEnd:null,onDrag:null,touchActionNone:!0};return"object"==typeof t&&(e=$.extend(e,t)),this.each(function(){var t,a,o=$(this);if(!$(this).hasClass("ui-jqgrid")){var i=e.handleSelector?$(e.handleSelector):o;e.touchActionNone&&i.css("touch-action","none"),o.addClass("resizable"),i.bind("mousedown.rsz touchstart.rsz",function(i){if((t=n(i)).width=parseInt(o.width(),10),t.height=parseInt(o.height(),10),a=o.css("transition"),o.css("transition","none"),e.onDragStart&&!1===e.onDragStart(i,o,e))return;e.dragFunc=r,$(document).bind("mousemove.rsz",e.dragFunc),$(document).bind("mouseup.rsz",l),(window.Touch||navigator.maxTouchPoints)&&($(document).bind("touchmove.rsz",e.dragFunc),$(document).bind("touchend.rsz",l));$(document).bind("selectstart.rsz",s)})}function s(t){t.stopPropagation(),t.preventDefault()}function r(a){var i=n(a);if(e.resizeWidth){var s=t.width+i.x-t.x;o.width(s)}if(e.resizeHeight){var r=t.height+i.y-t.y;o.height(r)}e.onDrag&&e.onDrag(a,o,e)}function l(t){return t.stopPropagation(),t.preventDefault(),$(document).unbind("mousemove.rsz",e.dragFunc),$(document).unbind("mouseup.rsz",l),(window.Touch||navigator.maxTouchPoints)&&($(document).unbind("touchmove.rsz",e.dragFunc),$(document).unbind("touchend.rsz",l)),$(document).unbind("selectstart.rsz",s),o.css("transition",a),e.onDragEnd&&e.onDragEnd(t,o,e),!1}function n(t){var e={x:0,y:0,width:0,height:0};if("number"==typeof t.clientX)e.x=t.clientX,e.y=t.clientY;else{if(!t.originalEvent.touches)return null;e.x=t.originalEvent.touches[0].clientX,e.y=t.originalEvent.touches[0].clientY}return e}})};var upload={warnUnsavedChanges:function(){return $(window).off("beforeunload",upload.warnUnsavedChanges),gettext("There are unsaved changes on this page.")},undo:function(){$("#undo").hasClass("btn-primary")||($("#grid").trigger("reloadGrid"),$("#grid").closest(".ui-jqgrid-bdiv").scrollTop(0),$("#save, #undo").addClass("btn-primary").removeClass("btn-danger").prop("disabled",!0),$("#actions1").prop("disabled",!0),$(window).off("beforeunload",upload.warnUnsavedChanges))},select:function(){$.jgrid.hideModal("#searchmodfbox_grid"),$("#save, #undo").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges)},selectedRows:[],restoreSelection:function(){for(var t in grid.markSelectedRow(upload.selectedRows.length),upload.selectedRows)$("#grid").jqGrid("setSelection",upload.selectedRows[t],!1);upload.selectedRows=[]},save:function(){if(!$("#save").hasClass("btn-primary")){if($("#grid").saveCell(editrow,editcol),"function"==typeof getDirtyData)var t=getDirtyData();else t=$("#grid").getChangedCells("dirty");upload.selectedRows=$("#grid").jqGrid("getGridParam","selarrrow").slice(),null!=t&&t.length>0&&$.ajax({url:location.pathname,data:JSON.stringify(t),type:"POST",contentType:"application/json",success:function(){upload.undo()},error:function(t,e,a){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Error")+'</h4></div><div class="modal-body"><p>'+t.responseText+'</p></div><div class="modal-footer"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Close")+'"></div></div></div>').modal("show")}})}},validateSort:function(t){"grid_cb"!=$(this).attr("id")&&($("body").hasClass("popup")||($("#save").hasClass("btn-primary")?jQuery("#grid").jqGrid("resetSelection"):($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header alert-warning" style="border-top-left-radius: inherit; border-top-right-radius: inherit"><h4 class="modal-title">'+gettext("Save or cancel your changes first")+'</h4></div><div class="modal-body">'+gettext("There are unsaved changes on this page.")+'</div><div class="modal-footer"><input type="submit" id="savebutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Save")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#savebutton").on("click",function(){upload.save(),$("#popup").modal("hide")}),$("#cancelbutton").on("click",function(){upload.undo(),$("#popup").modal("hide")}),t.stopPropagation())))}};function opendetail(t){var e=$(t.target).parent(),a=e.attr("href"),o=e.attr("objectid");void 0!==o&&0!=o||(o=e.parent().text().trim()),t.preventDefault(),t.stopImmediatePropagation(),window.location.href=url_prefix+a.replace("key",admin_escape(o))}function formatDuration(t,e,a){var o,i,s,r=0,l=0,n=[],d=[];if(void 0===t||""===t||null===t)return"";if("number"==typeof t)l=t,s=Math.sign(l);else switch(s="-"==$.trim(t).charAt(0)?-1:1,1==(n=t.replace(/ +/g," ").split(" ")).length?(d=t.split(":"),r=0):(d=n[1].split(":"),r=""!=n[0]?parseFloat(n[0]):0),d.length){case 0:l=86400*Math.abs(r);break;case 1:l=86400*Math.abs(r)+(""!=d[0]?Math.abs(parseFloat(d[0])):0);break;case 2:l=86400*Math.abs(r)+60*(""!=d[0]?Math.abs(parseFloat(d[0])):0)+(""!=d[1]?parseFloat(d[1]):0);break;default:l=86400*Math.abs(r)+3600*(""!=d[0]?Math.abs(parseFloat(d[0])):0)+60*(""!=d[1]?parseFloat(d[1]):0)+(""!=d[2]?parseFloat(d[2]):0)}return l=(l=Math.abs(l))-86400*(r=Math.floor(l/86400))-3600*(o=Math.floor((l-86400*r)/3600))-60*(i=Math.floor((l-86400*r-3600*o)/60)),r>1825?"N/A":r>0?(s*r).toString()+" "+(o<10?"0":"")+o+(i<10?":0":":")+i+(l<10?":0":":")+Number(l.toFixed(l===Math.floor(l)?0:6)):(s<0?"-":"")+(o<10?"0":"")+o+(i<10?":0":":")+i+(l<10?":0":":")+Number(l.toFixed(l===Math.floor(l)?0:6))}jQuery.extend($.fn.fmatter,{percentage:function(t,e,a){return void 0===t||""===t||null===t?"":grid.formatNumber(t)+"%"},duration:formatDuration,admin:function(t,e,a){return void 0===t||""===t||null===t?"":e.colModel.popup||"0"===a.showdrilldown?$.jgrid.htmlEncode(t):$.jgrid.htmlEncode(t)+"<a href='"+url_prefix+"/data/"+e.colModel.role+"/"+admin_escape(t)+"/change/' onclick='event.stopPropagation()'><span class='leftpadding fa fa-caret-right'></span></a>"},detail:function(t,e,a){if(void 0===t||""===t||null===t)return"";if(e.colModel.popup||"0"===a.showdrilldown)return $.jgrid.htmlEncode(t);if("operation"==e.colModel.name){if(a.hasOwnProperty("type")&&("PO"===a.type||"DO"===a.type||"DLVR"===a.type||"STCK"===a.type))return $.jgrid.htmlEncode(t);if(a.hasOwnProperty("operationplan__type")&&("PO"===a.operationplan__type||"DO"===a.operationplan__type||"DLVR"===a.operationplan__type||"STCK"===a.operationplan__type))return $.jgrid.htmlEncode(t)}return $.jgrid.htmlEncode(t)+'<a href="'+url_prefix+"/detail/"+e.colModel.role+"/"+admin_escape(t)+"/\" onclick='event.stopPropagation()'><span class='leftpadding fa fa-caret-right'></span></a>"},demanddetail:function(t,e,a){if(void 0===t||""===t)return"";if(e.colModel.popup)return $.jgrid.htmlEncode(t);for(var o="",i=t.length,s=0;s<i;s++)""!=o&&(o+=", "),o+=t[s][0]+" : "+$.jgrid.htmlEncode(t[s][1])+'<a href="'+url_prefix+"/detail/input/demand/"+admin_escape(t[s][1])+"/\" onclick='event.stopPropagation()'><span class='leftpadding fa fa-caret-right' role='input/demand'></span></a>";return o},listdetail:function(t,e,a){if(void 0===t||""===t)return"";if(e.colModel.popup)return t;for(var o="",i=t.length,s=0;s<i;s++)""!=o&&(o+=", "),o+='<span><span class="listdetailkey">'+$.jgrid.htmlEncode(t[s][0])+'</span><a href="'+url_prefix+"/detail/"+e.colModel.role+"/"+admin_escape(t[s][0])+"/\" onclick='event.stopPropagation()'><span class='leftpadding fa fa-caret-right' role='"+e.colModel.role+"'></span></a></span>&nbsp;<span>"+t[s][1]+"</span>";return o},graph:function(t,e,a){return'<div class="graph" style="height:80px"></div>'},longstring:function(t,e,a){if("string"!=typeof t)return"";var o=$.jgrid.htmlEncode(t);return'<span data-toggle="tooltip" data-placement="left" data-original-title="'+o+'">'+o+"</span>"},selectbutton:function(t,e,a){return t?'<button onClick="opener.dismissRelatedLookupPopup(window, grid.selected)" class="btn btn-primary btn-xs">'+gettext("select")+"</button>":""},color:function(t,e,a){if(void 0===a.color||""===a.color)return"";var o=Math.round(parseInt(a.delay)/8640)/10;return 999===parseInt(a.criticality)||999===parseInt(a.operationplan__criticality)?"":o<0?'<div class="invStatus" style="text-align: center; background-color: #008000; color: #151515;">'+-o+" "+gettext("days early")+"</div>":0===o?'<div class="invStatus" style="text-align: center; background-color: #008000; color: #151515;">'+gettext("on time")+"</div>":o>0?'<div class="invStatus" style="text-align: center; background-color: #f00; color: #151515;">'+o+" "+gettext("days late")+"</div>":""},number:function(t,e){return grid.formatNumber(t)}}),jQuery.extend($.fn.fmatter.percentage,{unformat:function(t,e,a){return t.replace("%","")}}),jQuery.extend($.fn.fmatter.listdetail,{unformat:function(t,e,a){var o=[];return $(".listdetailkey",$(a)).each(function(t,e){o.push([$(e).text(),$(e).parent().next("span").text()])}),o}});var grid={selected:void 0,formatNumber:function(t,e=6){if(void 0===t)return"";var a=$.fmatter.isNumber;if(a(t)||(t*=1),a(t)){var o,i=t<0;o=t>1e5||e<=0?String(parseFloat(t.toFixed())):t>1e4||e<=1?String(parseFloat(t.toFixed(1))):t>1e3||e<=2?String(parseFloat(t.toFixed(2))):t>100||e<=3?String(parseFloat(t.toFixed(3))):t>10||e<=4?String(parseFloat(t.toFixed(4))):t>1||e<=5?String(parseFloat(t.toFixed(5))):String(parseFloat(t.toFixed(e)));var s=jQuery("#grid").jqGrid("getGridRes","formatter.number.decimalSeparator")||".";"."!==s&&(o=o.replace(".",s));var r=jQuery("#grid").jqGrid("getGridRes","formatter.number.thousandsSeparator")||",";if(r){var l=o.lastIndexOf(s);l=l>-1?l:o.length;var n,d=void 0===s?"":o.substring(l),c=-1;for(n=l;n>0;n--)++c%3==0&&n!==l&&(!i||n>1)&&(d=r+d),d=o.charAt(n-1)+d;o=d}return o}return t},summary_last:function(t,e,a){return a[e]},summary_first:function(t,e,a){return t||a[e]},setSelectedRow:function(t){void 0!=grid.selected&&$(this).jqGrid("setCell",grid.selected,"select",null),grid.selected=t,$(this).jqGrid("setCell",t,"select",!0)},runAction:function(t){"no_action"!=$("#actions").val()&&actions[$("#actions").val()]()},setStatus:function(t){var e=jQuery("#grid").jqGrid("getGridParam","selarrrow");for(var a in e)jQuery("#grid").jqGrid("setCell",e[a],"status",t,"dirty-cell"),jQuery("#grid").jqGrid("setRowData",e[a],!1,"edited");$("#actions1").html(gettext("Select action")+'&nbsp;&nbsp;<span class="caret"></span>'),$("#save").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1),$("#undo").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1)},pivotcolumns:function(t,e,a){var o="";for(var i of cross_idx)cross[i].editable?o+='<span class="editablepivotcol">'+cross[i].name+"</span>":o+=cross[i].name+"<br>";return o},showCustomize:function(t,e,a,o,i,s,r){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid");var l=$(void 0!==e?e:"#grid").jqGrid("getGridParam","colModel"),n=0,d=0,c=!1,p=t&&void 0!==i&&i,u=p?"":'<div class="row"><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Selected options")+'</div><div class="panel-body"><ul class="list-group" id="Rows" style="height: 160px; overflow-y: scroll;">placeholder0</ul></div></div></div><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Available options")+'</div><div class="panel-body"><ul class="list-group" id="DroppointRows" style="height: 160px; overflow-y: scroll;">placeholder1</ul></div></div></div></div>',h="",f="",m="",g="",v="",b="";for(var y in l)"graph"==l[y].name?c=!0:"rn"==l[y].name||"cb"==l[y].name||null==l[y].counter||""==l[y].label||"alwayshidden"in l[y]?d++:(l[y].frozen&&(n=parseInt(y,10)+1-d),l[y].hidden?g+='<li id="'+y+'"  class="list-group-item" style="cursor: move;">'+l[y].label+"</li>":m+='<li id="'+y+'"  class="list-group-item" style="cursor: move;">'+l[y].label+"</li>");if(t){var x=void 0!==a?a:cross,w=void 0!==o?o:cross_idx;h='<div class="row"><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Selected Cross")+'</div><div class="panel-body"><ul class="list-group" id="Crosses" style="height: 160px; overflow-y: scroll;">placeholder0</ul></div></div></div><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Available Cross")+'</div><div class="panel-body"><ul class="list-group" id="DroppointCrosses" style="height: 160px; overflow-y: scroll;">placeholder1</ul></div></div></div></div>';for(var C in w)v+='<li class="list-group-item" id="'+(100+parseInt(w[C],10))+'" style="cursor: move;">'+x[w[C]].name+"</li>";for(var C in x)w.indexOf(parseInt(C,10))>-1||""==x[C].name||(b+='<li class="list-group-item" id="'+(100+parseInt(C,10))+'" style="cursor: move;">'+x[C].name+"</li>")}else f='<div class="row"><div class="col-xs-12">'+gettext("Frozen columns")+'&nbsp;&nbsp;<input type="number" id="frozen" style="text-align: center;" min="0" max="4" step="1" value="'+n+'"></div></div>';if(u=(u=u.replace("placeholder0",m)).replace("placeholder1",g),t&&(h=(h=h.replace("placeholder0",v)).replace("placeholder1",b)),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label='+gettext("Close")+'><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Customize")+'</h4></div><div class="modal-body">'+u+h+f+'</div><div class="modal-footer"><input type="submit" id="okCustbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("OK")+'"><input type="submit" id="cancelCustbutton" role="button" class="btn btn-primary pull-left" data-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="resetCustbutton" role="button" class="btn btn-primary pull-left" value="'+gettext("Reset")+'"></div></div></div>').modal("show"),!p){var k=document.getElementById("Rows"),_=document.getElementById("DroppointRows");Sortable.create(k,{group:{name:"Rows",put:["DroppointRows"]},animation:100}),Sortable.create(_,{group:{name:"DroppointRows",put:["Rows"]},animation:100})}if(t){var M=document.getElementById("Crosses"),D=document.getElementById("DroppointCrosses");Sortable.create(M,{group:{name:"Crosses",put:["DroppointCrosses"]},animation:100}),Sortable.create(D,{group:{name:"DroppointCrosses",put:["Crosses"]},animation:100})}$("#resetCustbutton").on("click",void 0!==r?r:function(){var t={};if(t[reportkey]={favorites:favorites},"undefined"!=typeof url_prefix)var e=url_prefix+"/settings/";else e="/settings/";$.ajax({url:e,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(){window.location.href=window.location.href},error:function(t,e,a){$("#popup").html('<div class="modal-dialog" style="width: auto"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Error")+'</h4></div><div class="modal-body"><p>'+t.responseText+"  "+e+a+'</p></div><div class="modal-footer"></div></div></div>').modal("show")}})}),$("#okCustbutton").on("click",void 0!==s?s:function(){var e=$("#grid")[0].p.colModel,a=[],o=[];"cb"==e[0].name&&a.push(0),cross_idx=[],c||$("#grid").jqGrid("destroyFrozenColumns"),$("#Rows li").each(function(){var t=parseInt(this.id,10);t<100&&($("#grid").jqGrid("showCol",e[t].name),a.push(t))}),$("#DroppointRows li").each(function(){var a=parseInt(this.id,10);a<100&&(o.push(a),t&&$("#grid").jqGrid("setColProp",e[a].name,{frozen:!1}),$("#grid").jqGrid("hideCol",e[a].name))}),$("#Crosses li").each(function(){var t=parseInt(this.id,10);t>=100&&cross_idx.push(t-100)});var i=0;if(t)for(var s in e)"counter"in e[s]?i=parseInt(s)+1:a.push(parseInt(s));else i=parseInt($("#frozen").val());for(var s in o)a.push(o[s]);for(var s in e)"alwayshidden"in e[s]&&a.push(parseInt(s));$("#grid").jqGrid("remapColumns",a,!0);var r=0;for(var s in e)"rn"!=e[s].name&&"cb"!=e[s].name&&null!=e[s].counter?$("#grid").jqGrid("setColProp",e[s].name,{frozen:s-r<i}):r++;c||$("#grid").jqGrid("setFrozenColumns"),$("#grid").trigger("reloadGrid"),grid.saveColumnConfiguration(),$("#popup").modal("hide")})},getGridConfig:function(){var t=new Array,e=$("#grid").jqGrid("getGridParam","colModel"),a=!1,o=0;for(var i in e)"rn"!=e[i].name&&"cb"!=e[i].name&&"counter"in e[i]&&!("alwayshidden"in e[i])?(t.push([e[i].name,e[i].hidden,e[i].width]),e[i].frozen&&(maxfrozen=parseInt(i)+1-o)):"columns"==e[i].name||"graph"==e[i].name?a=!0:o++;var s={rows:t},r=$("#grid").getGridParam("postData").filters;void 0!==r&&r.rules!=[]&&(s.filter=r);var l=$("#grid").getGridParam("sortname");if(""!==l&&(s.sidx=l,s.sord=$("#grid").getGridParam("sortorder")),a)for(var i in s.crosses=[],cross_idx)s.crosses.push(cross[cross_idx[i]].key);return s},saveColumnConfiguration:function(t,e){var a=new Array,o=$("#grid").jqGrid("getGridParam","colModel"),i=0,s=!1,r=0,l=$("#grid").jqGrid("getGridParam","page");for(var n in"string"==typeof t?t.indexOf("next")>=0?++l:t.indexOf("prev")>=0?--l:t.indexOf("last")>=0?l=$("#grid").jqGrid("getGridParam","lastpage"):t.indexOf("first")>=0?l=1:t.indexOf("user")>=0&&(l=$("input.ui-pg-input").val()):void 0!==e&&"operationplans"==o[e].name&&gantt.redraw(),o)"rn"!=o[n].name&&"cb"!=o[n].name&&"counter"in o[n]&&!("alwayshidden"in o[n])?(a.push([o[n].name,o[n].hidden,o[n].width]),o[n].frozen&&(i=parseInt(n)+1-r)):"columns"==o[n].name||"graph"==o[n].name?s=!0:r++;var d={[reportkey]:{rows:a,page:l,favorites:favorites}},c=$("#grid").getGridParam("postData").filters;void 0!==c&&c.rules!=[]&&(d[reportkey].filter=c);var p=$("#grid").getGridParam("sortname");if(""!==p&&(d[reportkey].sidx=p,d[reportkey].sord=$("#grid").getGridParam("sortorder")),s)for(var n in d[reportkey].crosses=[],cross_idx)d[reportkey].crosses.push(cross[cross_idx[n]].key);else d[reportkey].frozen=i;if("function"==typeof extraPreference){var u=extraPreference();for(var h in u)d[reportkey][h]=u[h]}if("undefined"!=typeof url_prefix)var f=url_prefix+"/settings/";else f="/settings/";$.ajax({url:f,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(){"function"==typeof t&&t()},error:function(t,e,a){$("#popup").html('<div class="modal-dialog" style="width: auto"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Error")+'</h4></div><div class="modal-body"><p>'+t.responseText+"  "+e+a+'</p></div><div class="modal-footer"></div></div></div>').modal("show")}})},afterEditCell:function(t,e,a,o,i){var s=$(this).jqGrid("getGridParam","colModel")[i],r={time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-bullseye",clear:"fa fa-trash",close:"fa fa-remove"};"date"==s.formatter?"Y-m-d"==s.formatoptions.srcformat?$("#"+o+"_"+e).on("focusin",function(){$(this).parent().css({position:"relative",overflow:"visible"}),$(this).datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,calendarWeeks:!0,icons:r,locale:document.documentElement.lang,widgetPositioning:{horizontal:"auto",vertical:o<11?"bottom":"auto"}})}):$("#"+o+"_"+e).on("focusin",function(){$(this).parent().css({position:"relative",overflow:"visible"}),$(this).datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!1,calendarWeeks:!0,icons:r,locale:document.documentElement.lang,widgetPositioning:{horizontal:"auto",vertical:o<11?"bottom":"auto"}})}):$("#"+o+"_"+e).select()},showExport:function(t,e){if($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),e.length>0){for(var a="",o=0;o<e.length;o++)1==e[o][2]&&(a+='<div class="form-check"><input class="form-check-input" type="checkbox" value="" id="'+e[o][0]+'" checked disabled>&nbsp;&nbsp;&nbsp;<label class="form-check-label" for="'+e[o][0]+'">'+gettext(e[o][1])+"</label></div>");for(o=0;o<e.length&&o<6;o++)1!=e[o][2]&&(a+='<div class="form-check"><input class="form-check-input" type="checkbox" value="" id="'+e[o][0]+'">&nbsp;&nbsp;&nbsp;<label class="form-check-label" for="'+e[o][0]+'">'+gettext(e[o][1])+"</label></div>")}t&&e.length>1?$("#popup").html('<div class="modal-dialog" style="width: 400px;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("Export CSV or Excel file")+'</h4></div><div class="modal-body"><table class="table table-borderless"><thead><tr><th scope="col">'+gettext("Export format")+'</th><th scope="col">'+gettext("Scenarios to export")+'</th></tr></thead><tbody><tr><td><div class="radio" name="csvformat" id="csvformat" value="spreadsheetlist"><label><input type="radio" name="csvformat" value="spreadsheetlist" checked="">'+gettext("Spreadsheet list")+'</label><br><label><input type="radio" name="csvformat" value="csvlist">'+gettext("CSV list")+"</label><br></div><label><b>"+gettext("Data source URL")+'</b></label>&nbsp;&nbsp;<a href="'+documentation+'user-interface/getting-around/exporting-data.html" target="_blank" data-toggle="tooltip" data-placement="top" data-original-title="'+gettext("Using this link external applications can pull data from frePPLe")+'"><span class="fa fa-question-circle"></span></a><br><div class="input-group"><input type="text" readonly id="urladdress" class="form-control" style="background: white"/><span class="input-group-btn"><button type="button" class="btn btn-default fa fa-clipboard" id="copybutton" data-toggle="tooltip" data-placement="top" data-original-title="'+gettext("Copy to clipboard")+'"/></span></div></td><td><div class="check" name="scenarios" id="scenarios" value="default">'+a+'</div></td></tr></tbody></table></div><div class="modal-footer"><input type="submit" id="exportbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Export")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-left" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"):!t&&e.length>1?$("#popup").html('<div class="modal-dialog" style="width: 400px;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("Export CSV or Excel file")+'</h4></div><div class="modal-body"><table class="table table-borderless"><thead><tr><th scope="col">'+gettext("Export format")+'</th><th scope="col">'+gettext("Scenarios to export")+'</th></tr></thead><tbody><tr><td><div class="radio" name="csvformat" id="csvformat" value="spreadsheetlist"><label><input type="radio" name="csvformat" value="spreadsheettable" checked="">'+gettext("Spreadsheet table")+'</label><br><label><input type="radio" name="csvformat" value="spreadsheetlist">'+gettext("Spreadsheet list")+'</label><br><label><input type="radio" name="csvformat" value="csvtable">'+gettext("CSV table")+'</label><br><label><input type="radio" name="csvformat" value="csvlist">'+gettext("CSV list")+"</label><br></div><label><b>"+gettext("Data source URL")+'</b></label>&nbsp;&nbsp;<a href="'+documentation+'user-interface/getting-around/exporting-data.html" target="_blank" data-toggle="tooltip" data-placement="top" data-original-title="'+gettext("Using this link external applications can pull data from frePPLe")+'"><span class="fa fa-question-circle"></span></a><br><div class="input-group"><input type="text" readonly id="urladdress" class="form-control" style="background: white"/><span class="input-group-btn"><button type="button" class="btn btn-default fa fa-clipboard" id="copybutton" data-toggle="tooltip" data-placement="top" data-original-title="'+gettext("Copy to clipboard")+'"/></span></div></td><td><div class="check" name="scenarios" id="scenarios" value="default">'+a+'</div></td></tr></tbody></table></div><div class="modal-footer"><input type="submit" id="exportbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Export")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-left" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"):t&&e.length<=1?$("#popup").html('<div class="modal-dialog" style="width: 400px;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("Export CSV or Excel file")+'</h4></div><div class="modal-body"><label class="control-label"><b>'+gettext("Export format")+'</b><div class="radio" name="csvformat" id="csvformat" value="spreadsheetlist">&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="spreadsheetlist" checked="">'+gettext("Spreadsheet list")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="csvlist">'+gettext("CSV list")+"</label><br></div></label><br><label><b>"+gettext("Data source URL")+'</b></label>&nbsp;&nbsp;<a href="'+documentation+'user-interface/getting-around/exporting-data.html" target="_blank" data-toggle="tooltip" data-placement="top" data-original-title="'+gettext("Using this link external applications can pull data from frePPLe")+'"><span class="fa fa-question-circle"></span></a><br><div class="input-group"><input type="text" readonly id="urladdress" class="form-control" style="background: white"/><span class="input-group-btn"><button type="button" class="btn btn-default fa fa-clipboard" id="copybutton" data-toggle="tooltip" data-placement="top" data-original-title="'+gettext("Copy to clipboard")+'"/></span></div></label><br><div class="modal-footer"><input type="submit" id="exportbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Export")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-left" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"):!t&&e.length<=1&&$("#popup").html('<div class="modal-dialog" style="width: 400px;"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+gettext("Export CSV or Excel file")+'</h4></div><div class="modal-body"><label class="control-label"><b>'+gettext("Export format")+'</b><div class="radio" name="csvformat" id="csvformat" value="spreadsheettable">&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="spreadsheettable" checked="">'+gettext("Spreadsheet table")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="spreadsheetlist">'+gettext("Spreadsheet list")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="csvtable">'+gettext("CSV table")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="csvlist">'+gettext("CSV list")+"</label><br></div></label><br><label><b>"+gettext("Data source URL")+'</b></label>&nbsp;&nbsp;<a href="'+documentation+'user-interface/getting-around/exporting-data.html" target="_blank" data-toggle="tooltip" data-placement="top" data-original-title="'+gettext("Using this link external applications can pull data from frePPLe")+'"><span class="fa fa-question-circle"></span></a><br><div class="input-group"><input type="text" readonly id="urladdress" class="form-control" style="background: white"/><span class="input-group-btn"><button type="button" class="btn btn-default fa fa-clipboard" id="copybutton" data-toggle="tooltip" data-placement="top" data-original-title="'+gettext("Copy to clipboard")+'"/></span></div><div class="modal-footer"><input type="submit" id="exportbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Export")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-left" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),i();for(o=0;o<e.length&&o<6;o++)1!=e[o][2]&&$("#"+e[o][0]).on("click",function(){i()});function i(){var a=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href;if(location.search.length>0?a+="&":"?"!=a.charAt(a.length-1)&&(a+="?"),a+="format="+(t?"csv":"csvlist"),a+="&allcolumns=true",e.length>1){for(var o=!0,i="",s=0;s<e.length;s++)$("#"+e[s][0]).is(":checked")&&(o?o=!1:i+=",",i+=e[s][0]);a+="&scenarios="+i}$("#urladdress").val(a)}$('[data-toggle="tooltip"]').tooltip({delay:{show:500,hide:100}}),$("#copybutton").on("click",function(){i(),$("#urladdress").select(),document.execCommand("copy")}),$("#exportbutton").on("click",function(){var t=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href,a="";if(e.length>1)for(var o=!0,i=0;i<e.length;i++)$("#"+e[i][0]).is(":checked")&&(o?o=!1:a+=",",a+=e[i][0]);location.search.length>0?t+="&format="+$("#csvformat input:radio:checked").val():"?"==t.charAt(t.length-1)?t+="format="+$("#csvformat input:radio:checked").val():t+="?format="+$("#csvformat input:radio:checked").val(),e.length>1&&(t+="&scenarios="+a);var s=$("#grid").jqGrid("getGridParam","postData");t+="&"+jQuery.param(s),window.open(t,"_blank"),$("#popup").modal("hide")})},showBucket:function(){$("#popup").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid");var t={time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-bullseye",clear:"fa fa-trash",close:"fa fa-remove"};$("#horizonstart").parent().datetimepicker({format:"YYYY-MM-DD",calendarWeeks:!0,icons:t,locale:document.documentElement.lang}),$("#horizonend").parent().datetimepicker({format:"YYYY-MM-DD",calendarWeeks:!0,icons:t,locale:document.documentElement.lang}),$("#horizonstart").parent().on("dp.change",function(t){$("#horizonend").parent().data("DateTimePicker").minDate(t.date)}),$("#okbutton").on("click",function(){$("#horizonbuckets").val()+"|"+$("#horizonstart").val()+"|"+$("#horizonend").val()+"|"+($("#horizontype").is(":checked")?"True":"False")+"|"+$("#horizonlength").val()+"|"+$("#horizonunit").val()==$("#horizonoriginal").val()?$("#timebuckets").modal("hide"):($.ajax({type:"POST",url:url_prefix+"/horizon/",data:{horizonbuckets:$("#horizonbuckets").val()?$("#horizonbuckets").val():$("#horizonbucketsul li a").first().text(),horizonstart:$("#horizonstart").val(),horizonend:$("#horizonend").val(),horizontype:$("#horizontype").is(":checked")?"1":"0",horizonlength:$("#horizonlength").val(),horizonunit:$("#horizonunit").val()},dataType:"text/html",async:!1}),window.location.href=window.location.href)}),$("#timebuckets").modal("show")},showDelete:function(){if(!$("#delete_selected").hasClass("disabled")){var t=jQuery("#grid").jqGrid("getGridParam","selarrrow");1==t.length?location.href=location.pathname+admin_escape(t[0])+"/delete/":t.length>0&&($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("Delete data")+'</h4></div><div class="modal-body"><p>'+interpolate(gettext("You are about to delete %s objects AND ALL RELATED RECORDS!"),[t.length],!1)+'</p></div><div class="modal-footer"><input type="submit" id="delbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-left" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#delbutton").on("click",function(){$.ajax({url:location.pathname,data:JSON.stringify([{delete:t}]),type:"POST",contentType:"application/json",success:function(){$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#copy_selected").prop("disabled",!0).removeClass("bold"),$(".cbox").prop("checked",!1),$("#cb_grid.cbox").prop("checked",!1),$("#grid").trigger("reloadGrid"),$("#popup").modal("hide")},error:function(t,e,a){$("#popup .modal-body p").html(t.responseText),$("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#delbutton").prop("disabled",!0).hide()}})}))}},showCopy:function(){if(!$("#copy_selected").hasClass("disabled")){var t=jQuery("#grid").jqGrid("getGridParam","selarrrow");t.length>0&&($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("Copy data")+'</h4></div><div class="modal-body"><p>'+interpolate(gettext("You are about to duplicate %s objects"),[t.length],!1)+'</p></div><div class="modal-footer"><input type="submit" id="copybutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-left" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#copybutton").on("click",function(){$.ajax({url:location.pathname,data:JSON.stringify([{copy:t}]),type:"POST",contentType:"application/json",success:function(){$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#copy_selected").prop("disabled",!0).removeClass("bold"),$(".cbox").prop("checked",!1),$("#cb_grid.cbox").prop("checked",!1),$("#grid").trigger("reloadGrid"),$("#popup").modal("hide")},error:function(t,e,a){$("#popup .modal-body p").html(t.responseText),$("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#copybutton").prop("disabled",!0).hide()}})}))}},showFilter:function(t,e,a){$("#addsearch").val(""),$("#filterfield").remove(),grid.handlerinstalled=!1,$("#popup").modal("hide"),$("#timebuckets").modal("hide");var o=void 0!==t?t:"grid",i=$("#"+o),s=$(void 0!==e?e:"#curfilter");$(".modal").modal("hide"),i.jqGrid("searchGrid",{closeOnEscape:!0,multipleSearch:!0,multipleGroup:!0,overlay:0,sopt:["eq","ne","lt","le","gt","ge","bw","bn","in","ni","ew","en","cn","nc"],onSearch:function(){grid.saveColumnConfiguration(),grid.getFilterGroup(i,$("#fbox_"+o).jqFilter("filterData"),!0,s)},onReset:function(){return"undefined"!=typeof initialfilter?(i.jqGrid("getGridParam","postData").filters=JSON.stringify(initialfilter),grid.getFilterGroup(i,initialfilter,!0,s)):s.html(""),grid.saveColumnConfiguration(),!0}})},countFilters:0,handlerinstalled:!1,addFilter:function(t){t.stopPropagation(),t.preventDefault();var e={field:$(t.target).attr("data-filterfield"),op:"cn",data:$("#addsearch").val(),filtercount:++grid.filtercount},a=$("#grid").getGridParam("postData").filters;void 0===a?a={groupOp:"AND",rules:[e],groups:[]}:"AND"==(a=JSON.parse(a)).groupOp?a.rules.push(e):a={groupOp:"AND",rules:[e],groups:[a]},$("#grid").setGridParam({postData:{filters:JSON.stringify(a)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration(),grid.getFilterGroup($("#grid"),a,!0,$("#curfilter")),$(document).off("click",grid.clickFilter),grid.handlerinstalled=!1,$("#addsearch").val(""),$("#filterfield").remove(),$("#tooltip").css("display","none")},clickFilter:function(t){"addsearch"!=$(t.target).attr("id")&&($(document).off("click",grid.clickFilter),grid.handlerinstalled=!1,$("#addsearch").val(""),$("#filterfield").remove())},showFilterList:function(t){if($.jgrid.hideModal("#searchmodfbox_grid"),event.stopPropagation(),!grid.handlerinstalled){$(document).on("click",grid.clickFilter);var e=$('<span id="filterfield" class="list-group">'),a=15;for(var o of $("#grid").jqGrid("getGridParam","colModel")){var i=o.searchoptions;if(i&&i.sopt&&i.sopt.includes("cn")){var s=$('<button type="button" class="list-group-item list-group-item-action" onclick="grid.addFilter(event)" />');if(s.attr("data-filterfield",o.name),s.html(gettext("Search")+" "+o.label),e.append(s),--a<=0)break}}$(t).parent().before(e),grid.handlerinstalled=!0}},updateFilter:function(t,e,a){if(t instanceof Array)for(var o in t)grid.updateFilter(t[o],e,a);else if("object"==typeof t)for(var o in t)"filtercount"==o&&t[o]==e?t.data=a:t.hasOwnProperty(o)&&grid.updateFilter(t[o],e,a)},removeFilter:function(t,e){if(t instanceof Array)for(var a in t)t[a].filtercount==e?t.splice(a,1):t[a].filtercount>e?--t[a].filtercount:grid.removeFilter(t[a],e);else if("object"==typeof t)for(var a in t)t.hasOwnProperty(a)&&grid.removeFilter(t[a],e)},getFilterRule:function(t,e,a,o){var i,s,r,l=t.jqGrid("getGridParam","colModel");for(i=0;i<l.length;i++)if(l[i].name===e.field||l[i].field_name===e.field){s=l[i];break}if(void 0!=s){if("win"==e.op)r=gettext("within");else{for(var n in $.jgrid.locales)var d=$.jgrid.locales[n].search.odata;for(i=0;i<d.length;i++)if(d[i].oper==e.op){r=d[i].text;break}void 0==r&&(r=e.op)}var c=$('<span class="label label-default">'+s.label+"&nbsp;"+r+"&nbsp;</span>"),p=$('<input size="10">');e.filtercount=grid.countFilters++,p.val(e.data),p.on("change",function(a){grid.updateFilter(o,e.filtercount,$(a.target).val()),t.setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration()}),c.append(p),c.append("&nbsp;"),"win"==e.op&&c.append(gettext("days")+"&nbsp;");var u=$('<span class="fa fa-times"/>');u.on("click",function(i){grid.removeFilter(o,e.filtercount),grid.getFilterGroup(t,o,!0,a,o),t.setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration()}),c.append(u),a.append(c)}},getFilterGroup:function(t,e,a,o,i){if(a?(o.html(""),i=e,grid.countFilters=0):o.append("("),void 0!==e&&void 0!==e.groups)for(var s=0;s<e.groups.length;s++)o.html().length>1&&("OR"===e.groupOp?o.append(" "+gettext("or")+" "):o.append(" "+gettext("and")+" ")),grid.getFilterGroup(t,e.groups[s],!1,o,i);if(void 0!==e&&void 0!==e.rules)for(s=0;s<e.rules.length;s++)o.html().length>1&&o.append(" "+gettext("OR"===e.groupOp?"or":"and")+" "),grid.getFilterRule(t,e.rules[s],o,i);a||o.append(")")},markSelectedRow:function(t){void 0===t&&(t=0),t>0?($("#copy_selected").prop("disabled",!1).addClass("bold"),$("#delete_selected").prop("disabled",!1).addClass("bold"),$("#actions1").prop("disabled",!1)):($("#copy_selected").prop("disabled",!0).removeClass("bold"),$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#actions1").prop("disabled",!0))},markAllRows:function(){$(this).is(":checked")?($("#copy_selected").prop("disabled",!1).addClass("bold"),$("#delete_selected").prop("disabled",!1).addClass("bold"),$("#actions1").prop("disabled",!1),$(".cbox").prop("checked",!0)):($("#copy_selected").prop("disabled",!0).removeClass("bold"),$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#actions1").prop("disabled",!0),$(".cbox").prop("checked",!1))},displayMode:function(t){var e=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href;location.search.length>0?e=e.replace("&mode=table","").replace("&mode=graph","").replace("mode=table","").replace("mode=graph","")+"&mode="+t:"?"==e.charAt(e.length-1)?e+="mode="+t:e+="?mode="+t,window.location.href=e}},favorite={check:function(){var t=$("#favoritename").val();return t.length>0&&("undefined"!=typeof favorites&&!(t in favorites)||"undefined"!=typeof preferences&&!("favorites"in preferences)||"undefined"!=typeof preferences&&"favorites"in preferences&&!(t in preferences.favorites))?($("#favoritesave").removeClass("disabled"),!0):($("#favoritesave").addClass("disabled"),!1)},save:function(){var t=$("#favoritename").val();if(favorite.check()){favorites[t]=grid.getGridConfig(),grid.saveColumnConfiguration();var e=$("#favoritelist li.divider");0==e.length&&($("#favoritelist").prepend('<li role="separator" class="divider"></li>'),e=$("#favoritelist li.divider"));var a=$('<li id="zorro"></li>'),o=$('<a href="#" onclick="favorite.open(event)"></a>');o.text(t),o.append('<div style="float:right"><span class="fa fa-trash-o" onclick="favorite.remove(event)"></span></div>'),a.append(o),e.before(a),favorite.check()}},remove:function(t){var e=$(t.target).closest("a").text();e in favorites&&confirm(gettext("Click ok to confirm deleting the favorite"))&&(delete favorites[e],grid.saveColumnConfiguration(),$(t.target).closest("li").remove(),$("#favoritename").val(e),favorite.check()),t.stopImmediatePropagation()},open:function(t){var e=$(t.target).parent().text();if(e in favorites){var a=$("#grid"),o=!1,i=!1,s=0,r=a.jqGrid("getGridParam","colModel"),l=0;for(var n in r)"graph"==r[n].name?o=!0:"columns"==r[n].name?(i=!0,l=parseInt(n)):"cb"==r[n].name&&(s+=1),"counter"in r[n]&&r[n].frozen&&(l=parseInt(n));for(var d of(o||a.jqGrid("destroyFrozenColumns"),favorites[e].rows))d[1]?a.jqGrid("hideCol",d[0]):a.jqGrid("showCol",d[0]),a.jqGrid("setColWidth",d[0],d[2]);if("crosses"in favorites[e])for(var n of(cross_idx=[],favorites[e].crosses))for(var c in cross)cross[c].key==n&&cross_idx.push(parseInt(c));var p,u=[];for(var h of favorites[e].rows)h[1]||(u.push(h[0]),a.jqGrid("setColProp",h[0],{frozen:u.length<l+s}));if(i)for(var c of r)"counter"in c?c.frozen=!0:(u.push(c.name),c.frozen="columns"==c.name);for(var f of r)u.includes(f.name)||"cb"==f.name||u.push(f.name),f.frozen=!1;a.jqGrid("remapColumnsByName",u,!0,!1),"filter"in favorites[e]&&""!=favorites[e].filter?(a.setGridParam({postData:{filters:favorites[e].filter},search:!0}),grid.getFilterGroup($("#grid"),JSON.parse(favorites[e].filter),!0,$("#curfilter"))):(a.setGridParam({postData:{filters:""},search:!0}),$("#curfilter").html("")),"sord"in favorites[e]&&"sidx"in favorites[e]?(a.setGridParam({sortname:favorites[e].sidx,sortorder:favorites[e].sord}),p=(favorites[e].sidx+" "+favorites[e].sord).split(",")):(a.setGridParam({sortname:"",sortorder:"asc"}),p=default_sort.split(","));var m=a.jqGrid("getGridParam");for(var f of m.colModel){(g=$("#"+m.id+"_"+f.name)).find("span.s-ico").css("display","none"),g.find("span.ui-grid-ico-sort").addClass("disabled"),g.find("span.ui-jqgrid-sort-order").html("&nbsp;"),f.lso=""}for(var f in p){var g,v=p[f].trim().split(" "),b=v[0].trim();(g=$("#"+m.id+"_"+b)).find("span.s-ico").css("display",""),"asc"==v[1].trim()?(g.find("span.ui-icon-asc").removeClass("disabled"),m.colModel[m.iColByName[b]].lso="asc-desc"):(g.find("span.ui-icon-desc").removeClass("disabled"),m.colModel[m.iColByName[b]].lso="desc-asc"),g.find("span.ui-jqgrid-sort-order").html(parseInt(f)+1)}o||a.jqGrid("setFrozenColumns"),a.trigger("reloadGrid"),a.setGridWidth($("#content-main").width()),grid.saveColumnConfiguration()}}},ERPconnection={IncrementalExport:function(t,e){var a=t.jqGrid("getGridParam","selarrrow");if(null!==a&&0!=a.length){var o=[];for(var i in a){var s=t.jqGrid("getRowData",a[i]);void 0===s.type&&(s.type=e),"proposed"==s.status&&o.push(s)}o!=[]&&($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("export")+'</h4></div><div class="modal-body"><p class="text-capitalize-first">'+gettext("export selected records")+'</p></div><div class="modal-footer"><input type="submit" id="button_export" role="button" class="btn btn-primary pull-right" value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-left" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#button_export").on("click",function(){$("#popup .modal-body p").html(gettext("connecting")+"..."),$.ajax({url:url_prefix+"/erp/upload/",data:JSON.stringify(o),type:"POST",contentType:"application/json",success:function(){var e=[];for(var o in $("#popup .modal-body p").html(gettext("Export successful")),$("#cancelbutton").val(gettext("Close")),$("#button_export").removeClass("btn-primary").prop("disabled",!0),a){"proposed"===t.jqGrid("getCell",a[o],"status")&&(t.jqGrid("setCell",a[o],"status","approved"),(e=t.jqGrid("getRowData",a[o])).status="approved")}t.jqGrid("setRowData",e),"function"==typeof checkrows&&checkrows(t,a)},error:function(t,e,a){$("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body p").html(t.responseText),$("#button_export").text(gettext("retry"))}})}),$("#actions1").html($("#actionsul").children().first().text()+'  <span class="caret"></span>'))}},SODepExport:function(t,e){var a=t.jqGrid("getGridParam","selarrrow");if(null!==a&&0!=a.length){var o=[];for(var i in a){void 0===(r=t.jqGrid("getRowData",a[i])).type&&(r.type=e),o.push(r)}if(o!=[]){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog" style="max-height: 80%; width: 90%; visibility: hidden"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("export")+'</h4></div><div class="modal-body"></div><div class="modal-footer"><input type="submit" id="button_export" role="button" class="btn btn-primary pull-right" disabled value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-left" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>');var s="?demand=";for(i=0;i<a.length;i++){var r;void 0===(r=t.jqGrid("getRowData",a[i])).type&&(r.type=e),"open"!=r.status&&"proposed"!=r.status||(s+=0==i?encodeURIComponent(a[i]):"&demand="+encodeURIComponent(a[i]))}$.ajax({url:url_prefix+"/demand/operationplans/"+s,type:"GET",contentType:"application/json",success:function(o){$("#popup .modal-body").html('<div class="table-responsive"><table class="table-condensed table-hover" id="forecastexporttable"><thead class="thead-default"></thead></table></div>');var s=["id","type","item","value","quantity","location","origin","startdate","enddate","criticality"];if("SO"==e){var r=$("<tr/>");for(r.append($("<th/>").html('<input id="cb_modaltableall" class="cbox" type="checkbox" aria-checked="false">')),i=0;i<s.length;i++)r.append($("<th/>").addClass("text-capitalize").text(gettext(s[i])));var l=$("<tbody/>");for(i=0;i<o.length;i++){var n=$("<tr/>"),d=$("<td/>");d.append($("<input/>").attr({id:"cb_modaltable-"+i,class:"cbox",type:"checkbox","aria-checked":"false"})),n.append(d);for(var c=0;c<s.length;c++)n.append($("<td/>").text(o[i][s[c]]));l.append(n)}}$("#popup table").append(l),$("#popup thead").append(r),$("#popup").modal({backdrop:"static",keyboard:!1}).on("shown.bs.modal",function(){$(this).find(".modal-dialog").css({"max-width":50+$("#forecastexporttable").width()+"px",visibility:"visible"})}).modal("show"),$("#button_export").on("click",function(){o=[];var e=[],i={},s=$("#forecastexporttable tr.selected");$.each(s,function(t,a){e=a.children,i.id=e[1].textContent,i.type=e[2].textContent,i.item=e[3].textContent,i.value=e[4].textContent,i.quantity=e[5].textContent,i.location=e[6].textContent,i.origin=e[7].textContent,i.startdate=e[8].textContent,i.enddate=e[9].textContent,i.criticality=e[10].textContent,o.push(i)}),$("#popup .modal-body").html(gettext("connecting")+"..."),$.ajax({url:url_prefix+"/erp/upload/",data:JSON.stringify(o),type:"POST",contentType:"application/json",success:function(){for(var e in $("#popup .modal-body").html(gettext("Export successful")),$("#cancelbutton").val(gettext("Close")),$("#button_export").toggleClass("btn-primary").prop("disabled",!0),a){"proposed"==t.jqGrid("getCell",a[e],"status")&&t.jqGrid("setCell",a[e],"status","approved")}},error:function(t,e,a){$("#popup .modal-title").html(gettext("Error during export")),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+t.responseText+"</div>"),$("#button_export").val(gettext("Retry")),$("#popup .modal-dialog").css({visibility:"visible"}),$("#popup").modal("show")}})}),$("#cb_modaltableall").click(function(){$("#forecastexporttable input[type=checkbox]").prop("checked",$(this).prop("checked")),$("#forecastexporttable tbody tr").toggleClass("selected"),$("#forecastexporttable tbody input[type=checkbox]:checked").length>0?$("#button_export").removeClass("active").addClass("active").prop("disabled",!1):$("#button_export").removeClass("active").prop("disabled",!0)}),$("#forecastexporttable tbody input[type=checkbox]").click(function(){$(this).parent().parent().toggleClass("selected"),$("#cb_modaltableall").prop("checked",0==$("#forecastexporttable tbody input[type=checkbox]:not(:checked)").length),$("#forecastexporttable tbody input[type=checkbox]:checked").length>0?$("#button_export").removeClass("active").addClass("active").prop("disabled",!1):$("#button_export").removeClass("active").prop("disabled",!0)}),$("#actions1").html($("#actionsul").children().first().text()+'  <span class="caret"></span>')},error:function(t,e,a){$("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+t.responseText+"</div>"),$("#button_export").val(gettext("Retry")),$("#popup .modal-dialog").css({visibility:"visible"}),$("#popup").modal("show")}})}}}},dashboard={dragAndDrop:function(){$(".cockpitcolumn").each(function(){Sortable.create($(this)[0],{group:"widgets",handle:".panel-heading",animation:100,onEnd:function(t){dashboard.save()}})}),$("#workarea").each(function(){Sortable.create($(this)[0],{group:"cockpit",handle:"h1",animation:100,onEnd:function(t){dashboard.save()}})}),$(".panel-toggle").click(function(){var t=$(this);t.toggleClass("fa-minus fa-plus"),t.closest(".panel").find(".panel-body").toggle()}),$(".panel-close").click(function(){$(this).closest(".panel").remove(),dashboard.save()})},save:function(t){var e=[];if($("[data-cockpit-row]").each(function(){var t=$(this).attr("data-cockpit-row"),a=[];$(".cockpitcolumn",this).each(function(){var t=12;$(this).hasClass("col-md-12")?t=12:$(this).hasClass("col-md-11")?t=11:$(this).hasClass("col-md-10")?t=10:$(this).hasClass("col-md-9")?t=9:$(this).hasClass("col-md-8")?t=8:$(this).hasClass("col-md-7")?t=7:$(this).hasClass("col-md-6")?t=6:$(this).hasClass("col-md-5")?t=5:$(this).hasClass("col-md-4")?t=4:$(this).hasClass("col-md-3")?t=3:$(this).hasClass("col-md-2")&&(t=2);var e=[];$("[data-cockpit-widget]",this).each(function(){e.push([$(this).attr("data-cockpit-widget"),{}])}),a.push({width:t,widgets:e})}),a.length>0&&e.push({rowname:t,cols:a})}),"undefined"!=typeof url_prefix)var a=url_prefix+"/settings/";else a="/settings/";$.ajax({url:a,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({"freppledb.common.cockpit":e}),success:function(){"string"===$.type(t)&&(window.location.href=window.location.href)},error:function(t,e,a){$("#popup").html('<div class="modal-dialog" style="width: auto"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Error")+'</h4></div><div class="modal-body"><p>'+t.responseText+"  "+e+a+'</p></div><div class="modal-footer"></div></div></div>').modal("show")}})},customize:function(t){var e="";$("[data-cockpit-row='"+t+"'] .cockpitcolumn").each(function(){""!=e&&(e+=" - "),$(this).hasClass("col-md-12")?e+="100%":$(this).hasClass("col-md-11")?e+="92%":$(this).hasClass("col-md-10")?e+="83%":$(this).hasClass("col-md-9")?e+="75%":$(this).hasClass("col-md-8")?e+="67%":$(this).hasClass("col-md-7")?e+="58%":$(this).hasClass("col-md-6")?e+="50%":$(this).hasClass("col-md-5")?e+="42%":$(this).hasClass("col-md-4")?e+="33%":$(this).hasClass("col-md-3")?e+="25%":$(this).hasClass("col-md-2")&&(e+="17%")});for(var a='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Customize a dashboard row")+'</h4></div><div class="modal-body"><form class="form-horizontal"><div class="form-group"><label class="col-md-3 control-label" for="id_name">'+gettext("Name")+':</label><div class="col-md-9"><input id="id_name" class="form-control" type="text" value="'+t+'"></div></div><div class="form-group"><label class="col-md-3 control-label" for="id_layout2">'+gettext("Layout")+':</label><div class="col-md-9 dropdown dropdown-submit-input"><button class="btn btn-default dropdown-toggle" id="id_layout2" name="layout" type="button" data-toggle="dropdown" aria-haspopup="true"><span id="id_layout">'+e+'</span>&nbsp;<span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="id_layout" id="id_layoutul"><li class="dropdown-header">'+gettext("Single column")+'</li><li><a onclick="dashboard.setlayout(this)">100%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Two columns")+'</li><li><a onclick="dashboard.setlayout(this)">75% - 25%</a></li><li><a onclick="dashboard.setlayout(this)">67% - 33%</a></li><li><a onclick="dashboard.setlayout(this)">50% - 50%</a></li><li><a onclick="dashboard.setlayout(this)">33% - 67%</a></li><li><a onclick="dashboard.setlayout(this)">25% - 75%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Three columns")+'</li><li><a onclick="dashboard.setlayout(this)">50% - 25% - 25%</a></li><li><a onclick="dashboard.setlayout(this)">33% - 33% - 33%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Four columns")+'</li><li><a onclick="dashboard.setlayout(this)">25% - 25% - 25% - 25%</a></li></ul></div></div><div class="form-group"><label class="col-md-3 control-label" for="id_widget2">'+gettext("Add widget")+':</label><div class="col-md-9 dropdown dropdown-submit-input"><button class="btn btn-default dropdown-toggle" id="id_widget2" type="button" data-toggle="dropdown"><span id="id_widget">-</span>&nbsp;<span class="caret"></span></button><ul class="dropdown-menu col-sm-9" aria-labelledby="id_widget2" id="id_widgetul">',o=hiddenwidgets.length,i=0;i<o;i++)a+='<li><a onclick="dashboard.setwidget('+i+')">'+hiddenwidgets[i][1]+"</a></li>";a+='</ul></div><span id="newwidgetname" style="display:none"></span></div></form></div><div class="modal-footer"><input type="submit" role="button" onclick=\'$("#popup").modal("hide")\' class="btn btn-primary pull-left" data-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" role="button" onclick=\'dashboard.saveCustomization("'+t+'")\' class="btn btn-primary pull-right" value="'+gettext("Save")+'"><input type="submit" role="button" onclick=\'dashboard.addRow("'+t+'", false)\' class="btn btn-primary pull-right" value="'+gettext("Add new below")+'"><input type="submit" role="button" onclick=\'dashboard.addRow("'+t+'", true)\' class="btn btn-primary pull-right" value="'+gettext("Add new above")+'"><input type="submit" role="button" onclick=\'dashboard.deleteRow("'+t+'")\' class="btn btn-primary pull-right" value="'+gettext("Delete")+'"></div></div></div></div>',$("#popup").html(a).modal("show")},setlayout:function(t){$("#id_layout").text($(t).text())},setwidget:function(t){$("#id_widget").text(hiddenwidgets[t][1]),$("#newwidgetname").text(hiddenwidgets[t][0])},saveCustomization:function(t){var e=$("#id_name").val();if(t!=e){for(var a=2;$("[data-cockpit-row='"+e+"']").length>1;)e=$("#id_name").val()+" - "+a++;$("[data-cockpit-row='"+t+"'] .col-md-11 h1").text(e),$("[data-cockpit-row='"+t+"'] h1 button").attr("onclick","dashboard.customize('"+e+"')"),$("[data-cockpit-row='"+t+"'] .horizontal-form").attr("id",e),$("[data-cockpit-row='"+t+"']").attr("data-cockpit-row",e)}var o=$("#id_layout").text().split("-"),i=0,s=null;for($("[id='"+t+"'] .cockpitcolumn").each(function(){i<o.length?(s=this,$(this).removeClass("col-md-1 col-md-2 col-md-3 col-md-4 col-md-5 col-md-6 col-md-7 col-md-8 col-md-9 col-md-10 col-md-11 col-md-12"),$(this).addClass("col-md-"+Math.round(.12*parseInt(o[i])))):($("[data-cockpit-widget]",this).appendTo(s),$(this).remove()),i++});i<o.length;)s=$('<div class="cockpitcolumn col-md-'+Math.round(.12*parseInt(o[i]))+' col-sm-12"></div>').insertAfter(s),i++;var r=$("#newwidgetname").text();""!=r?($('<div class="panel panel-default" data-cockpit-widget="'+r+'"></div>').appendTo(s),dashboard.save("true")):dashboard.save(),dashboard.dragAndDrop(),$("#popup").modal("hide")},deleteRow:function(t){$("[data-cockpit-row='"+t+"']").remove(),dashboard.save(),$("#popup").modal("hide")},addRow:function(t,e){for(var a=$("#id_name").val(),o=2;$("[data-cockpit-row='"+a+"']").length>=1;)a=$("#id_name").val()+" - "+o++;for(var i='<div class="row" data-cockpit-row="'+a+'"><div class="col-md-11"><h1 style="float: left">'+a+'</h1></div><div class="col-md-1"><h1 class="pull-right"><button class="btn btn-xs btn-primary" onclick="dashboard.customize(\''+a+'\')" data-toggle="tooltip" data-placement="top" data-original-title="'+gettext("Customize")+'"><span class="fa fa-wrench"></span></button></h1></div><div class="horizontal-form" id="'+a+'">',s=$("#id_layout").text().split("-"),r=$("#newwidgetname").text(),l=0;l<s.length;l++)i+='<div class="cockpitcolumn col-md-'+Math.round(.12*parseInt(s[l]))+' col-sm-12">',0==l&&""!=r&&(i+='<div class="panel panel-default" data-cockpit-widget="'+r+'"></div>'),i+="</div>";i+="</div></div></div>",e?$("[data-cockpit-row='"+t+"']").first().before($(i)):$("[data-cockpit-row='"+t+"']").last().after($(i)),""!=r?dashboard.save("true"):dashboard.save(),dashboard.dragAndDrop(),$("#popup").modal("hide")}};function savePreference(t,e,a){if("undefined"!=typeof url_prefix)var o=url_prefix+"/settings/";else o="/settings/";var i={};i[t]=e,$.ajax({url:o,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(i),success:function(){"function"==typeof a&&a()}})}function getCookie(t){for(var e=document.cookie.split(";"),a=t+"=",o=e.length;o>=0;o--)if(0==jQuery.trim(e[o]).indexOf(a))return jQuery.trim(e[o]).substr(a.length);return null}function setCookie(t,e,a){var o="";if(a){var i=new Date;i.setTime(i.getTime()+24*a*60*60*1e3),o="; expires="+i.toUTCString()}document.cookie=t+"="+(e||"")+o+"; path=/"}function sameOrigin(t){var e="//"+document.location.host,a=document.location.protocol+e;return t==a||t.slice(0,a.length+1)==a+"/"||t==e||t.slice(0,e.length+1)==e+"/"||!/^(\/\/|http:|https:).*/.test(t)}function about_show(){$.ajax({url:"/about/",type:"GET",contentType:"application/json",success:function(t){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").modal({keyboard:!1,backdrop:"static"});var e=t.version.split("."),a=t.website,o='<div class="modal-dialog" style="width: 450px;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">About frePPLe '+t.version+' Community Edition</h4></div><div class="modal-body"><div class="row">';for(var i in o+='<div class="col-sm-5"><br><br><p><a target="_blank" href="'+a+'"><strong>frePPLe website &nbsp;<span class="fa fa-caret-right"></span></strong></a></p><br><p><a target="_blank" href="'+a+"/docs/"+e[0]+"."+e[1]+'/license.html"><strong>License information &nbsp;<span class="fa fa-caret-right"></span></strong></a></p><br><p><a target="_blank" href="'+a+"/docs/"+e[0]+"."+e[1]+'/index.html"><strong>Documentation &nbsp;<span class="fa fa-caret-right"></span></strong></a></p></div><div class="col-sm-7"><strong>'+gettext("Installed apps")+":</strong>",t.apps)o+="<br>&nbsp;&nbsp;"+t.apps[i];o+="</div></div></div></div></div>",$("#popup").html(o).modal("show")},error:function(t,e,a){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog style="width: 400px;"><div class="modal-content"><div class="modal-header bg-danger"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">About frePPLe</h4></div><div class="modal-body"><p>'+gettext("Error")+"</p></div></div></div>").modal("show")}})}function import_show(t,e,a,o,i){var s={abort:function(){}};$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").modal({keyboard:!1,backdrop:"static"});var r='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title"><span id="modal_title">'+gettext("Import CSV or Excel file")+'</span>&nbsp;<span id="animatedcog" class="fa fa-cog fa-spin fa-2x fa-fw" style="visibility: hidden;"></span></h4></div><div class="modal-body"><form id="uploadform"><p id="extra_text">'+gettext("Load an Excel file or a CSV-formatted text file.")+"<br>"+gettext("The first row should contain the field names.")+'<br><br><input type="checkbox" autocomplete="off" name="erase" value="yes"/>&nbsp;&nbsp;'+gettext("First delete all existing records AND ALL RELATED TABLES")+"<br><br></p>";isDragnDropUploadCapable()?r+='<div class="box" style="outline: 2px dashed black; outline-offset: -10px"><div class="box__input" style="text-align: center; padding: 20px;"><i class="fa fa-sign-in fa-5x fa-rotate-90"></i><input class="box__file invisible" type="file" id="csv_file" name="csv_file" data-multiple-caption="{count} '+gettext("files selected")+'" multiple/><label id="uploadlabel" for="csv_file"><kbd>'+gettext("Select files")+'</kbd>&nbsp;<span class="box__dragndrop" style="display: inline;">'+gettext("or drop them here")+'</span>.</label></div><div class="box__uploading" style="display: none;">Uploading&hellip;</div><div class="box__success" style="display: none;">Done!</div><div class="box__error" style="display: none;">Error!<span></span>.</div></div>':r+=gettext("Data file")+':<input type="file" id="csv_file" name="csv_file"/>',r+='<br></form><div style="margin: 5px 0"><div id="uploadResponse" style="height: 50vh; resize: vertical; display: none; background-color: inherit; border: none; overflow: auto;"></div></div></div><div class="modal-footer"><input type="submit" id="importbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Import")+'"><input type="submit" id="cancelimportbutton" role="button" class="btn btn-primary pull-left" value="'+gettext("Cancel Import")+'" style="display: none;"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-left" data-dismiss="modal" value="'+gettext("Close")+'"><input type="submit" id="copytoclipboard" role="button" class="btn btn-primary pull-left" value="'+gettext("Copy to Clipboard")+'" style="display: none;"></div></div></div>',$("#popup").html(r).modal("show"),a||$("#selected_files").removeAttr(a),""!==t&&$("#modal_title").text(t),null===e?$("#extra_text").remove():""!==e&&$("#extra_text").text(e);var l=!1,n=!1;isDragnDropUploadCapable()&&$(".box").on("drag dragstart dragend dragover dragenter dragleave drop",function(t){t.preventDefault(),t.stopPropagation()}).on("dragover dragenter",function(){$(".box").removeClass("bg-warning").addClass("bg-warning")}).on("dragleave dragend drop",function(){$(".box").removeClass("bg-warning")}).on("drop",function(t){l=a?t.originalEvent.dataTransfer.files:[t.originalEvent.dataTransfer.files[0]],$("#uploadlabel").text(l.length>1?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",l.length):l[0].name)}),$("#csv_file").on("change",function(t){n=a?t.target.files:[t.target.files[0]],$("#uploadlabel").text(n.length>1?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",n.length):n[0].name)}),null!==i&&void 0!==i&&(l=a?i:[i[0]],$("#uploadlabel").text(l.length>1?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",l.length):l[0].name)),$("#importbutton").on("click",function(){if(""!==$("#csv_file").val()||l){var t="";$("#uploadResponse").css("display","block"),$("#uploadResponse").html(gettext("Importing...")),$("#uploadResponse").on("scroll",function(){parseInt($("#uploadResponse").attr("data-scrolled"))!==$("#uploadResponse").scrollTop()&&($("#uploadResponse").attr("data-scrolled",!0),$("#uploadResponse").off("scroll"))}),$("#importbutton").hide(),$("#animatedcog").css("visibility","visible"),$("#uploadform").css("display","none"),$("#copytoclipboard").on("click",function(){var t=document.createRange();t.selectNode(document.getElementById("uploadResponse")),window.getSelection().removeAllRanges(),window.getSelection().addRange(t),document.execCommand("copy")}),$("#cancelimportbutton").show().on("click",function(){var t=$("#uploadResponse").clone();t.append("<div><strong>"+gettext("Canceled")+"</strong></div>"),s.abort(),$("#animatedcog").css("visibility","hidden"),$("#uploadResponse").append(t.contents()),$("#uploadResponse").scrollTop($("#uploadResponse")[0].scrollHeight),$("#cancelimportbutton").hide(),$("#copytoclipboard").show()}),t=new FormData($("#uploadform")[0]),l&&$.each(l,function(e,a){t.append(a.name,a)}),n&&(t.delete("csv_file"),$.each(n,function(e,a){t.append(a.name,a)})),s=$.ajax(Object.assign({type:"post",url:"undefined"!=typeof url?url:"",cache:!1,data:t,success:function(t){var e=$("#uploadResponse");e.html(t),"true"!==e.attr("data-scrolled")&&e.scrollTop(e[0].scrollHeight-e.height()),$("#cancelbutton").html(gettext("Close")),$("#importbutton").hide(),$("#animatedcog").css("visibility","hidden"),$("#cancelimportbutton").hide(),document.queryCommandSupported("copy")&&$("#copytoclipboard").show(),$("#grid").trigger("reloadGrid")},xhrFields:{onprogress:function(t){var e=$("#uploadResponse");e.html(t.currentTarget.response),"true"!==e.attr("data-scrolled")&&(e.attr("data-scrolled",e[0].scrollHeight-e.height()),e.scrollTop(e[0].scrollHeight-e.height()))}},error:function(){$("#cancelimportbutton").hide(),$("#copytoclipboard").show(),$("#animatedcog").css("visibility","hidden"),$("#uploadResponse").scrollTop($("#uploadResponse")[0].scrollHeight)},processData:!1,contentType:!1},o))}})}function getURLparameters(){if(0==window.location.search.length)return{};var t={};return jQuery.each(window.location.search.match(/^\??(.*)$/)[1].split("&"),function(e,a){(a=a.split("="))[1]=unescape(a[1]).replace(/\+/g," "),t[a[0]]=t[a[0]]?t[a[0]]instanceof Array?(t[a[0]].push(a[1]),t[a[0]]):[t[a[0]],a[1]]:a[1]}),t}function selectDatabase(){var t=$(this).attr("data-database");database!=t&&("default"==database?"/"==window.location.pathname?window.location.href="/"+t+"/":window.location.href=window.location.href.replace(window.location.pathname,"/"+t+window.location.pathname):window.location.href="default"==t?window.location.href.replace("/"+database+"/","/"):window.location.href.replace("/"+database+"/","/"+t+"/"))}$(function(){$(document).ajaxSend(function(t,e,a){!/^(GET|HEAD|OPTIONS|TRACE)$/.test(a.type)&&sameOrigin(a.url)&&e.setRequestHeader("X-CSRFToken",getCookie("csrftoken"))}),$.ajaxSetup({cache:!1});var t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:url_prefix+"/search/?term=%QUERY",wildcard:"%QUERY"}});$("#search").typeahead({minLength:2},{limit:1e3,highlight:!0,name:"search",display:"value",source:t,templates:{suggestion:function(t){if(null===t.value)return'<span><p style="margin-top: 5px; margin-bottom: 1px;">'+$.jgrid.htmlEncode(t.label)+'</p><li  role="separator" class="divider"></li></span>';var e=url_prefix+t.url+admin_escape(t.value);return t.removeTrailingSlash||(e+="/?noautofilter"),'<li><a href="'+e+'" >'+$.jgrid.htmlEncode(t.display)+'</a><div class="tt-external"><a target="_blank" href="'+e+'"><i class="fa fa-external-link" aria-hidden="true"></i></a></div></li>'}}})}),$.fn.bindFirst=function(t,e){this.on(t,e),this.each(function(){var e=$._data(this,"events")[t.split(".")[0]],a=e.pop();e.splice(0,0,a)})};var graph={header:function(t,e){var a=$("#grid_graph");a.html("");var o=e.range(),i=e.rangeBand(),s=d3.select(a.get(0)).append("svg");s.attr("height","15px"),s.attr("width",a.width());var r=0;for(var l in timebuckets){var n=t+o[l]+i/2;if(r<=n)r=n+s.append("text").attr("class","svgheadertext").attr("x",n).attr("y","12").text(timebuckets[l].name).node().getComputedTextLength()+12}},showTooltip:function(t){var e=d3.select("#tooltip");e.empty()&&(e=d3.select("body").append("div").attr("id","tooltip").attr("role","tooltip").attr("class","popover fade right in").style("position","absolute")),e.html(""+t).style("display","block"),graph.moveTooltip()},hideTooltip:function(){d3.select("#tooltip").style("display","none"),d3.event.stopPropagation()},moveTooltip:function(){var t=d3.event.pageX+5,e=d3.event.pageY-28,a=$(window).width()-$("#tooltip").width()-20,o=$(window).height()-$("#tooltip").height()-20;t>a&&(t=a,e=d3.event.pageY+5),e>o&&(e=d3.event.pageY-$("#tooltip").height()-25),d3.select("#tooltip").style({left:t+"px",top:e+"px"}),d3.event.stopPropagation()},miniAxis:function(t){var e=this.scale().range(),a=this.scale().domain();t.append("path").attr("class","domain").attr("d","M-10 0 H0 V"+(e[0]-2)+" H-10"),t.append("text").attr("x",-2).attr("y",13).attr("text-anchor","end").text(grid.formatNumber(Math.round(a[1]))),t.append("text").attr("x",-2).attr("y",e[0]-5).attr("text-anchor","end").text(Math.round(a[0],0))}},gantt={startmousemove:null,resizing:null,rowsize:25,header:function(){var t=864e5/(viewend.getTime()-viewstart.getTime())*$("#jqgh_grid_operationplans").width(),e=['<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="34px">','<line class="time" x1="0" y1="17" x2="'+$("#jqgh_grid_operationplans").width()+'" y2="17"/>'],a=0;if(t<5)for(var o=new Date(viewstart.getFullYear(),viewstart.getMonth(),1);o<viewend;){var i=(o.getTime()-viewstart.getTime())/864e5*t,s=new Date(o.getFullYear(),o.getMonth()+1,1),r=(s.getTime()-viewstart.getTime())/864e5*t;if(e.push('<text class="svgheadertext" x="'+Math.floor((i+r)/2)+'" y="31">'+moment(o).format("MMM")+"</text>"),o.getMonth()%3==0){r=(new Date(o.getFullYear(),o.getMonth()+3,1).getTime()-viewstart.getTime())/864e5*t;var l=Math.floor((o.getMonth()+3)/3);e.push('<line class="time" x1="'+Math.floor(i)+'" y1="0" x2="'+Math.floor(i)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor((i+r)/2)+'" y="13">'+o.getFullYear()+" Q"+l+"</text>")}else e.push('<line class="time" x1="'+Math.floor(i)+'" y1="17" x2="'+Math.floor(i)+'" y2="34"/>');o=s}else if(t<10){a-=viewstart.getDay()*t;for(o=new Date(viewstart.getTime()-864e5*viewstart.getDay());o<viewend;)e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+3.5*t)+'" y="31">'+moment(o).format("MM-DD")+"</text>"),a+=7*t,o.setTime(o.getTime()+6048e5);for(o=new Date(viewstart.getFullYear(),viewstart.getMonth(),1);o<viewend;)i=(o.getTime()-viewstart.getTime())/864e5*t,r=((s=new Date(o.getFullYear(),o.getMonth()+1,1)).getTime()-viewstart.getTime())/864e5*t,e.push('<line class="time" x1="'+Math.floor(i)+'" y1="0" x2="'+Math.floor(i)+'" y2="17"/>'),e.push('<text class="svgheadertext" x="'+Math.floor((i+r)/2)+'" y="13">'+moment(o).format("MMM YY")+"</text>"),o=s}else if(t<20){a-=viewstart.getDay()*t;for(o=new Date(viewstart.getTime()-864e5*viewstart.getDay());o<viewend;)e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+(a+7*t/2)+'" y="31">'+moment(o).format("YY-MM-DD")+"</text>"),a+=7*t,o.setTime(o.getTime()+6048e5);for(o=new Date(viewstart.getFullYear(),viewstart.getMonth(),1);o<viewend;)i=(o.getTime()-viewstart.getTime())/864e5*t,r=((s=new Date(o.getFullYear(),o.getMonth()+1,1)).getTime()-viewstart.getTime())/864e5*t,e.push('<line class="time" x1="'+Math.floor(i)+'" y1="0" x2="'+Math.floor(i)+'" y2="17"/>'),e.push('<text class="svgheadertext" x="'+Math.floor((i+r)/2)+'" y="13">'+moment(o).format("MMM YY")+"</text>"),o=s}else if(t<=40)for(o=new Date(viewstart.getTime());o<viewend;)0==o.getDay()?(e.push('<line class="time" x1="'+Math.floor(a)+'" y1="0" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+7*t/2)+'" y="13">'+moment(o).format("YY-MM-DD")+"</text>")):e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+t/2)+'" y="31">'+moment(o).format("DD")+"</text>"),a+=t,o.setDate(o.getDate()+1);else if(t<=75)for(o=new Date(viewstart.getTime());o<viewend;)0==o.getDay()?(e.push('<line class="time" x1="'+Math.floor(a)+'" y1="0" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+7*t/2)+'" y="13">'+moment(o).format("YY-MM-DD")+"</text>")):e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+t/2)+'" y="31">'+moment(o).format("DD MM")+"</text>"),a+=t,o.setDate(o.getDate()+1);else if(t<350)for(o=new Date(viewstart.getTime());o<viewend;)0==o.getDay()?(e.push('<line class="time" x1="'+Math.floor(a)+'" y1="0" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+3.5*t)+'" y="13">'+moment(o).format("YY-MM-DD")+"</text>")):e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+t/2)+'" y="31">'+moment(o).format("ddd DD MMM")+"</text>"),a+=t,o.setDate(o.getDate()+1);else for(o=new Date(viewstart.getTime());o<viewend;)0==o.getHours()?(e.push('<line class="time" x1="'+Math.floor(a)+'" y1="0" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+t/2)+'" y="13">'+moment(o).format("ddd YY-MM-DD")+"</text>")):e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+t/48)+'" y="31">'+o.getHours()+"</text>"),a+=t/24,o.setTime(o.getTime()+36e5);e.push("</svg>"),$("#jqgh_grid_operationplans").html(e.join("")).unbind("mousedown").bind("mousedown",function(t){gantt.startmousemove=t.pageX,$(window).bind("mouseup",function(t){$(window).unbind("mousemove"),$(window).unbind("mouseup"),t.stopPropagation()}),$(window).bind("mousemove",function(t){var e=t.pageX-gantt.startmousemove;Math.abs(e)>3&&(gantt.zoom(1,e>0?-864e5:864e5),gantt.startmousemove=t.pageX),t.stopPropagation()}),t.stopPropagation()})},reset:function(){var t=$("#jqgh_grid_operationplans").width()/1e4;viewstart=new Date(horizonstart.getTime()),viewend=new Date(horizonend.getTime()),$(".transformer").each(function(){var e=$(this).attr("title");$(this).attr("transform","scale("+t+",1) translate(0,"+((e-1)*gantt.rowsize+3)+")")}),gantt.header()},redraw:function(){var t=(horizonend.getTime()-horizonstart.getTime())/(viewend.getTime()-viewstart.getTime())*$("#jqgh_grid_operationplans").width()/1e4;$(".transformer").each(function(){var e=$(this).attr("title");$(this).attr("transform","scale("+t+",1) translate(0,"+((e-1)*gantt.rowsize+3)+")")}),gantt.header()},zoom:function(t,e){var a=Math.min(1095,Math.max(1,Math.ceil((viewend.getTime()-viewstart.getTime())/864e5*t)));viewstart.setTime(viewstart.getTime()+e),viewend.setTime(viewstart.getTime()+864e5*a);var o=(horizonend.getTime()-horizonstart.getTime())/(864e6*a)*$("#jqgh_grid_operationplans").width()/1e3,i=(horizonstart.getTime()-viewstart.getTime())/(horizonend.getTime()-horizonstart.getTime())*1e4;$(".transformer").each(function(){var t=$(this).attr("title");$(this).attr("transform","scale("+o+",1) translate("+i+","+((t-1)*gantt.rowsize+3)+")")}),gantt.header()}};function Gauge(t,e){this.placeholderName=t;var a=this;this.configure=function(t){this.config=t,this.config.size=.9*this.config.size,this.config.raduis=.97*this.config.size/2,this.config.cx=this.config.size/2,this.config.cy=this.config.size/2,this.config.min=void 0!=t.min?t.min:0,this.config.max=void 0!=t.max?t.max:100,this.config.range=this.config.max-this.config.min,this.config.majorTicks=t.majorTicks||5,this.config.minorTicks=t.minorTicks||2,this.config.greenColor=t.greenColor||"#109618",this.config.yellowColor=t.yellowColor||"#FF9900",this.config.redColor=t.redColor||"#DC3912",this.config.transitionDuration=t.transitionDuration||500},this.render=function(){for(var t in this.body=d3.select("#"+this.placeholderName).append("svg:svg").attr("class","gauge").attr("width",this.config.size).attr("height",this.config.size),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",this.config.raduis).style("fill","#ccc").style("stroke","#000").style("stroke-width","0.5px"),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.9*this.config.raduis).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width","2px"),this.config.greenZones)this.drawBand(this.config.greenZones[t].from,this.config.greenZones[t].to,a.config.greenColor);for(var t in this.config.yellowZones)this.drawBand(this.config.yellowZones[t].from,this.config.yellowZones[t].to,a.config.yellowColor);for(var t in this.config.redZones)this.drawBand(this.config.redZones[t].from,this.config.redZones[t].to,a.config.redColor);if(void 0!=this.config.label){var e=Math.round(this.config.size/9);this.body.append("svg:text").attr("x",this.config.cx).attr("y",this.config.cy/2+e/2).attr("dy",e/2).attr("text-anchor","middle").text(this.config.label).style("font-size",e+"px").style("fill","#333").style("stroke-width","0px")}e=Math.round(this.config.size/16);for(var o=this.config.range/(this.config.majorTicks-1),i=this.config.min;i<=this.config.max;i+=o){for(var s=o/this.config.minorTicks,r=i+s;r<Math.min(i+o,this.config.max);r+=s){var l=this.valueToPoint(r,.75),n=this.valueToPoint(r,.85);this.body.append("svg:line").attr("x1",l.x).attr("y1",l.y).attr("x2",n.x).attr("y2",n.y).style("stroke","#666").style("stroke-width","1px")}l=this.valueToPoint(i,.7),n=this.valueToPoint(i,.85);if(this.body.append("svg:line").attr("x1",l.x).attr("y1",l.y).attr("x2",n.x).attr("y2",n.y).style("stroke","#333").style("stroke-width","2px"),i==this.config.min||i==this.config.max){var d=this.valueToPoint(i,.63);this.body.append("svg:text").attr("x",d.x).attr("y",d.y).attr("dy",e/3).attr("text-anchor",i==this.config.min?"start":"end").text(i).style("font-size",e+"px").style("fill","#333").style("stroke-width","0px")}}var c=this.body.append("svg:g").attr("class","pointerContainer"),p=(this.config.min+this.config.max)/2,u=this.buildPointerPath(p),h=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("basis");c.selectAll("path").data([u]).enter().append("svg:path").attr("d",h).style("fill","#dc3912").style("stroke","#c63310").style("fill-opacity",.7),c.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.12*this.config.raduis).style("fill","#4684EE").style("stroke","#666").style("opacity",1);e=Math.round(this.config.size/10);c.selectAll("text").data([p]).enter().append("svg:text").attr("x",this.config.cx).attr("y",this.config.size-this.config.cy/4-e).attr("dy",e/2).attr("text-anchor","middle").style("font-size",e+"px").style("fill","#000").style("stroke-width","0px"),this.redraw(this.config.value,0)},this.buildPointerPath=function(t){var e=this.config.range/13,o=d(t,.85),i=d(t-e,.12),s=d(t+e,.12),r=t-this.config.range*(1/.75)/2,l=d(r,.28),n=d(r-e,.12);return[o,i,d(r+e,.12),l,n,s,o];function d(t,e){var o=a.valueToPoint(t,e);return o.x-=a.config.cx,o.y-=a.config.cy,o}},this.drawBand=function(t,e,o){0>=e-t||this.body.append("svg:path").style("fill",o).attr("d",d3.svg.arc().startAngle(this.valueToRadians(t)).endAngle(this.valueToRadians(e)).innerRadius(.65*this.config.raduis).outerRadius(.85*this.config.raduis)).attr("transform",function(){return"translate("+a.config.cx+", "+a.config.cy+") rotate(270)"})},this.redraw=function(t,e){var o=this.body.select(".pointerContainer");o.selectAll("text").text(Math.round(t)),o.selectAll("path").transition().duration(void 0!=e?e:this.config.transitionDuration).attrTween("transform",function(){var e=t;t>a.config.max?e=a.config.max+.02*a.config.range:t<a.config.min&&(e=a.config.min-.02*a.config.range);var o=a.valueToDegrees(e)-90,i=a._currentRotation||o;return a._currentRotation=o,function(t){var e=i+(o-i)*t;return"translate("+a.config.cx+", "+a.config.cy+") rotate("+e+")"}})},this.valueToDegrees=function(t){return t/this.config.range*270-(this.config.min/this.config.range*270+45)},this.valueToRadians=function(t){return this.valueToDegrees(t)*Math.PI/180},this.valueToPoint=function(t,e){return{x:this.config.cx-this.config.raduis*e*Math.cos(this.valueToRadians(t)),y:this.config.cy-this.config.raduis*e*Math.sin(this.valueToRadians(t))}},this.configure(e)}function showModalImage(t,e){var a=$("#popup");a.html('<div class="modal-dialog modal-lg" style="margin-top: 20px; width:90%; margin-left: auto; margin-right: auto"><div class="modal-content"><div class="modal-header" style="border-top-left-radius: inherit; border-top-right-radius: inherit"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title"></h4></div><div class="modal-body"><img src="" style="width:100%"></div></div></div>'),a.find("h4").text(e),a.find("img").attr("src",$(t.target).attr("src")),a.modal("show"),t.preventDefault()}$.fn.drags=function(t){if(""===(t=$.extend({handle:"",cursor:"move"},t)).handle)var e=this;else e=this.find(t.handle);return e.css("cursor",t.cursor).on("mousedown",function(e){if(""===t.handle)var a=$(this).addClass("draggable");else a=$(this).addClass("active-handle").parent().addClass("draggable");var o=a.css("z-index"),i=a.outerHeight(),s=a.outerWidth(),r=a.offset().top+i-e.pageY,l=a.offset().left+s-e.pageX;a.css("z-index",1e3).parents().on("mousemove",function(t){$(".draggable").offset({top:t.pageY+r-i,left:t.pageX+l-s}).on("mouseup",function(){$(this).removeClass("draggable").css("z-index",o)})}),e.preventDefault()}).on("mouseup",function(){""===t.handle?$(this).removeClass("draggable"):$(this).removeClass("active-handle").parent().removeClass("draggable")})};
//# sourceMappingURL=frepple.min.js.map