<?xml version="1.0" encoding="UTF-8" ?>
<!--
 Copyright (C) 2007-2013 by frePPLe bvba

 This library is free software; you can redistribute it and/or modify it
 under the terms of the GNU Affero General Public License as published
 by the Free Software Foundation; either version 3 of the License, or
 (at your option) any later version.

 This library is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
 General Public License for more details.

 You should have received a copy of the GNU Affero General Public
 License along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<xsd:schema xmlns:xsd='http://www.w3.org/2001/XMLSchema'
  elementFormDefault="unqualified" attributeFormDefault="unqualified" version="4.4.3">

  <!-- ACTION -->
  <xsd:simpleType name="action">
    <xsd:annotation>
      <xsd:documentation>
        The input uses an attribute of this type to identify what action to
        perform on the specified entity: A: Add an new entity, and report an
        error if the entity already exists C: Change an existing entity, and
        report an error if the entity doesn't exist yet. AC: Change an entity or
        create a new one if it doesn't exist yet. This is the default. D: Delete
        an entity, and report an error if the entity doesn't exist.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:restriction base="xsd:string">
      <xsd:enumeration value="A" />
      <xsd:enumeration value="C" />
      <xsd:enumeration value="AC" />
      <xsd:enumeration value="R" />
    </xsd:restriction>
  </xsd:simpleType>

  <xsd:simpleType name="search">
    <xsd:restriction base="xsd:string">
      <xsd:enumeration value="PRIORITY" />
      <xsd:enumeration value="MINCOST" />
      <xsd:enumeration value="MINPENALTY" />
      <xsd:enumeration value="MINCOSTPENALTY" />
    </xsd:restriction>
  </xsd:simpleType>

  <xsd:simpleType name="positiveDouble">
    <xsd:restriction base="xsd:double">
      <xsd:minInclusive value="0" />
    </xsd:restriction>
  </xsd:simpleType>

  <xsd:simpleType name="percentage">
    <xsd:restriction base="xsd:double">
      <xsd:minInclusive value="0" />
      <xsd:maxInclusive value="100" />
    </xsd:restriction>
  </xsd:simpleType>

  <xsd:simpleType name="non-empty-string">
    <xsd:restriction base="xsd:normalizedString">
      <xsd:minLength value="1"/>
    </xsd:restriction>
  </xsd:simpleType>

  <xsd:complexType name="booleanproperty">
    <xsd:attribute name="name" type="non-empty-string" use="required" />
    <xsd:attribute name="value" type="xsd:boolean" />
  </xsd:complexType>

  <xsd:complexType name="stringproperty">
    <xsd:attribute name="name" type="non-empty-string" use="required" />
    <xsd:attribute name="value" type="xsd:string" />
  </xsd:complexType>

  <xsd:complexType name="doubleproperty">
    <xsd:attribute name="name" type="non-empty-string" use="required" />
    <xsd:attribute name="value" type="xsd:double" />
  </xsd:complexType>

  <xsd:complexType name="dateproperty">
    <xsd:attribute name="name" type="non-empty-string" use="required" />
    <xsd:attribute name="value" type="xsd:dateTime" />
  </xsd:complexType>

  <xsd:group name="common_fields">
    <xsd:choice>
      <xsd:element name="name" type="non-empty-string" />
      <xsd:element name="category" type="xsd:normalizedString" />
      <xsd:element name="subcategory" type="xsd:normalizedString" />
      <xsd:element name="description" type="xsd:string" />
      <xsd:element name="source" type="xsd:normalizedString" />
      <xsd:element name="booleanproperty" type="booleanproperty" />
      <xsd:element name="stringproperty" type="stringproperty" />
      <xsd:element name="doubleproperty" type="doubleproperty" />
      <xsd:element name="dateproperty" type="dateproperty" />
    </xsd:choice>
  </xsd:group>

  <xsd:attributeGroup name="common_attributes">
    <xsd:attribute name="name" type="non-empty-string" />
    <xsd:attribute name="category" type="xsd:normalizedString" />
    <xsd:attribute name="subcategory" type="xsd:normalizedString" />
    <xsd:attribute name="description" type="xsd:string" />
    <xsd:attribute name="source" type="xsd:normalizedString" />
    <xsd:attribute name="action" type="action" />
  </xsd:attributeGroup>

  <!-- LOCATION -->
  <xsd:complexType name="location">
    <xsd:annotation>
      <xsd:documentation>
        Buffers and resources are linked to a (physical or logical) location.
        Locations are merely used for simple association, and have no active use
        in the model.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:group ref="common_fields" />
      <xsd:element name="owner" type="location" />
      <xsd:element name="available" type="calendar" />
      <xsd:element name="members">
        <xsd:complexType>
          <xsd:sequence minOccurs="0" maxOccurs="unbounded">
            <xsd:element name="location" type="location" />
          </xsd:sequence>
        </xsd:complexType>
      </xsd:element>
    </xsd:choice>
    <xsd:attributeGroup ref="common_attributes" />
  </xsd:complexType>

  <xsd:complexType name="locationlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="location" type="location" />
    </xsd:choice>
  </xsd:complexType>

  <!-- CUSTOMER -->
  <xsd:complexType name="customer">
    <xsd:annotation>
      <xsd:documentation>
        Demand is linked to a customer. This association currently has no active
        use in the model.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:group ref="common_fields" />
      <xsd:element name="owner" type="customer" minOccurs="0" />
      <xsd:element name="members" minOccurs="0">
        <xsd:complexType>
          <xsd:sequence minOccurs="0" maxOccurs="unbounded">
            <xsd:element name="customer" type="customer" />
          </xsd:sequence>
        </xsd:complexType>
      </xsd:element>
    </xsd:choice>
    <xsd:attributeGroup ref="common_attributes" />
  </xsd:complexType>

  <xsd:complexType name="customerlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="customer" type="customer" />
    </xsd:choice>
  </xsd:complexType>

  <!-- SUPPLIER -->
  <xsd:complexType name="supplier">
    <xsd:annotation>
      <xsd:documentation>
        A supplier sells material to your company.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:group ref="common_fields" />
      <xsd:element name="owner" type="supplier" minOccurs="0" />
      <xsd:element name="members" minOccurs="0">
        <xsd:complexType>
          <xsd:sequence minOccurs="0" maxOccurs="unbounded">
            <xsd:element name="supplier" type="supplier" />
          </xsd:sequence>
        </xsd:complexType>
      </xsd:element>
      <xsd:element name="itemsuppliers" type="itemsupplierlist" />
    </xsd:choice>
    <xsd:attributeGroup ref="common_attributes" />
  </xsd:complexType>

  <xsd:complexType name="supplierlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="supplier" type="supplier" />
    </xsd:choice>
  </xsd:complexType>

  <!-- OPERATION -->
  <xsd:complexType name="operation">
    <xsd:annotation>
      <xsd:documentation>
        An operation defines an activity that can consume and produce material
        from buffers, load capacity on resources.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:group ref="common_fields" />
      <xsd:element name="item" type="item" />
      <xsd:element name="priority" type="xsd:integer" />
      <xsd:element name="effective_start" type="xsd:dateTime" />
      <xsd:element name="effective_end" type="xsd:dateTime" />
      <xsd:element name="duration" type="xsd:duration" />
      <xsd:element name="owner" type="operation" />
      <xsd:element name="detectproblems" type="xsd:boolean" />
      <xsd:element name="posttime" type="xsd:duration" />
      <xsd:element name="fence" type="xsd:duration" />
      <xsd:element name="size_minimum" type="positiveDouble" />
      <xsd:element name="size_minimum_calendar" type="calendar" />
      <xsd:element name="size_multiple" type="positiveDouble" />
      <xsd:element name="size_maximum" type="positiveDouble" />
      <xsd:element name="cost" type="positiveDouble" />
      <xsd:element name="loads" type="loadlist" />
      <xsd:element name="flows" type="flowlist" />
      <xsd:element name="operationplans" type="operationplanlist" />
      <xsd:element name="location" type="location" />
      <xsd:element name="available" type="calendar" />
    </xsd:choice>
    <xsd:attributeGroup ref="common_attributes" />
    <xsd:attribute name="duration" type="xsd:duration" />
    <xsd:attribute name="detectproblems" type="xsd:boolean" />
    <xsd:attribute name="posttime" type="xsd:duration" />
    <xsd:attribute name="fence" type="xsd:duration" />
    <xsd:attribute name="size_minimum" type="positiveDouble" />
    <xsd:attribute name="size_multiple" type="positiveDouble" />
    <xsd:attribute name="size_maximum" type="positiveDouble" />
    <xsd:attribute name="cost" type="positiveDouble" />
    <xsd:attribute name="priority" type="xsd:integer" />
    <xsd:attribute name="effective_start" type="xsd:dateTime" />
    <xsd:attribute name="effective_end" type="xsd:dateTime" />
  </xsd:complexType>

  <xsd:complexType name="operationlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="operation" type="operation" />
    </xsd:choice>
  </xsd:complexType>

  <xsd:complexType name="operation_fixed_time">
    <xsd:complexContent>
      <xsd:extension base="operation">
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="operation_time_per">
    <xsd:complexContent>
      <xsd:extension base="operation">
        <xsd:choice minOccurs="0" maxOccurs="unbounded">
          <xsd:element name="duration_per" type="xsd:duration" />
        </xsd:choice>
        <xsd:attribute name="duration_per" type="xsd:duration" />
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="operation_routing">
    <xsd:complexContent>
      <xsd:extension base="operation">
        <xsd:choice minOccurs="0" maxOccurs="unbounded">
          <xsd:element name="suboperations">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="suboperation" type="suboperation" minOccurs="0" maxOccurs="unbounded" />
              </xsd:sequence>
            </xsd:complexType>
          </xsd:element>
        </xsd:choice>
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="operation_alternate">
    <xsd:complexContent>
      <xsd:extension base="operation">
        <xsd:choice minOccurs="0" maxOccurs="unbounded">
          <xsd:element name="search" type="search" />
          <xsd:element name="suboperations">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="suboperation" type="suboperation" minOccurs="0" maxOccurs="unbounded" />
              </xsd:sequence>
            </xsd:complexType>
          </xsd:element>
        </xsd:choice>
        <xsd:attribute name="search" type="search" />
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="operation_split">
    <xsd:complexContent>
      <xsd:extension base="operation">
        <xsd:choice minOccurs="0" maxOccurs="unbounded">
          <xsd:element name="suboperations">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="suboperation" type="suboperation" minOccurs="0" maxOccurs="unbounded" />
              </xsd:sequence>
            </xsd:complexType>
          </xsd:element>
        </xsd:choice>
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="suboperation">
    <xsd:annotation>
      <xsd:documentation>
        An operation nested inside another one. This is used for operations
        of type routing, alternate and split.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:sequence minOccurs="1">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">     
      <xsd:element name="priority" type="xsd:integer" />
      <xsd:element name="effective_start" type="xsd:dateTime" />
      <xsd:element name="effective_end" type="xsd:dateTime" />
    </xsd:choice>
    <xsd:element name="operation" type="operation" />
    <xsd:choice minOccurs="0" maxOccurs="unbounded">     
      <xsd:element name="priority" type="xsd:integer" />
      <xsd:element name="effective_start" type="xsd:dateTime" />
      <xsd:element name="effective_end" type="xsd:dateTime" />
    </xsd:choice>
    </xsd:sequence>
  </xsd:complexType>

  <!-- ITEM -->
  <xsd:complexType name="item">
    <xsd:annotation>
      <xsd:documentation>
        An item defines the products being planned, sold, stored and/or
        manufactured. Buffers and demands have a reference to an item.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:group ref="common_fields" />
      <xsd:element name="owner" type="item" />
      <xsd:element name="members">
        <xsd:complexType>
          <xsd:sequence minOccurs="0" maxOccurs="unbounded">
            <xsd:element name="item" type="item" />
          </xsd:sequence>
        </xsd:complexType>
      </xsd:element>
      <xsd:element name="cost" type="positiveDouble" />
      <xsd:element name="itemsuppliers" type="itemsupplierlist" />
      <xsd:element name="itemdistributions" type="itemdistributionlist" />
    </xsd:choice>
    <xsd:attributeGroup ref="common_attributes" />
    <xsd:attribute name="cost" type="positiveDouble" />
  </xsd:complexType>

  <xsd:complexType name="itemlist">
    <xsd:sequence minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="item" type="item" />
    </xsd:sequence>
  </xsd:complexType>

  <!-- ITEM SUPPLIER -->
  <xsd:complexType name="itemsupplier">
    <xsd:annotation>
      <xsd:documentation>
        A itemsupplier specifies an item than can be procured from a supplier.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="supplier" type="supplier" />
      <xsd:element name="item" type="item" />
      <xsd:element name="location" type="location" />
      <xsd:element name="leadtime" type="xsd:duration" />
      <xsd:element name="size_multiple" type="positiveDouble" />
      <xsd:element name="size_minimum" type="positiveDouble" />
      <xsd:element name="cost" type="positiveDouble" />
      <xsd:element name="priority" type="xsd:integer" />
      <xsd:element name="effective_start" type="xsd:dateTime" />
      <xsd:element name="effective_end" type="xsd:dateTime" />
      <xsd:element name="resource" type="resource" />
      <xsd:element name="resource_qty" type="positiveDouble" />
      <xsd:element name="fence" type="xsd:duration" />
      <xsd:element name="booleanproperty" type="booleanproperty" />
      <xsd:element name="stringproperty" type="stringproperty" />
      <xsd:element name="doubleproperty" type="doubleproperty" />
      <xsd:element name="dateproperty" type="dateproperty" />
    </xsd:choice>
    <xsd:attribute name="leadtime" type="xsd:duration" />
    <xsd:attribute name="size_multiple" type="positiveDouble" />
    <xsd:attribute name="size_minimum" type="positiveDouble" />
    <xsd:attribute name="cost" type="positiveDouble" />
    <xsd:attribute name="priority" type="xsd:integer" />
    <xsd:attribute name="effective_start" type="xsd:dateTime" />
    <xsd:attribute name="effective_end" type="xsd:dateTime" />
    <xsd:attribute name="resource_qty" type="positiveDouble" />
    <xsd:attribute name="fence" type="xsd:duration" />
    <xsd:attribute name="action" type="action" />
  </xsd:complexType>

  <xsd:complexType name="itemsupplierlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="itemsupplier" type="itemsupplier" />
    </xsd:choice>
  </xsd:complexType>

  <!-- ITEM DISTRIBUTION -->
  <xsd:complexType name="itemdistribution">
    <xsd:annotation>
      <xsd:documentation>
        A itemsupplier specifies an item than can be shipped from an origin
        location to a destination location.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="item" type="item" />
      <xsd:element name="origin" type="location" />
      <xsd:element name="destination" type="location" />
      <xsd:element name="leadtime" type="xsd:duration" />
      <xsd:element name="size_multiple" type="positiveDouble" />
      <xsd:element name="size_minimum" type="positiveDouble" />
      <xsd:element name="cost" type="positiveDouble" />
      <xsd:element name="priority" type="xsd:integer" />
      <xsd:element name="effective_start" type="xsd:dateTime" />
      <xsd:element name="effective_end" type="xsd:dateTime" />
      <xsd:element name="resource" type="resource" />
      <xsd:element name="resource_qty" type="positiveDouble" />
      <xsd:element name="fence" type="xsd:duration" />
      <xsd:element name="booleanproperty" type="booleanproperty" />
      <xsd:element name="stringproperty" type="stringproperty" />
      <xsd:element name="doubleproperty" type="doubleproperty" />
      <xsd:element name="dateproperty" type="dateproperty" />
    </xsd:choice>
    <xsd:attribute name="leadtime" type="xsd:duration" />
    <xsd:attribute name="size_multiple" type="positiveDouble" />
    <xsd:attribute name="size_minimum" type="positiveDouble" />
    <xsd:attribute name="cost" type="positiveDouble" />
    <xsd:attribute name="priority" type="xsd:integer" />
    <xsd:attribute name="effective_start" type="xsd:dateTime" />
    <xsd:attribute name="effective_end" type="xsd:dateTime" />
    <xsd:attribute name="resource_qty" type="positiveDouble" />
    <xsd:attribute name="fence" type="xsd:duration" />
    <xsd:attribute name="action" type="action" />
  </xsd:complexType>

  <xsd:complexType name="itemdistributionlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="itemdistribution" type="itemdistribution" />
    </xsd:choice>
  </xsd:complexType>

  <!-- SETUP MATRIX -->
  <xsd:complexType name="setupmatrix">
    <xsd:annotation>
      <xsd:documentation>
        A setup matrix defines the conversion between different resource
        setups.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="source" type="xsd:normalizedString" />
      <xsd:element name="booleanproperty" type="booleanproperty" />
      <xsd:element name="stringproperty" type="stringproperty" />
      <xsd:element name="doubleproperty" type="doubleproperty" />
      <xsd:element name="dateproperty" type="dateproperty" />
      <xsd:element name="rules">
        <xsd:complexType>
          <xsd:sequence minOccurs="0" maxOccurs="unbounded">
            <xsd:element name="rule">
              <xsd:complexType>
                <xsd:all>
                  <xsd:element name="fromsetup" type="xsd:normalizedString" minOccurs="0" />
                  <xsd:element name="tosetup" type="xsd:normalizedString" minOccurs="0" />
                  <xsd:element name="duration" type="xsd:duration" minOccurs="0" />
                  <xsd:element name="cost" type="xsd:double" minOccurs="0" />
                </xsd:all>
                <xsd:attribute name="priority" type="xsd:integer" use="required" />
                <xsd:attribute name="fromsetup" type="xsd:normalizedString" />
                <xsd:attribute name="tosetup" type="xsd:normalizedString" />
                <xsd:attribute name="duration" type="xsd:duration" />
                <xsd:attribute name="cost" type="xsd:double" />
              </xsd:complexType>
            </xsd:element>
          </xsd:sequence>
        </xsd:complexType>
      </xsd:element>
    </xsd:choice>
    <xsd:attribute name="name" type="non-empty-string" />
    <xsd:attribute name="source" type="xsd:normalizedString" />
  </xsd:complexType>

  <xsd:complexType name="setupmatrixlist">
    <xsd:sequence minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="setupmatrix" type="setupmatrix" />
    </xsd:sequence>
  </xsd:complexType>

  <!-- SKILL -->
  <xsd:complexType name="skill">
    <xsd:annotation>
      <xsd:documentation>
        A skill that can be assigned to a resource.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="resourceskills" type="resourceskilllist" />
      <xsd:element name="source" type="xsd:normalizedString" />
      <xsd:element name="booleanproperty" type="booleanproperty" />
      <xsd:element name="stringproperty" type="stringproperty" />
      <xsd:element name="doubleproperty" type="doubleproperty" />
      <xsd:element name="dateproperty" type="dateproperty" />
    </xsd:choice>
    <xsd:attribute name="name" type="non-empty-string" />
    <xsd:attribute name="source" type="xsd:normalizedString" />
  </xsd:complexType>

  <xsd:complexType name="skilllist">
    <xsd:sequence minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="skill" type="skill" />
    </xsd:sequence>
  </xsd:complexType>

  <!-- RESOURCE -->
  <xsd:complexType name="resource">
    <xsd:annotation>
      <xsd:documentation>
        A resource represents a workcentre, a physical or logical
        representation of capacity.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:group ref="common_fields" />
      <xsd:element name="location" type="location" />
      <xsd:element name="maximum" type="positiveDouble" />
      <xsd:element name="maximum_calendar" type="calendar" />
      <xsd:element name="available" type="calendar" />
      <xsd:element name="maxearly" type="xsd:duration" />
      <xsd:element name="cost" type="positiveDouble" />
      <xsd:element name="efficiency" type="positiveDouble" />
      <xsd:element name="efficiency_calendar" type="calendar" />
      <xsd:element name="owner" type="resource" />
      <xsd:element name="members">
        <xsd:complexType>
          <xsd:sequence minOccurs="0" maxOccurs="unbounded">
            <xsd:element name="resource" type="resource" />
          </xsd:sequence>
        </xsd:complexType>
      </xsd:element>
      <xsd:element name="detectproblems" type="xsd:boolean" />
      <xsd:element name="loads" type="loadlist" />
      <xsd:element name="loadplans" type="loadplanlist"/>
      <xsd:element name="setup" type="non-empty-string" minOccurs="0" />
      <xsd:element name="setupmatrix" type="setupmatrix" minOccurs="0" />
      <xsd:element name="resourceskills" type="resourceskilllist" minOccurs="0" />
    </xsd:choice>
    <xsd:attributeGroup ref="common_attributes" />
    <xsd:attribute name="maxearly" type="xsd:duration" />
    <xsd:attribute name="detectproblems" type="xsd:boolean" />
    <xsd:attribute name="maximum" type="positiveDouble" />
    <xsd:attribute name="cost" type="positiveDouble" />
    <xsd:attribute name="efficiency" type="positiveDouble" />
    <xsd:attribute name="setup" type="non-empty-string" />
    <xsd:attribute name="setupmatrix" type="non-empty-string" />
  </xsd:complexType>

  <xsd:complexType name="resourcelist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="resource" type="resource" />
    </xsd:choice>
  </xsd:complexType>

  <xsd:complexType name="resource_infinite">
    <xsd:complexContent>
      <xsd:extension base="resource" />
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="resource_buckets">
    <xsd:complexContent>
      <xsd:extension base="resource" />
    </xsd:complexContent>
  </xsd:complexType>

  <!-- RESOURCESKILL -->
  <xsd:complexType name="resourceskill">
    <xsd:annotation>
      <xsd:documentation>
        A resourceskill specifies a skill which a certain resource has.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="skill" type="skill" />
      <xsd:element name="resource" type="resource" />
      <xsd:element name="priority" type="xsd:integer" />
      <xsd:element name="effective_start" type="xsd:dateTime" />
      <xsd:element name="effective_end" type="xsd:dateTime" />
      <xsd:element name="booleanproperty" type="booleanproperty" />
      <xsd:element name="stringproperty" type="stringproperty" />
      <xsd:element name="doubleproperty" type="doubleproperty" />
      <xsd:element name="dateproperty" type="dateproperty" />
    </xsd:choice>
    <xsd:attribute name="priority" type="xsd:integer" />
    <xsd:attribute name="effective_start" type="xsd:dateTime" />
    <xsd:attribute name="effective_end" type="xsd:dateTime" />
    <xsd:attribute name="action" type="action" />
  </xsd:complexType>

  <xsd:complexType name="resourceskilllist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="resourceskill" type="resourceskill" />
    </xsd:choice>
  </xsd:complexType>

  <!-- BUFFER -->
  <xsd:complexType name="buffer">
    <xsd:annotation>
      <xsd:documentation>
        A buffer represents a combination of a item and location. It is the
        entity for keeping modeling inventory. A synonym is SKU or
        stock-keeping-unit.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:group ref="common_fields" />
      <xsd:element name="owner" type="buffer" />
      <xsd:element name="members">
        <xsd:complexType>
          <xsd:sequence minOccurs="0" maxOccurs="unbounded">
            <xsd:element name="buffer" type="buffer" />
          </xsd:sequence>
        </xsd:complexType>
      </xsd:element>
      <xsd:element name="location" type="location" />
      <xsd:element name="item" type="item" />
      <xsd:element name="onhand" type="xsd:double" />
      <xsd:element name="minimum" type="xsd:double" />
      <xsd:element name="maximum" type="xsd:double" />
      <xsd:element name="minimum_calendar" type="calendar" />
      <xsd:element name="maximum_calendar" type="calendar" />
      <xsd:element name="mininterval" type="xsd:duration" />
      <xsd:element name="maxinterval" type="xsd:duration" />
      <xsd:element name="producing" type="operation" />
      <xsd:element name="detectproblems" type="xsd:boolean" />
      <xsd:element name="flows" type="flowlist" />
      <xsd:element name="flowplans" type="flowplanlist" />
      <xsd:element name="tool" type="xsd:boolean" />
    </xsd:choice>
    <xsd:attributeGroup ref="common_attributes" />
    <xsd:attribute name="onhand" type="xsd:double" />
    <xsd:attribute name="minimum" type="xsd:double" />
    <xsd:attribute name="maximum" type="xsd:double" />
    <xsd:attribute name="mininterval" type="xsd:duration" />
    <xsd:attribute name="maxinterval" type="xsd:duration" />
    <xsd:attribute name="detectproblems" type="xsd:boolean" />
    <xsd:attribute name="tool" type="xsd:boolean" />
  </xsd:complexType>

  <xsd:complexType name="bufferlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="buffer" type="buffer" />
    </xsd:choice>
  </xsd:complexType>

  <xsd:complexType name="buffer_infinite">
    <xsd:complexContent>
      <xsd:extension base="buffer" />
    </xsd:complexContent>
  </xsd:complexType>

  <!-- FLOW -->
  <xsd:complexType name="flow">
    <xsd:annotation>
      <xsd:documentation>
        A flow represent the production or consumption of material from a
        buffer. A flow is attached to an operation.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="operation" type="operation" />
      <xsd:element name="buffer" type="buffer" />
      <xsd:element name="item" type="item" />
      <xsd:element name="quantity" type="xsd:double" />      
      <xsd:element name="quantity_fixed" type="xsd:double" />      
      <xsd:element name="priority" type="xsd:integer" />
      <xsd:element name="effective_start" type="xsd:dateTime" />
      <xsd:element name="effective_end" type="xsd:dateTime" />
      <xsd:element name="name" type="non-empty-string" />
      <xsd:element name="search" type="search" />
      <xsd:element name="booleanproperty" type="booleanproperty" />
      <xsd:element name="stringproperty" type="stringproperty" />
      <xsd:element name="doubleproperty" type="doubleproperty" />
      <xsd:element name="dateproperty" type="dateproperty" />
      <xsd:element name="source" type="xsd:normalizedString" />  
    </xsd:choice>
    <xsd:attribute name="quantity" type="xsd:double" />
    <xsd:attribute name="quantity_fixed" type="xsd:double" />
    <xsd:attribute name="priority" type="xsd:integer" />
    <xsd:attribute name="effective_start" type="xsd:dateTime" />
    <xsd:attribute name="effective_end" type="xsd:dateTime" />
    <xsd:attribute name="name" type="non-empty-string" />
    <xsd:attribute name="search" type="search" />
    <xsd:attribute name="action" type="action" />
    <xsd:attribute name="source" type="xsd:normalizedString" />
  </xsd:complexType>

  <xsd:complexType name="flowlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="flow" type="flow" />
    </xsd:choice>
  </xsd:complexType>

  <xsd:complexType name="flow_end">
    <xsd:complexContent>
      <xsd:extension base="flow" />
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="flow_start">
    <xsd:complexContent>
      <xsd:extension base="flow" />
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="flow_transfer_batch">
    <xsd:complexContent>
      <xsd:extension base="flow">
        <xsd:choice minOccurs="0" maxOccurs="unbounded">
          <xsd:element name="transferbatch" type="xsd:double" />
        </xsd:choice>
        <xsd:attribute name="transferbatch" type="xsd:double" /> 
      </xsd:extension>     
    </xsd:complexContent>
  </xsd:complexType>

  <!-- LOAD -->
  <xsd:complexType name="load">
    <xsd:annotation>
      <xsd:documentation>
        A load links a resource to a certain operation.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="operation" type="operation" />
      <xsd:element name="resource" type="resource" />
      <xsd:element name="quantity" type="xsd:double" />
      <xsd:element name="priority" type="xsd:integer" />
      <xsd:element name="effective_start" type="xsd:dateTime" />
      <xsd:element name="effective_end" type="xsd:dateTime" />
      <xsd:element name="name" type="non-empty-string" />
      <xsd:element name="search" type="search" />
      <xsd:element name="setup" type="non-empty-string" />
      <xsd:element name="skill" type="skill" />
      <xsd:element name="booleanproperty" type="booleanproperty" />
      <xsd:element name="stringproperty" type="stringproperty" />
      <xsd:element name="doubleproperty" type="doubleproperty" />
      <xsd:element name="dateproperty" type="dateproperty" />
      <xsd:element name="source" type="xsd:normalizedString" />
    </xsd:choice>
    <xsd:attribute name="quantity" type="xsd:double" />
    <xsd:attribute name="priority" type="xsd:integer" />
    <xsd:attribute name="effective_start" type="xsd:dateTime" />
    <xsd:attribute name="effective_end" type="xsd:dateTime" />
    <xsd:attribute name="name" type="non-empty-string" />
    <xsd:attribute name="search" type="search" />
    <xsd:attribute name="setup" type="non-empty-string" />
    <xsd:attribute name="action" type="action" />
    <xsd:attribute name="source" type="xsd:normalizedString" />
  </xsd:complexType>

  <xsd:complexType name="load_bucketized_percentage">
    <xsd:complexContent>
      <xsd:extension base="load">
        <xsd:choice minOccurs="0" maxOccurs="unbounded">
          <xsd:element name="offset" type="xsd:double" />
        </xsd:choice>
        <xsd:attribute name="offset" type="xsd:double" />      
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="load_bucketized_from_start">
    <xsd:complexContent>
      <xsd:extension base="load">
        <xsd:choice minOccurs="0" maxOccurs="unbounded">
          <xsd:element name="offset" type="xsd:duration" />
        </xsd:choice>
        <xsd:attribute name="offset" type="xsd:duration" />      
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="load_bucketized_from_end">
    <xsd:complexContent>
      <xsd:extension base="load">
        <xsd:choice minOccurs="0" maxOccurs="unbounded">
          <xsd:element name="offset" type="xsd:duration" />
        </xsd:choice>
        <xsd:attribute name="offset" type="xsd:duration" />      
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="loadlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="load" type="load" />
    </xsd:choice>
  </xsd:complexType>

  <xsd:complexType name="loadplan">
    <xsd:sequence>
      <xsd:element name="date" type="xsd:dateTime" />
      <xsd:element name="quantity" type="xsd:double" />
      <xsd:element name="onhand" type="xsd:double" />
      <xsd:element name="minimum" type="xsd:double" />
      <xsd:element name="maximum" type="xsd:double" />
      <xsd:element name="operationplan" type="operationplan" />
    </xsd:sequence>
  </xsd:complexType>

  <xsd:complexType name="loadplanlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="loadplan" type="loadplan" />
    </xsd:choice>
  </xsd:complexType>

  <!-- DEMAND -->
  <xsd:complexType name="demand">
    <xsd:annotation>
      <xsd:documentation>
        A demand represents a independent demand to be planned. It can
        represent a customer order or a forecast.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:group ref="common_fields" />
      <xsd:element name="quantity" type="positiveDouble" />
      <xsd:element name="planned_quantity" type="positiveDouble" />
      <xsd:element name="item" type="item" />
      <xsd:element name="location" type="location" />
      <xsd:element name="due" type="xsd:dateTime" />
      <xsd:element name="priority" type="xsd:integer" />
      <xsd:element name="operation" type="operation" />
      <xsd:element name="customer" type="customer" />
      <xsd:element name="minshipment" type="positiveDouble" />
      <xsd:element name="maxlateness" type="xsd:duration" />
      <xsd:element name="detectproblems" type="xsd:boolean" />
      <xsd:element name="owner" type="demand" />
      <xsd:element name="members">
        <xsd:complexType>
          <xsd:sequence minOccurs="0" maxOccurs="unbounded">
            <xsd:element name="demand" type="demand" />
          </xsd:sequence>
        </xsd:complexType>
      </xsd:element>
      <xsd:element name="operationplans" type="operationplanlist" />
      <xsd:element name="constraints" type="problemlist" />
    </xsd:choice>
    <xsd:attributeGroup ref="common_attributes" />
    <xsd:attribute name="quantity" type="positiveDouble" />
    <xsd:attribute name="planned_quantity" type="positiveDouble" />
    <xsd:attribute name="due" type="xsd:dateTime" />
    <xsd:attribute name="priority" type="xsd:integer" />
    <xsd:attribute name="detectproblems" type="xsd:boolean" />
    <xsd:attribute name="maxlateness" type="xsd:duration" />
    <xsd:attribute name="minshipment" type="positiveDouble" />
  </xsd:complexType>

  <xsd:complexType name="demandlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="demand" type="demand" />
    </xsd:choice>
  </xsd:complexType>

  <!-- CALENDAR -->
  <xsd:simpleType name="bucketdays">
    <xsd:restriction base="xsd:integer">
      <xsd:minInclusive value="0"/>
      <xsd:maxInclusive value="127"/>
    </xsd:restriction>
  </xsd:simpleType>

  <xsd:complexType name="calendar">
    <xsd:annotation>
      <xsd:documentation>
        A calendar is used to represent time dependent parameters.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="name" type="non-empty-string" />
      <xsd:element name="default" type="xsd:double" />
      <xsd:element name="source" type="xsd:normalizedString" />
      <xsd:element name="booleanproperty" type="booleanproperty" />
      <xsd:element name="stringproperty" type="stringproperty" />
      <xsd:element name="doubleproperty" type="doubleproperty" />
      <xsd:element name="dateproperty" type="dateproperty" />
      <xsd:element name="buckets">
        <xsd:complexType>
          <xsd:sequence>
            <xsd:element name="bucket" minOccurs="0" maxOccurs="unbounded">
              <xsd:complexType>
                <xsd:all>
                  <xsd:element name="start" type="xsd:dateTime" minOccurs="0" />
                  <xsd:element name="end" type="xsd:dateTime" minOccurs="0" />
                  <xsd:element name="value" type="xsd:double" minOccurs="0" />
                  <xsd:element name="priority" type="xsd:integer" minOccurs="0" />
                  <xsd:element name="days" type="bucketdays" minOccurs="0" />
                  <xsd:element name="starttime" type="xsd:duration" minOccurs="0" />
                  <xsd:element name="endtime" type="xsd:duration" minOccurs="0" />
                  <xsd:element name="booleanproperty" type="booleanproperty" minOccurs="0" />
                  <xsd:element name="stringproperty" type="stringproperty" minOccurs="0" />
                  <xsd:element name="doubleproperty" type="doubleproperty" minOccurs="0" />
                  <xsd:element name="dateproperty" type="dateproperty" minOccurs="0" />
                </xsd:all>
                <xsd:attribute name="start" type="xsd:dateTime" />
                <xsd:attribute name="end" type="xsd:dateTime" />
                <xsd:attribute name="priority" type="xsd:integer" />
                <xsd:attribute name="value" type="xsd:double" />
                <xsd:attribute name="days" type="bucketdays" />
                <xsd:attribute name="starttime" type="xsd:duration" />
                <xsd:attribute name="endtime" type="xsd:duration" />
                <xsd:attribute name="action" type="action" />
              </xsd:complexType>
            </xsd:element>
          </xsd:sequence>
        </xsd:complexType>
      </xsd:element>
    </xsd:choice>
    <xsd:attribute name="default" type="xsd:double" />
    <xsd:attribute name="name" type="non-empty-string" />
    <xsd:attribute name="source" type="xsd:normalizedString" />
    <xsd:attribute name="action" type="action" />
  </xsd:complexType>

  <xsd:complexType name="calendarlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="calendar" type="calendar" />
    </xsd:choice>
  </xsd:complexType>

  <!-- FLOWPLAN -->
  <xsd:complexType name="flowplan">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="operationplan" type="operationplan" />
      <xsd:element name="buffer" type="buffer" />
      <xsd:element name="item" type="item" />
      <xsd:element name="quantity" type="xsd:double" />
      <xsd:element name="date" type="xsd:dateTime" />
      <xsd:element name="onhand" type="xsd:double" />
      <xsd:element name="minimum" type="xsd:double" />
      <xsd:element name="maximum" type="xsd:double" />
      <xsd:element name="status" type="xsd:string" />
    </xsd:choice>
    <xsd:attribute name="quantity" type="xsd:double" />
    <xsd:attribute name="onhand" type="xsd:double" />
    <xsd:attribute name="minimum" type="xsd:double" />
    <xsd:attribute name="maximum" type="xsd:double" />
    <xsd:attribute name="date" type="xsd:dateTime" />
    <xsd:attribute name="status" type="xsd:string" />
  </xsd:complexType>

  <xsd:complexType name="flowplanlist">
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="flowplan" type="flowplan" />
    </xsd:choice>
  </xsd:complexType>

  <!-- OPERATIONPLAN -->
  <xsd:simpleType name="ordertype">
    <xsd:restriction base="xsd:string">
      <xsd:enumeration value="MO" />
      <xsd:enumeration value="PO" />
      <xsd:enumeration value="DO" />
      <xsd:enumeration value="DLVR" />
      <xsd:enumeration value="STCK" />
    </xsd:restriction>
  </xsd:simpleType>
  <xsd:complexType name="operationplan">
    <xsd:annotation>
      <xsd:documentation>
        This entity represent the key for representing the plan. It models an
        operation planned at a certain quantity and time.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:choice minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="ordertype" type="ordertype" />
      <xsd:element name="id" type="xsd:unsignedLong" />
      <xsd:element name="reference" type="xsd:normalizedString" />
      <xsd:element name="operation" type="operation" />
      <xsd:element name="demand" type="demand" />
      <xsd:element name="start" type="xsd:dateTime" />
      <xsd:element name="end" type="xsd:dateTime" />
      <xsd:element name="quantity" type="positiveDouble" />
      <xsd:element name="status" type="xsd:normalizedString" />
      <xsd:element name="owner" type="operationplan" />
      <xsd:element name="feasible" type="xsd:boolean" />
      <xsd:element name="criticality" type="xsd:double" />
      <xsd:element name="consume_material" type="xsd:boolean" />
      <xsd:element name="consume_capacity" type="xsd:boolean" />
      <xsd:element name="produce_material" type="xsd:boolean" />
      <xsd:element name="source" type="xsd:normalizedString" />
      <xsd:element name="item" type="item" />
      <xsd:element name="location" type="location" />
      <xsd:element name="origin" type="location" />
      <xsd:element name="supplier" type="supplier" />
      <xsd:element name="booleanproperty" type="booleanproperty" />
      <xsd:element name="stringproperty" type="stringproperty" />
      <xsd:element name="doubleproperty" type="doubleproperty" />
      <xsd:element name="dateproperty" type="dateproperty" />
      <xsd:element name="flowplans" type="flowplanlist" />
    </xsd:choice>
    <xsd:attribute name="ordertype" type="ordertype" />
    <xsd:attribute name="id" type="xsd:unsignedLong" />
    <xsd:attribute name="reference" type="xsd:normalizedString" />
    <xsd:attribute name="start" type="xsd:dateTime" />
    <xsd:attribute name="end" type="xsd:dateTime" />
    <xsd:attribute name="quantity" type="positiveDouble" />
    <xsd:attribute name="feasible" type="xsd:boolean" />
    <xsd:attribute name="criticality" type="xsd:double" />
    <xsd:attribute name="status" type="xsd:normalizedString" />
    <xsd:attribute name="consume_material" type="xsd:boolean" />
    <xsd:attribute name="consume_capacity" type="xsd:boolean" />
    <xsd:attribute name="produce_material" type="xsd:boolean" />
    <xsd:attribute name="source" type="xsd:normalizedString" />
    <xsd:attribute name="action" type="action" />
  </xsd:complexType>

  <xsd:complexType name="operationplanlist">
    <xsd:sequence minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="operationplan" type="operationplan" />
    </xsd:sequence>
  </xsd:complexType>

  <!-- PROBLEM -->
  <xsd:complexType name="problem">
    <xsd:annotation>
      <xsd:documentation>
        This entity is used to represent inconsistencies, alerts and warnings
        in the model. Problems are maintained internally by the system. They
        are thus export-only, meaning that we can't directly import or build
        problems.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:sequence>
      <xsd:element name="name" type="xsd:normalizedString" minOccurs="0" />
      <xsd:element name="description" type="xsd:normalizedString" minOccurs="0" />
      <xsd:element name="start" type="xsd:dateTime" minOccurs="0" />
      <xsd:element name="end" type="xsd:dateTime" minOccurs="0" />
      <xsd:element name="weight" type="xsd:double" minOccurs="0" />
    </xsd:sequence>
  </xsd:complexType>

  <xsd:complexType name="problemlist">
    <xsd:sequence minOccurs="0" maxOccurs="unbounded">
      <xsd:element name="problem" type="problem" />
    </xsd:sequence>
  </xsd:complexType>

  <!-- Define the root element and its contents. -->
  <xsd:element name="plan">
    <xsd:annotation>
      <xsd:documentation>
        This is the root tag in the data schema.
      </xsd:documentation>
    </xsd:annotation>
    <xsd:complexType>
      <xsd:choice minOccurs="0" maxOccurs="unbounded">
        <!-- FIELDS -->
        <xsd:element name="name" type="xsd:normalizedString" />
        <xsd:element name="description" type="xsd:string" />
        <xsd:element name="source" type="xsd:normalizedString" />
        <xsd:element name="current" type="xsd:dateTime" />
        <xsd:element name="logfile" type="xsd:normalizedString" />
        <xsd:element name="plannable" type="xsd:boolean" />
        <xsd:element name="detectproblems" type="xsd:boolean" />
        <xsd:element name="calendar" type="calendar" />
        <!-- OBJECT LISTS -->
        <xsd:element name="locations" type="locationlist" />
        <xsd:element name="customers" type="customerlist" />
        <xsd:element name="suppliers" type="supplierlist" />
        <xsd:element name="calendars" type="calendarlist" />
        <xsd:element name="operations" type="operationlist" />
        <xsd:element name="items" type="itemlist" />
        <xsd:element name="buffers" type="bufferlist" />
        <xsd:element name="flows" type="flowlist" />
        <xsd:element name="loads" type="loadlist" />
        <xsd:element name="demands" type="demandlist" />
        <xsd:element name="setupmatrices" type="setupmatrixlist" />
        <xsd:element name="resources" type="resourcelist" />
        <xsd:element name="skills" type="skilllist" />
        <xsd:element name="operationplans" type="operationplanlist" />
        <xsd:element name="problems" type="problemlist" />
        <xsd:element name="resourceskills" type="resourceskilllist" />
        <xsd:element name="itemsuppliers" type="itemsupplierlist" />
        <xsd:element name="itemdistributions" type="itemdistributionlist" />
      </xsd:choice>
      <xsd:attribute name="name" type="xsd:normalizedString" />
      <xsd:attribute name="source" type="xsd:normalizedString" />
      <xsd:attribute name="current" type="xsd:dateTime" />
      <xsd:attribute name="logfile" type="xsd:normalizedString" />
      <xsd:attribute name="plannable" type="xsd:boolean" />
      <xsd:attribute name="detectproblems" type="xsd:boolean" />
    </xsd:complexType>
  </xsd:element>

  <!--
    Frepple also recognizes the following XML processing instructions.
    Note that these instructions are never validated or checked by the parser.
    They are only processed inside frepple.

      <?python xxxx ?>
      Include Python code in your model.
  -->

</xsd:schema>
