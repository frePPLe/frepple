<?xml version="1.0" encoding="UTF-8"?>
<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <current>2026-01-01T00:00:00</current>
    <moveApprovedEarly>0</moveApprovedEarly>

    <!-- case 1: Move an approved PO early, and it's feasible -->
    <suppliers>
        <supplier name="1. Supplier">
            <itemsuppliers>
                <itemsupplier>
                    <item name="1. item"/>
                    <leadtime>P7D</leadtime>
                    <priority>2</priority>
                </itemsupplier>
            </itemsuppliers>
        </supplier>
    </suppliers>
    <demands>
        <demand name="1. sales order">
            <quantity>20</quantity>
            <minshipment>20</minshipment>
            <due>2026-02-01T00:00:00</due>
            <priority>1</priority>
            <item name="1. item"/>
            <location name="factory"/>
            <status>open</status>
        </demand>
    </demands>
    <operationplans>
        <operationplan ordertype="PO" end="2026-08-01T00:00:00" reference="PO #1" quantity="100" status="approved">
            <item name="1. item"/>
            <location name="factory"/>
            <supplier name="1. Supplier"/>
        </operationplan>
    </operationplans>

    <!-- case 2: Move an approved PO early, and it's not feasible -->
    <suppliers>
        <supplier name="2. Supplier">
            <itemsuppliers>
                <itemsupplier>
                    <item name="2. item"/>
                    <leadtime>P7D</leadtime>
                    <priority>2</priority>
                </itemsupplier>
            </itemsuppliers>
        </supplier>
    </suppliers>
    <demands>
        <demand name="2. sales order">
            <quantity>20</quantity>
            <minshipment>20</minshipment>
            <due>2026-01-01T00:00:00</due>
            <priority>1</priority>
            <item name="2. item"/>
            <location name="factory"/>
            <status>open</status>
        </demand>
    </demands>
    <operationplans>
        <operationplan ordertype="PO" end="2026-08-01T00:00:00" reference="PO #2" quantity="100" status="approved">
            <item name="2. item"/>
            <location name="factory"/>
            <supplier name="2. Supplier"/>
        </operationplan>
    </operationplans>

    <!-- case 3: Move approved MOs and POs early, and it's feasible -->
    <suppliers>
        <supplier name="3. Supplier">
            <itemsuppliers>
                <itemsupplier>
                    <item name="3. component"/>
                    <leadtime>P7D</leadtime>
                    <priority>2</priority>
                </itemsupplier>
            </itemsuppliers>
        </supplier>
    </suppliers>
    <demands>
        <demand name="3. sales order">
            <quantity>20</quantity>
            <minshipment>20</minshipment>
            <due>2026-02-01T00:00:00</due>
            <priority>1</priority>
            <item name="3. item"/>
            <location name="factory"/>
            <status>open</status>
        </demand>
    </demands>
    <operations>
        <operation name="3. Make item" xsi:type="operation_fixed_time">
            <item name="3. item"/>
            <location name="factory"/>
            <flows>
                <flow xsi:type="flow_start">
                    <item name="3. item subassembly"/>
                    <quantity>-1</quantity>
                </flow>
            </flows>
            <duration>P3D</duration>
        </operation>
        <operation name="3. Make item subassembly" xsi:type="operation_fixed_time">
            <item name="3. item subassembly"/>
            <location name="factory"/>
            <flows>
                <flow xsi:type="flow_start">
                    <item name="3. component"/>
                    <quantity>-1</quantity>
                </flow>
            </flows>
            <duration>P3D</duration>
        </operation>
    </operations>
    <operationplans>
        <operationplan ordertype="PO" end="2026-07-01T00:00:00" reference="PO #3" quantity="100" status="approved">
            <item name="3. component"/>
            <location name="factory"/>
            <supplier name="3. Supplier"/>
        </operationplan>
        <operationplan ordertype="MO" end="2026-07-20T00:00:00" reference="MO #3" quantity="100" status="approved">
            <operation name="3. Make item subassembly"/>
        </operationplan>
        <operationplan ordertype="MO" end="2026-08-03T00:00:00" reference="MO #3 sub" quantity="100" status="approved">
            <operation name="3. Make item"/>
        </operationplan>
    </operationplans>

    <!-- case 4: Move approved MOs and POs early, and it's not feasible -->
    <suppliers>
        <supplier name="4. Supplier">
            <itemsuppliers>
                <itemsupplier>
                    <item name="4. component"/>
                    <leadtime>P7D</leadtime>
                    <priority>2</priority>
                </itemsupplier>
            </itemsuppliers>
        </supplier>
    </suppliers>
    <demands>
        <demand name="4. sales order">
            <quantity>20</quantity>
            <minshipment>20</minshipment>
            <due>2026-01-01T00:00:00</due>
            <priority>1</priority>
            <item name="4. item"/>
            <location name="factory"/>
            <status>open</status>
        </demand>
    </demands>
    <resources>
        <resource name="4. Resource A">
            <owner name="4. Resource"/>
            <location name="factory"/>
            <maximum_calendar name="4. Capacity A">
                <buckets>
                    <bucket start="2026-03-01T00:00:00">
                        <value>1</value>
                    </bucket>
                </buckets>
            </maximum_calendar>
        </resource>
        <resource name="4. Resource B">
            <owner name="4. Resource"/>
            <location name="factory"/>
            <maximum_calendar name="4. Capacity B">
                <buckets>
                    <bucket start="2026-03-01T00:00:00">
                        <value>1</value>
                    </bucket>
                </buckets>
            </maximum_calendar>
        </resource>
        <resource name="4. Resource C">
            <owner name="4. Resource"/>
            <location name="factory"/>
            <maximum_calendar name="4. Capacity C">
                <buckets>
                    <bucket start="2026-03-01T00:00:00">
                        <value>1</value>
                    </bucket>
                </buckets>
            </maximum_calendar>
        </resource>
        <resource name="4. Resource D">
            <owner name="4. Resource"/>
            <location name="factory"/>
            <maximum_calendar name="4. Capacity D">
                <buckets>
                    <bucket start="2026-03-01T00:00:00">
                        <value>1</value>
                    </bucket>
                </buckets>
            </maximum_calendar>
        </resource>
    </resources>
    <operations>
        <operation name="4. Make item" xsi:type="operation_fixed_time">
            <item name="4. item"/>
            <location name="factory"/>
            <flows>
                <flow xsi:type="flow_start">
                    <item name="4. item subassembly"/>
                    <quantity>-1</quantity>
                </flow>
            </flows>
            <duration>P3D</duration>
        </operation>
        <operation name="4. Make item subassembly" xsi:type="operation_fixed_time">
            <item name="4. item subassembly"/>
            <location name="factory"/>
            <flows>
                <flow xsi:type="flow_start">
                    <item name="4. component"/>
                    <quantity>-1</quantity>
                </flow>
            </flows>
            <loads>
                <load>
                    <resource name="4. Resource">
                    </resource>
                    <search>MINPENALTY</search>
                </load>
            </loads>
            <duration>P3D</duration>
        </operation>
    </operations>
    <operationplans>
        <operationplan ordertype="PO" end="2026-07-01T00:00:00" reference="PO #4" quantity="100" status="approved">
            <item name="4. component"/>
            <location name="factory"/>
            <supplier name="4. Supplier"/>
        </operationplan>
        <operationplan ordertype="MO" end="2026-07-20T00:00:00" reference="MO #4" quantity="100" status="approved">
            <operation name="4. Make item subassembly"/>
        </operationplan>
        <operationplan ordertype="MO" end="2026-08-03T00:00:00" reference="MO #4 sub" quantity="100" status="approved">
            <operation name="4. Make item"/>
        </operationplan>
    </operationplans>

    <!-- case 5: Move approved MOs and POs early, and it's not feasible -->
    <suppliers>
        <supplier name="5. Supplier">
            <itemsuppliers>
                <itemsupplier>
                    <item name="5. component"/>
                    <leadtime>P7D</leadtime>
                    <priority>2</priority>
                </itemsupplier>
            </itemsuppliers>
        </supplier>
    </suppliers>
    <demands>
        <demand name="5. sales order">
            <quantity>20</quantity>
            <minshipment>20</minshipment>
            <due>2026-01-01T00:00:00</due>
            <priority>1</priority>
            <item name="5. item"/>
            <location name="factory"/>
            <status>open</status>
        </demand>
    </demands>
    <operations>
        <operation name="5. Make item" xsi:type="operation_fixed_time">
            <item name="5. item"/>
            <location name="factory"/>
            <flows>
                <flow xsi:type="flow_start">
                    <item name="5. item subassembly"/>
                    <quantity>-1</quantity>
                </flow>
            </flows>
            <duration>P3D</duration>
        </operation>
        <operation name="5. Make item subassembly" xsi:type="operation_fixed_time">
            <item name="5. item subassembly"/>
            <location name="factory"/>
            <flows>
                <flow xsi:type="flow_start">
                    <item name="5. component"/>
                    <quantity>-1</quantity>
                </flow>
            </flows>
            <duration>P3D</duration>
        </operation>
    </operations>
    <operationplans>
        <operationplan ordertype="PO" end="2026-07-01T00:00:00" reference="PO #5" quantity="100" status="approved">
            <item name="5. component"/>
            <location name="factory"/>
            <supplier name="5. Supplier"/>
        </operationplan>
        <operationplan ordertype="MO" end="2026-07-20T00:00:00" reference="MO #5" quantity="100" status="approved">
            <operation name="5. Make item subassembly"/>
        </operationplan>
        <operationplan ordertype="MO" end="2026-08-03T00:00:00" reference="MO #5 sub" quantity="100" status="approved">
            <operation name="5. Make item"/>
        </operationplan>
    </operationplans>

   <!-- case 6: MO's and PO's don't cover the full quantity. -->
    <suppliers>
        <supplier name="6. Supplier">
            <itemsuppliers>
                <itemsupplier>
                    <item name="6. component"/>
                    <leadtime>P7D</leadtime>
                    <priority>2</priority>
                </itemsupplier>
            </itemsuppliers>
        </supplier>
    </suppliers>
    <demands>
        <demand name="6. sales order">
            <quantity>120</quantity>
            <minshipment>120</minshipment>
            <due>2026-01-01T00:00:00</due>
            <priority>1</priority>
            <item name="6. item"/>
            <location name="factory"/>
            <status>open</status>
        </demand>
    </demands>
    <operations>
        <operation name="6. Make item" xsi:type="operation_fixed_time">
            <item name="6. item"/>
            <location name="factory"/>
            <flows>
                <flow xsi:type="flow_start">
                    <item name="6. item subassembly"/>
                    <quantity>-1</quantity>
                </flow>
            </flows>
            <duration>P3D</duration>
        </operation>
        <operation name="6. Make item subassembly" xsi:type="operation_fixed_time">
            <item name="6. item subassembly"/>
            <location name="factory"/>
            <flows>
                <flow xsi:type="flow_start">
                    <item name="6. component"/>
                    <quantity>-1</quantity>
                </flow>
            </flows>
            <loads>
                <load>
                    <resource name="6. Resource">
                        <maximum_calendar name="Capacity">
                            <buckets>
                                <bucket start="2026-03-01T00:00:00">
                                    <value>1</value>
                                </bucket>
                            </buckets>
                        </maximum_calendar>
                    </resource>
                </load>
            </loads>
            <duration>P3D</duration>
        </operation>
    </operations>
    <operationplans>
        <operationplan ordertype="PO" end="2026-07-01T00:00:00" reference="PO #6" quantity="30" status="approved">
            <item name="6. component"/>
            <location name="factory"/>
            <supplier name="6. Supplier"/>
        </operationplan>
        <operationplan ordertype="MO" end="2026-07-20T00:00:00" reference="MO #6" quantity="100" status="approved">
            <operation name="6. Make item subassembly"/>
        </operationplan>
        <operationplan ordertype="MO" end="2026-08-03T00:00:00" reference="MO #6 sub" quantity="100" status="approved">
            <operation name="6. Make item"/>
        </operationplan>
    </operationplans>

    <!-- Case 7: Operation dependencies. Feasible rescheduling -->
    <demands>
        <demand name="7. project X">
            <quantity>100</quantity>
            <minshipment>100</minshipment>
            <due>2026-02-01T00:00:00</due>
            <priority>1</priority>
            <item name="7. item"/>
            <location name="factory"/>
            <status>open</status>
            <operation name="7. project X" xsi:type="operation_fixed_time" duration="P10D">
                <location name="factory"/>
                <dependencies>
                    <dependency>
                        <blockedby name="7. task X1" xsi:type="operation_fixed_time" duration="P5D">
                            <location name="factory"/>
                        </blockedby>
                    </dependency>
                    <dependency>
                        <blockedby name="7. task X2 step 3" xsi:type="operation_fixed_time" duration="P7D">
                            <location name="factory"/>
                            <dependencies>
                                <dependency>
                                    <blockedby name="7. task X2 step 2" xsi:type="operation_fixed_time" duration="P7D">
                                        <location name="factory"/>
                                        <dependencies>
                                            <dependency>
                                                <blockedby name="7. task X2 step 1" xsi:type="operation_fixed_time" duration="P5D">
                                                    <location name="factory"/>
                                                </blockedby>
                                            </dependency>
                                        </dependencies>
                                    </blockedby>
                                </dependency>
                            </dependencies>
                        </blockedby>
                    </dependency>
                </dependencies>
            </operation>
        </demand>
    </demands>
    <operationplans>
        <operationplan ordertype="MO" end="2026-08-01T00:00:00" reference="7. task X1" quantity="20" status="approved">
            <operation name="7. task X1"/>
        </operationplan>
        <!--operationplan ordertype="MO" end="2026-08-01T00:00:00" reference="7. task X2 step 3" quantity="100" status="approved">
            <operation name="7. task X2 step 3"/>
        </operationplan-->
        <operationplan ordertype="MO" end="2026-08-01T00:00:00" reference="7. task X2 step 2" quantity="100" status="approved">
            <operation name="7. task X2 step 2"/>
        </operationplan>
        <operationplan ordertype="MO" end="2026-07-26T00:00:00" reference="7. task X2 step 1" quantity="100" status="approved">
            <operation name="7. task X2 step 1"/>
        </operationplan>
    </operationplans>

    <!-- Case 8: Operation dependencies. Delayed rescheduling -->
    <demands>
        <demand name="8. project X">
            <quantity>100</quantity>
            <minshipment>100</minshipment>
            <due>2026-01-01T00:00:00</due>
            <priority>1</priority>
            <item name="8. item"/>
            <location name="factory"/>
            <status>open</status>
            <operation name="8. project X" xsi:type="operation_fixed_time" duration="P10D">
                <location name="factory"/>
                <dependencies>
                    <dependency>
                        <blockedby name="8. task X1" xsi:type="operation_fixed_time" duration="P5D">
                            <location name="factory"/>
                        </blockedby>
                    </dependency>
                    <dependency>
                        <blockedby name="8. task X2 step 3" xsi:type="operation_fixed_time" duration="P7D">
                            <location name="factory"/>
                            <dependencies>
                                <dependency>
                                    <blockedby name="8. task X2 step 2" xsi:type="operation_fixed_time" duration="P7D">
                                        <location name="factory"/>
                                        <dependencies>
                                            <dependency>
                                                <blockedby name="8. task X2 step 1" xsi:type="operation_fixed_time" duration="P5D">
                                                    <location name="factory"/>
                                                </blockedby>
                                            </dependency>
                                        </dependencies>
                                    </blockedby>
                                </dependency>
                            </dependencies>
                        </blockedby>
                    </dependency>
                </dependencies>
            </operation>
        </demand>
    </demands>
    <operationplans>
        <!--operationplan ordertype="MO" end="2026-08-01T00:00:00" reference="8. task X1" quantity="100" status="approved">
            <operation name="8. task X1"/>
        </operationplan>
        <operationplan ordertype="MO" end="2026-08-01T00:00:00" reference="8. task X2 step 3" quantity="100" status="approved">
            <operation name="8. task X2 step 3"/>
        </operationplan-->
        <operationplan ordertype="MO" end="2026-08-01T00:00:00" reference="8. task X2 step 2" quantity="100" status="approved">
            <operation name="8. task X2 step 2"/>
        </operationplan>
        <!--operationplan ordertype="MO" end="2026-08-01T00:00:00" reference="8. task X2 step 1" quantity="100" status="approved">
            <operation name="8. task X2 step 1"/>
        </operationplan-->
    </operationplans>

    <!-- Case 9: Operation dependencies. Infeasible rescheduling -->
    <!-- Planned quantities are short. -->
    <demands>
        <demand name="9. project X">
            <quantity>100</quantity>
            <minshipment>100</minshipment>
            <due>2026-01-01T00:00:00</due>
            <priority>1</priority>
            <item name="9. item"/>
            <location name="factory"/>
            <status>open</status>
            <operation name="9. project X" xsi:type="operation_fixed_time" duration="P10D">
                <location name="factory"/>
                <dependencies>
                    <dependency>
                        <blockedby name="9. task X1" xsi:type="operation_fixed_time" duration="P5D">
                            <location name="factory"/>
                        </blockedby>
                    </dependency>
                    <dependency>
                        <blockedby name="9. task X2 step 3" xsi:type="operation_fixed_time" duration="P7D">
                            <location name="factory"/>
                            <dependencies>
                                <dependency>
                                    <blockedby name="9. task X2 step 2" xsi:type="operation_fixed_time" duration="P7D">
                                        <location name="factory"/>
                                        <dependencies>
                                            <dependency>
                                                <blockedby name="9. task X2 step 1" xsi:type="operation_fixed_time" duration="P5D">
                                                    <location name="factory"/>
                                                </blockedby>
                                            </dependency>
                                        </dependencies>
                                    </blockedby>
                                </dependency>
                            </dependencies>
                        </blockedby>
                    </dependency>
                </dependencies>
            </operation>
        </demand>
    </demands>
    <operationplans>
        <operationplan ordertype="MO" end="2026-09-01T00:00:00" reference="9. task X1" quantity="100" status="approved">
            <operation name="9. task X1"/>
        </operationplan>
        <!--operationplan ordertype="MO" end="2026-08-01T00:00:00" reference="9. task X2 step 3" quantity="100" status="approved">
            <operation name="9. task X2 step 3"/>
        </operationplan-->
        <operationplan ordertype="MO" end="2026-08-01T00:00:00" reference="9. task X2 step 2" quantity="90" status="confirmed">
            <operation name="9. task X2 step 2"/>
        </operationplan>
        <!--operationplan ordertype="MO" end="2026-08-01T00:00:00" reference="9. task X2 step 1" quantity="100" status="approved">
            <operation name="9. task X2 step 1"/>
        </operationplan-->
    </operationplans>

    <!-- case 10: Mutliple PO to move -->
    <suppliers>
        <supplier name="10. Supplier">
            <itemsuppliers>
                <itemsupplier>
                    <item name="10. item"/>
                    <leadtime>P7D</leadtime>
                    <priority>2</priority>
                </itemsupplier>
            </itemsuppliers>
        </supplier>
    </suppliers>
    <demands>
        <demand name="10. sales order">
            <quantity>20</quantity>
            <minshipment>20</minshipment>
            <due>2026-01-01T00:00:00</due>
            <priority>1</priority>
            <item name="10. item"/>
            <location name="factory"/>
            <status>open</status>
        </demand>
    </demands>
    <operationplans>
        <operationplan ordertype="PO" end="2026-07-01T00:00:00" reference="PO #10-1" quantity="5" status="approved">
            <item name="10. item"/>
            <location name="factory"/>
            <supplier name="10. Supplier"/>
        </operationplan>
        <operationplan ordertype="PO" end="2026-08-01T00:00:00" reference="PO #10-2" quantity="4" status="approved">
            <item name="10. item"/>
            <location name="factory"/>
            <supplier name="10. Supplier"/>
        </operationplan>
		<operationplan ordertype="PO" end="2026-09-01T00:00:00" reference="PO #10-3" quantity="3" status="approved">
            <item name="10. item"/>
            <location name="factory"/>
            <supplier name="10. Supplier"/>
        </operationplan>
    </operationplans>

<?python

remember = []
for opplan in frepple.operationplans():
    if opplan.status == 'approved' and not isinstance(opplan.operation, frepple.operation_routing):
        remember.append((opplan, opplan.end,))

#
# OPTION 1: Moving in keeping current assignments
#
frepple.settings.moveApprovedEarly = 1

print("CREATING CONSTRAINED PLAN - 1")
frepple.solver_mrp(plantype=1, constraints=15, loglevel=99).solve()
frepple.saveplan("output.1.xml")

print("CREATING UNCONSTRAINED PLAN - 1")
frepple.solver_mrp(plantype=2, constraints=15, loglevel=2).solve()
frepple.saveplan("output.2.xml")

print("CREATING FULLY UNCONSTRAINED PLAN - 1")
frepple.solver_mrp(plantype=2, constraints=0, loglevel=2).solve()
frepple.saveplan("output.3.xml")

frepple.saveXMLfile("output.4.xml")

#
# OPTION 2: Moving in and re-evaluate the resource assignments
#
frepple.settings.moveApprovedEarly = 2
for opplan, end in remember:
   opplan.end = end

print("CREATING CONSTRAINED PLAN - 2")
# frepple.solver_propagateStatus(loglevel=99).solve()
frepple.solver_mrp(plantype=1, constraints=15, loglevel=99).solve()
frepple.saveplan("output.5.xml")

print("CREATING UNCONSTRAINED PLAN - 2")
frepple.solver_mrp(plantype=2, constraints=15, loglevel=2).solve()
frepple.saveplan("output.6.xml")

print("CREATING FULLY UNCONSTRAINED PLAN - 2")
frepple.solver_mrp(plantype=2, constraints=0, loglevel=2).solve()
frepple.saveplan("output.7.xml")

#
# OPTION 0: Do not move early
#
frepple.settings.moveApprovedEarly = 0
for opplan, end in remember:
    opplan.end = end

print("CREATING CONSTRAINED PLAN - 0")
# frepple.solver_propagateStatus(loglevel=99).solve()
frepple.solver_mrp(plantype=1, constraints=15, loglevel=99).solve()
frepple.saveplan("output.8.xml")

print("CREATING UNCONSTRAINED PLAN - 0")
frepple.solver_mrp(plantype=2, constraints=15, loglevel=2).solve()
frepple.saveplan("output.9.xml")

print("CREATING FULLY UNCONSTRAINED PLAN - 0")
frepple.solver_mrp(plantype=2, constraints=0, loglevel=2).solve()
frepple.saveplan("output.10.xml")
?>
</plan>
